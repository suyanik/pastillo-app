const Bm=()=>{};var Rc={};const oh=function(r){const t=[];let e=0;for(let n=0;n<r.length;n++){let s=r.charCodeAt(n);s<128?t[e++]=s:s<2048?(t[e++]=s>>6|192,t[e++]=s&63|128):(s&64512)===55296&&n+1<r.length&&(r.charCodeAt(n+1)&64512)===56320?(s=65536+((s&1023)<<10)+(r.charCodeAt(++n)&1023),t[e++]=s>>18|240,t[e++]=s>>12&63|128,t[e++]=s>>6&63|128,t[e++]=s&63|128):(t[e++]=s>>12|224,t[e++]=s>>6&63|128,t[e++]=s&63|128)}return t},Um=function(r){const t=[];let e=0,n=0;for(;e<r.length;){const s=r[e++];if(s<128)t[n++]=String.fromCharCode(s);else if(s>191&&s<224){const i=r[e++];t[n++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=r[e++],o=r[e++],u=r[e++],c=((s&7)<<18|(i&63)<<12|(o&63)<<6|u&63)-65536;t[n++]=String.fromCharCode(55296+(c>>10)),t[n++]=String.fromCharCode(56320+(c&1023))}else{const i=r[e++],o=r[e++];t[n++]=String.fromCharCode((s&15)<<12|(i&63)<<6|o&63)}}return t.join("")},ah={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(r,t){if(!Array.isArray(r))throw Error("encodeByteArray takes an array as a parameter");this.init_();const e=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let s=0;s<r.length;s+=3){const i=r[s],o=s+1<r.length,u=o?r[s+1]:0,c=s+2<r.length,h=c?r[s+2]:0,f=i>>2,p=(i&3)<<4|u>>4;let _=(u&15)<<2|h>>6,R=h&63;c||(R=64,o||(_=64)),n.push(e[f],e[p],e[_],e[R])}return n.join("")},encodeString(r,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(r):this.encodeByteArray(oh(r),t)},decodeString(r,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(r):Um(this.decodeStringToByteArray(r,t))},decodeStringToByteArray(r,t){this.init_();const e=t?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let s=0;s<r.length;){const i=e[r.charAt(s++)],u=s<r.length?e[r.charAt(s)]:0;++s;const h=s<r.length?e[r.charAt(s)]:64;++s;const p=s<r.length?e[r.charAt(s)]:64;if(++s,i==null||u==null||h==null||p==null)throw new qm;const _=i<<2|u>>4;if(n.push(_),h!==64){const R=u<<4&240|h>>2;if(n.push(R),p!==64){const x=h<<6&192|p;n.push(x)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let r=0;r<this.ENCODED_VALS.length;r++)this.byteToCharMap_[r]=this.ENCODED_VALS.charAt(r),this.charToByteMap_[this.byteToCharMap_[r]]=r,this.byteToCharMapWebSafe_[r]=this.ENCODED_VALS_WEBSAFE.charAt(r),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[r]]=r,r>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(r)]=r,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(r)]=r)}}};class qm extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const jm=function(r){const t=oh(r);return ah.encodeByteArray(t,!0)},oi=function(r){return jm(r).replace(/\./g,"")},uh=function(r){try{return ah.decodeString(r,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};function zm(r,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:const e=t;return new Date(e.getTime());case Object:r===void 0&&(r={});break;case Array:r=[];break;default:return t}for(const e in t)!t.hasOwnProperty(e)||!$m(e)||(r[e]=zm(r[e],t[e]));return r}function $m(r){return r!=="__proto__"}function ch(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const Gm=()=>ch().__FIREBASE_DEFAULTS__,Km=()=>{if(typeof process>"u"||typeof Rc>"u")return;const r=Rc.__FIREBASE_DEFAULTS__;if(r)return JSON.parse(r)},Qm=()=>{if(typeof document>"u")return;let r;try{r=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const t=r&&uh(r[1]);return t&&JSON.parse(t)},lh=()=>{try{return Bm()||Gm()||Km()||Qm()}catch(r){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${r}`);return}},ma=()=>lh()?.config;class Wm{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}wrapCallback(t){return(e,n)=>{e?this.reject(e):this.resolve(n),typeof t=="function"&&(this.promise.catch(()=>{}),t.length===1?t(e):t(e,n))}}}function pa(r){try{return(r.startsWith("http://")||r.startsWith("https://")?new URL(r).hostname:r).endsWith(".cloudworkstations.dev")}catch{return!1}}async function Hm(r){return(await fetch(r,{credentials:"include"})).ok}function Jm(r,t){if(r.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const e={alg:"none",type:"JWT"},n=t||"demo-project",s=r.iat||0,i=r.sub||r.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o={iss:`https://securetoken.google.com/${n}`,aud:n,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...r};return[oi(JSON.stringify(e)),oi(JSON.stringify(o)),""].join(".")}const Br={};function Xm(){const r={prod:[],emulator:[]};for(const t of Object.keys(Br))Br[t]?r.emulator.push(t):r.prod.push(t);return r}function Ym(r){let t=document.getElementById(r),e=!1;return t||(t=document.createElement("div"),t.setAttribute("id",r),e=!0),{created:e,element:t}}let Sc=!1;function Zm(r,t){if(typeof window>"u"||typeof document>"u"||!pa(window.location.host)||Br[r]===t||Br[r]||Sc)return;Br[r]=t;function e(_){return`__firebase__banner__${_}`}const n="__firebase__banner",i=Xm().prod.length>0;function o(){const _=document.getElementById(n);_&&_.remove()}function u(_){_.style.display="flex",_.style.background="#7faaf0",_.style.position="fixed",_.style.bottom="5px",_.style.left="5px",_.style.padding=".5em",_.style.borderRadius="5px",_.style.alignItems="center"}function c(_,R){_.setAttribute("width","24"),_.setAttribute("id",R),_.setAttribute("height","24"),_.setAttribute("viewBox","0 0 24 24"),_.setAttribute("fill","none"),_.style.marginLeft="-6px"}function h(){const _=document.createElement("span");return _.style.cursor="pointer",_.style.marginLeft="16px",_.style.fontSize="24px",_.innerHTML=" &times;",_.onclick=()=>{Sc=!0,o()},_}function f(_,R){_.setAttribute("id",R),_.innerText="Learn more",_.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",_.setAttribute("target","__blank"),_.style.paddingLeft="5px",_.style.textDecoration="underline"}function p(){const _=Ym(n),R=e("text"),x=document.getElementById(R)||document.createElement("span"),N=e("learnmore"),D=document.getElementById(N)||document.createElement("a"),q=e("preprendIcon"),j=document.getElementById(q)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(_.created){const U=_.element;u(U),f(D,N);const nt=h();c(j,q),U.append(j,x,D,nt),document.body.appendChild(U)}i?(x.innerText="Preview backend disconnected.",j.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(j.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,x.innerText="Preview backend running in this workspace."),x.setAttribute("id",R)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",p):p()}function ai(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function hh(){const r=lh()?.forceEnvironment;if(r==="node")return!0;if(r==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function tp(){return typeof window<"u"||dh()}function dh(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function fh(){return!hh()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function mh(){return!hh()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function ph(){try{return typeof indexedDB=="object"}catch{return!1}}function ep(){return new Promise((r,t)=>{try{let e=!0;const n="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(n);s.onsuccess=()=>{s.result.close(),e||self.indexedDB.deleteDatabase(n),r(!0)},s.onupgradeneeded=()=>{e=!1},s.onerror=()=>{t(s.error?.message||"")}}catch(e){t(e)}})}const np="FirebaseError";class gn extends Error{constructor(t,e,n){super(e),this.code=t,this.customData=n,this.name=np,Object.setPrototypeOf(this,gn.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,gh.prototype.create)}}class gh{constructor(t,e,n){this.service=t,this.serviceName=e,this.errors=n}create(t,...e){const n=e[0]||{},s=`${this.service}/${t}`,i=this.errors[t],o=i?rp(i,n):"Error",u=`${this.serviceName}: ${o} (${s}).`;return new gn(s,u,n)}}function rp(r,t){return r.replace(sp,(e,n)=>{const s=t[n];return s!=null?String(s):`<${n}?>`})}const sp=/\{\$([^}]+)}/g;function ZI(r,t){return Object.prototype.hasOwnProperty.call(r,t)}function Fn(r,t){if(r===t)return!0;const e=Object.keys(r),n=Object.keys(t);for(const s of e){if(!n.includes(s))return!1;const i=r[s],o=t[s];if(Pc(i)&&Pc(o)){if(!Fn(i,o))return!1}else if(i!==o)return!1}for(const s of n)if(!e.includes(s))return!1;return!0}function Pc(r){return r!==null&&typeof r=="object"}function tE(r,t){const e=new ip(r,t);return e.subscribe.bind(e)}class ip{constructor(t,e){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then(()=>{t(this)}).catch(n=>{this.error(n)})}next(t){this.forEachObserver(e=>{e.next(t)})}error(t){this.forEachObserver(e=>{e.error(t)}),this.close(t)}complete(){this.forEachObserver(t=>{t.complete()}),this.close()}subscribe(t,e,n){let s;if(t===void 0&&e===void 0&&n===void 0)throw new Error("Missing Observer.");op(t,["next","error","complete"])?s=t:s={next:t,error:e,complete:n},s.next===void 0&&(s.next=wo),s.error===void 0&&(s.error=wo),s.complete===void 0&&(s.complete=wo);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(t){this.observers===void 0||this.observers[t]===void 0||(delete this.observers[t],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(t){if(!this.finalized)for(let e=0;e<this.observers.length;e++)this.sendOne(e,t)}sendOne(t,e){this.task.then(()=>{if(this.observers!==void 0&&this.observers[t]!==void 0)try{e(this.observers[t])}catch(n){typeof console<"u"&&console.error&&console.error(n)}})}close(t){this.finalized||(this.finalized=!0,t!==void 0&&(this.finalError=t),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function op(r,t){if(typeof r!="object"||r===null)return!1;for(const e of t)if(e in r&&typeof r[e]=="function")return!0;return!1}function wo(){}function vt(r){return r&&r._delegate?r._delegate:r}class Wr{constructor(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}const He="[DEFAULT]";class ap{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const n=new Wm;if(this.instancesDeferred.set(e,n),this.isInitialized(e)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:e});s&&n.resolve(s)}catch{}}return this.instancesDeferred.get(e).promise}getImmediate(t){const e=this.normalizeInstanceIdentifier(t?.identifier),n=t?.optional??!1;if(this.isInitialized(e)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:e})}catch(s){if(n)return null;throw s}else{if(n)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,!!this.shouldAutoInitialize()){if(cp(t))try{this.getOrInitializeService({instanceIdentifier:He})}catch{}for(const[e,n]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(e);try{const i=this.getOrInitializeService({instanceIdentifier:s});n.resolve(i)}catch{}}}}clearInstance(t=He){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...t.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return this.component!=null}isInitialized(t=He){return this.instances.has(t)}getOptions(t=He){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,n=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:n,options:e});for(const[i,o]of this.instancesDeferred.entries()){const u=this.normalizeInstanceIdentifier(i);n===u&&o.resolve(s)}return s}onInit(t,e){const n=this.normalizeInstanceIdentifier(e),s=this.onInitCallbacks.get(n)??new Set;s.add(t),this.onInitCallbacks.set(n,s);const i=this.instances.get(n);return i&&t(i,n),()=>{s.delete(t)}}invokeOnInitCallbacks(t,e){const n=this.onInitCallbacks.get(e);if(n)for(const s of n)try{s(t,e)}catch{}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let n=this.instances.get(t);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:up(t),options:e}),this.instances.set(t,n),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(n,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,n)}catch{}return n||null}normalizeInstanceIdentifier(t=He){return this.component?this.component.multipleInstances?t:He:t}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function up(r){return r===He?void 0:r}function cp(r){return r.instantiationMode==="EAGER"}class _h{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new ap(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}const ga=[];var W;(function(r){r[r.DEBUG=0]="DEBUG",r[r.VERBOSE=1]="VERBOSE",r[r.INFO=2]="INFO",r[r.WARN=3]="WARN",r[r.ERROR=4]="ERROR",r[r.SILENT=5]="SILENT"})(W||(W={}));const yh={debug:W.DEBUG,verbose:W.VERBOSE,info:W.INFO,warn:W.WARN,error:W.ERROR,silent:W.SILENT},lp=W.INFO,hp={[W.DEBUG]:"log",[W.VERBOSE]:"log",[W.INFO]:"info",[W.WARN]:"warn",[W.ERROR]:"error"},dp=(r,t,...e)=>{if(t<r.logLevel)return;const n=new Date().toISOString(),s=hp[t];if(s)console[s](`[${n}]  ${r.name}:`,...e);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class Ih{constructor(t){this.name=t,this._logLevel=lp,this._logHandler=dp,this._userLogHandler=null,ga.push(this)}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in W))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?yh[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,W.DEBUG,...t),this._logHandler(this,W.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,W.VERBOSE,...t),this._logHandler(this,W.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,W.INFO,...t),this._logHandler(this,W.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,W.WARN,...t),this._logHandler(this,W.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,W.ERROR,...t),this._logHandler(this,W.ERROR,...t)}}function fp(r){ga.forEach(t=>{t.setLogLevel(r)})}function mp(r,t){for(const e of ga){let n=null;t&&t.level&&(n=yh[t.level]),r===null?e.userLogHandler=null:e.userLogHandler=(s,i,...o)=>{const u=o.map(c=>{if(c==null)return null;if(typeof c=="string")return c;if(typeof c=="number"||typeof c=="boolean")return c.toString();if(c instanceof Error)return c.message;try{return JSON.stringify(c)}catch{return null}}).filter(c=>c).join(" ");i>=(n??s.logLevel)&&r({level:W[i].toLowerCase(),message:u,args:o,type:s.name})}}}const pp=(r,t)=>t.some(e=>r instanceof e);let Vc,Cc;function gp(){return Vc||(Vc=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function _p(){return Cc||(Cc=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Eh=new WeakMap,Oo=new WeakMap,Th=new WeakMap,vo=new WeakMap,_a=new WeakMap;function yp(r){const t=new Promise((e,n)=>{const s=()=>{r.removeEventListener("success",i),r.removeEventListener("error",o)},i=()=>{e(Se(r.result)),s()},o=()=>{n(r.error),s()};r.addEventListener("success",i),r.addEventListener("error",o)});return t.then(e=>{e instanceof IDBCursor&&Eh.set(e,r)}).catch(()=>{}),_a.set(t,r),t}function Ip(r){if(Oo.has(r))return;const t=new Promise((e,n)=>{const s=()=>{r.removeEventListener("complete",i),r.removeEventListener("error",o),r.removeEventListener("abort",o)},i=()=>{e(),s()},o=()=>{n(r.error||new DOMException("AbortError","AbortError")),s()};r.addEventListener("complete",i),r.addEventListener("error",o),r.addEventListener("abort",o)});Oo.set(r,t)}let Fo={get(r,t,e){if(r instanceof IDBTransaction){if(t==="done")return Oo.get(r);if(t==="objectStoreNames")return r.objectStoreNames||Th.get(r);if(t==="store")return e.objectStoreNames[1]?void 0:e.objectStore(e.objectStoreNames[0])}return Se(r[t])},set(r,t,e){return r[t]=e,!0},has(r,t){return r instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in r}};function Ep(r){Fo=r(Fo)}function Tp(r){return r===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...e){const n=r.call(Ao(this),t,...e);return Th.set(n,t.sort?t.sort():[t]),Se(n)}:_p().includes(r)?function(...t){return r.apply(Ao(this),t),Se(Eh.get(this))}:function(...t){return Se(r.apply(Ao(this),t))}}function wp(r){return typeof r=="function"?Tp(r):(r instanceof IDBTransaction&&Ip(r),pp(r,gp())?new Proxy(r,Fo):r)}function Se(r){if(r instanceof IDBRequest)return yp(r);if(vo.has(r))return vo.get(r);const t=wp(r);return t!==r&&(vo.set(r,t),_a.set(t,r)),t}const Ao=r=>_a.get(r);function vp(r,t,{blocked:e,upgrade:n,blocking:s,terminated:i}={}){const o=indexedDB.open(r,t),u=Se(o);return n&&o.addEventListener("upgradeneeded",c=>{n(Se(o.result),c.oldVersion,c.newVersion,Se(o.transaction),c)}),e&&o.addEventListener("blocked",c=>e(c.oldVersion,c.newVersion,c)),u.then(c=>{i&&c.addEventListener("close",()=>i()),s&&c.addEventListener("versionchange",h=>s(h.oldVersion,h.newVersion,h))}).catch(()=>{}),u}const Ap=["get","getKey","getAll","getAllKeys","count"],bp=["put","add","delete","clear"],bo=new Map;function Dc(r,t){if(!(r instanceof IDBDatabase&&!(t in r)&&typeof t=="string"))return;if(bo.get(t))return bo.get(t);const e=t.replace(/FromIndex$/,""),n=t!==e,s=bp.includes(e);if(!(e in(n?IDBIndex:IDBObjectStore).prototype)||!(s||Ap.includes(e)))return;const i=async function(o,...u){const c=this.transaction(o,s?"readwrite":"readonly");let h=c.store;return n&&(h=h.index(u.shift())),(await Promise.all([h[e](...u),s&&c.done]))[0]};return bo.set(t,i),i}Ep(r=>({...r,get:(t,e,n)=>Dc(t,e)||r.get(t,e,n),has:(t,e)=>!!Dc(t,e)||r.has(t,e)}));class Rp{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(Sp(e)){const n=e.getImmediate();return`${n.library}/${n.version}`}else return null}).filter(e=>e).join(" ")}}function Sp(r){return r.getComponent()?.type==="VERSION"}const ui="@firebase/app",Lo="0.14.6";const ae=new Ih("@firebase/app"),Pp="@firebase/app-compat",Vp="@firebase/analytics-compat",Cp="@firebase/analytics",Dp="@firebase/app-check-compat",xp="@firebase/app-check",Np="@firebase/auth",kp="@firebase/auth-compat",Mp="@firebase/database",Op="@firebase/data-connect",Fp="@firebase/database-compat",Lp="@firebase/functions",Bp="@firebase/functions-compat",Up="@firebase/installations",qp="@firebase/installations-compat",jp="@firebase/messaging",zp="@firebase/messaging-compat",$p="@firebase/performance",Gp="@firebase/performance-compat",Kp="@firebase/remote-config",Qp="@firebase/remote-config-compat",Wp="@firebase/storage",Hp="@firebase/storage-compat",Jp="@firebase/firestore",Xp="@firebase/ai",Yp="@firebase/firestore-compat",Zp="firebase",tg="12.6.0";const Hr="[DEFAULT]",eg={[ui]:"fire-core",[Pp]:"fire-core-compat",[Cp]:"fire-analytics",[Vp]:"fire-analytics-compat",[xp]:"fire-app-check",[Dp]:"fire-app-check-compat",[Np]:"fire-auth",[kp]:"fire-auth-compat",[Mp]:"fire-rtdb",[Op]:"fire-data-connect",[Fp]:"fire-rtdb-compat",[Lp]:"fire-fn",[Bp]:"fire-fn-compat",[Up]:"fire-iid",[qp]:"fire-iid-compat",[jp]:"fire-fcm",[zp]:"fire-fcm-compat",[$p]:"fire-perf",[Gp]:"fire-perf-compat",[Kp]:"fire-rc",[Qp]:"fire-rc-compat",[Wp]:"fire-gcs",[Hp]:"fire-gcs-compat",[Jp]:"fire-fst",[Yp]:"fire-fst-compat",[Xp]:"fire-vertex","fire-js":"fire-js",[Zp]:"fire-js-all"};const Ce=new Map,Ln=new Map,Bn=new Map;function Bo(r,t){try{r.container.addComponent(t)}catch(e){ae.debug(`Component ${t.name} failed to register with FirebaseApp ${r.name}`,e)}}function ng(r,t){r.container.addOrOverwriteComponent(t)}function Jr(r){const t=r.name;if(Bn.has(t))return ae.debug(`There were multiple attempts to register component ${t}.`),!1;Bn.set(t,r);for(const e of Ce.values())Bo(e,r);for(const e of Ln.values())Bo(e,r);return!0}function wh(r,t){const e=r.container.getProvider("heartbeat").getImmediate({optional:!0});return e&&e.triggerHeartbeat(),r.container.getProvider(t)}function rg(r,t,e=Hr){wh(r,t).clearInstance(e)}function ya(r){return r.options!==void 0}function vh(r){return ya(r)?!1:"authIdToken"in r||"appCheckToken"in r||"releaseOnDeref"in r||"automaticDataCollectionEnabled"in r}function Ah(r){return r==null?!1:r.settings!==void 0}function sg(){Bn.clear()}const ig={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},zt=new gh("app","Firebase",ig);class bh{constructor(t,e,n){this._isDeleted=!1,this._options={...t},this._config={...e},this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new Wr("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw zt.create("app-deleted",{appName:this._name})}}function xc(r,t){const e=uh(r.split(".")[1]);if(e===null){console.error(`FirebaseServerApp ${t} is invalid: second part could not be parsed.`);return}if(JSON.parse(e).exp===void 0){console.error(`FirebaseServerApp ${t} is invalid: expiration claim could not be parsed`);return}const s=JSON.parse(e).exp*1e3,i=new Date().getTime();s-i<=0&&console.error(`FirebaseServerApp ${t} is invalid: the token has expired.`)}class og extends bh{constructor(t,e,n,s){const i=e.automaticDataCollectionEnabled!==void 0?e.automaticDataCollectionEnabled:!0,o={name:n,automaticDataCollectionEnabled:i};if(t.apiKey!==void 0)super(t,o,s);else{const u=t;super(u.options,o,s)}this._serverConfig={automaticDataCollectionEnabled:i,...e},this._serverConfig.authIdToken&&xc(this._serverConfig.authIdToken,"authIdToken"),this._serverConfig.appCheckToken&&xc(this._serverConfig.appCheckToken,"appCheckToken"),this._finalizationRegistry=null,typeof FinalizationRegistry<"u"&&(this._finalizationRegistry=new FinalizationRegistry(()=>{this.automaticCleanup()})),this._refCount=0,this.incRefCount(this._serverConfig.releaseOnDeref),this._serverConfig.releaseOnDeref=void 0,e.releaseOnDeref=void 0,sn(ui,Lo,"serverapp")}toJSON(){}get refCount(){return this._refCount}incRefCount(t){this.isDeleted||(this._refCount++,t!==void 0&&this._finalizationRegistry!==null&&this._finalizationRegistry.register(t,this))}decRefCount(){return this.isDeleted?0:--this._refCount}automaticCleanup(){Ph(this)}get settings(){return this.checkDestroyed(),this._serverConfig}checkDestroyed(){if(this.isDeleted)throw zt.create("server-app-deleted")}}const Rh=tg;function Sh(r,t={}){let e=r;typeof t!="object"&&(t={name:t});const n={name:Hr,automaticDataCollectionEnabled:!0,...t},s=n.name;if(typeof s!="string"||!s)throw zt.create("bad-app-name",{appName:String(s)});if(e||(e=ma()),!e)throw zt.create("no-options");const i=Ce.get(s);if(i){if(Fn(e,i.options)&&Fn(n,i.config))return i;throw zt.create("duplicate-app",{appName:s})}const o=new _h(s);for(const c of Bn.values())o.addComponent(c);const u=new bh(e,n,o);return Ce.set(s,u),u}function ag(r,t={}){if(tp()&&!dh())throw zt.create("invalid-server-app-environment");let e,n=t||{};if(r&&(ya(r)?e=r.options:vh(r)?n=r:e=r),n.automaticDataCollectionEnabled===void 0&&(n.automaticDataCollectionEnabled=!0),e||(e=ma()),!e)throw zt.create("no-options");const s={...n,...e};s.releaseOnDeref!==void 0&&delete s.releaseOnDeref;const i=f=>[...f].reduce((p,_)=>Math.imul(31,p)+_.charCodeAt(0)|0,0);if(n.releaseOnDeref!==void 0&&typeof FinalizationRegistry>"u")throw zt.create("finalization-registry-not-supported",{});const o=""+i(JSON.stringify(s)),u=Ln.get(o);if(u)return u.incRefCount(n.releaseOnDeref),u;const c=new _h(o);for(const f of Bn.values())c.addComponent(f);const h=new og(e,n,o,c);return Ln.set(o,h),h}function ug(r=Hr){const t=Ce.get(r);if(!t&&r===Hr&&ma())return Sh();if(!t)throw zt.create("no-app",{appName:r});return t}function cg(){return Array.from(Ce.values())}async function Ph(r){let t=!1;const e=r.name;Ce.has(e)?(t=!0,Ce.delete(e)):Ln.has(e)&&r.decRefCount()<=0&&(Ln.delete(e),t=!0),t&&(await Promise.all(r.container.getProviders().map(n=>n.delete())),r.isDeleted=!0)}function sn(r,t,e){let n=eg[r]??r;e&&(n+=`-${e}`);const s=n.match(/\s|\//),i=t.match(/\s|\//);if(s||i){const o=[`Unable to register library "${n}" with version "${t}":`];s&&o.push(`library name "${n}" contains illegal characters (whitespace or "/")`),s&&i&&o.push("and"),i&&o.push(`version name "${t}" contains illegal characters (whitespace or "/")`),ae.warn(o.join(" "));return}Jr(new Wr(`${n}-version`,()=>({library:n,version:t}),"VERSION"))}function lg(r,t){if(r!==null&&typeof r!="function")throw zt.create("invalid-log-argument");mp(r,t)}function hg(r){fp(r)}const dg="firebase-heartbeat-database",fg=1,Xr="firebase-heartbeat-store";let Ro=null;function Vh(){return Ro||(Ro=vp(dg,fg,{upgrade:(r,t)=>{switch(t){case 0:try{r.createObjectStore(Xr)}catch(e){console.warn(e)}}}}).catch(r=>{throw zt.create("idb-open",{originalErrorMessage:r.message})})),Ro}async function mg(r){try{const e=(await Vh()).transaction(Xr),n=await e.objectStore(Xr).get(Ch(r));return await e.done,n}catch(t){if(t instanceof gn)ae.warn(t.message);else{const e=zt.create("idb-get",{originalErrorMessage:t?.message});ae.warn(e.message)}}}async function Nc(r,t){try{const n=(await Vh()).transaction(Xr,"readwrite");await n.objectStore(Xr).put(t,Ch(r)),await n.done}catch(e){if(e instanceof gn)ae.warn(e.message);else{const n=zt.create("idb-set",{originalErrorMessage:e?.message});ae.warn(n.message)}}}function Ch(r){return`${r.name}!${r.options.appId}`}const pg=1024,gg=30;class _g{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new Ig(e),this._heartbeatsCachePromise=this._storage.read().then(n=>(this._heartbeatsCache=n,n))}async triggerHeartbeat(){try{const e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),n=kc();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===n||this._heartbeatsCache.heartbeats.some(s=>s.date===n))return;if(this._heartbeatsCache.heartbeats.push({date:n,agent:e}),this._heartbeatsCache.heartbeats.length>gg){const s=Eg(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(s,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(t){ae.warn(t)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=kc(),{heartbeatsToSend:e,unsentEntries:n}=yg(this._heartbeatsCache.heartbeats),s=oi(JSON.stringify({version:2,heartbeats:e}));return this._heartbeatsCache.lastSentHeartbeatDate=t,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(t){return ae.warn(t),""}}}function kc(){return new Date().toISOString().substring(0,10)}function yg(r,t=pg){const e=[];let n=r.slice();for(const s of r){const i=e.find(o=>o.agent===s.agent);if(i){if(i.dates.push(s.date),Mc(e)>t){i.dates.pop();break}}else if(e.push({agent:s.agent,dates:[s.date]}),Mc(e)>t){e.pop();break}n=n.slice(1)}return{heartbeatsToSend:e,unsentEntries:n}}class Ig{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return ph()?ep().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const e=await mg(this.app);return e?.heartbeats?e:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(t){if(await this._canUseIndexedDBPromise){const n=await this.read();return Nc(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??n.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return}async add(t){if(await this._canUseIndexedDBPromise){const n=await this.read();return Nc(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...t.heartbeats]})}else return}}function Mc(r){return oi(JSON.stringify({version:2,heartbeats:r})).length}function Eg(r){if(r.length===0)return-1;let t=0,e=r[0].date;for(let n=1;n<r.length;n++)r[n].date<e&&(e=r[n].date,t=n);return t}function Tg(r){Jr(new Wr("platform-logger",t=>new Rp(t),"PRIVATE")),Jr(new Wr("heartbeat",t=>new _g(t),"PRIVATE")),sn(ui,Lo,r),sn(ui,Lo,"esm2020"),sn("fire-js","")}Tg("");const eE=Object.freeze(Object.defineProperty({__proto__:null,FirebaseError:gn,SDK_VERSION:Rh,_DEFAULT_ENTRY_NAME:Hr,_addComponent:Bo,_addOrOverwriteComponent:ng,_apps:Ce,_clearComponents:sg,_components:Bn,_getProvider:wh,_isFirebaseApp:ya,_isFirebaseServerApp:Ah,_isFirebaseServerAppSettings:vh,_registerComponent:Jr,_removeServiceInstance:rg,_serverApps:Ln,deleteApp:Ph,getApp:ug,getApps:cg,initializeApp:Sh,initializeServerApp:ag,onLog:lg,registerVersion:sn,setLogLevel:hg},Symbol.toStringTag,{value:"Module"}));var Oc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var Pe,Dh;(function(){var r;function t(E,g){function I(){}I.prototype=g.prototype,E.F=g.prototype,E.prototype=new I,E.prototype.constructor=E,E.D=function(w,T,b){for(var y=Array(arguments.length-2),Ot=2;Ot<arguments.length;Ot++)y[Ot-2]=arguments[Ot];return g.prototype[T].apply(w,y)}}function e(){this.blockSize=-1}function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}t(n,e),n.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(E,g,I){I||(I=0);const w=Array(16);if(typeof g=="string")for(var T=0;T<16;++T)w[T]=g.charCodeAt(I++)|g.charCodeAt(I++)<<8|g.charCodeAt(I++)<<16|g.charCodeAt(I++)<<24;else for(T=0;T<16;++T)w[T]=g[I++]|g[I++]<<8|g[I++]<<16|g[I++]<<24;g=E.g[0],I=E.g[1],T=E.g[2];let b=E.g[3],y;y=g+(b^I&(T^b))+w[0]+3614090360&4294967295,g=I+(y<<7&4294967295|y>>>25),y=b+(T^g&(I^T))+w[1]+3905402710&4294967295,b=g+(y<<12&4294967295|y>>>20),y=T+(I^b&(g^I))+w[2]+606105819&4294967295,T=b+(y<<17&4294967295|y>>>15),y=I+(g^T&(b^g))+w[3]+3250441966&4294967295,I=T+(y<<22&4294967295|y>>>10),y=g+(b^I&(T^b))+w[4]+4118548399&4294967295,g=I+(y<<7&4294967295|y>>>25),y=b+(T^g&(I^T))+w[5]+1200080426&4294967295,b=g+(y<<12&4294967295|y>>>20),y=T+(I^b&(g^I))+w[6]+2821735955&4294967295,T=b+(y<<17&4294967295|y>>>15),y=I+(g^T&(b^g))+w[7]+4249261313&4294967295,I=T+(y<<22&4294967295|y>>>10),y=g+(b^I&(T^b))+w[8]+1770035416&4294967295,g=I+(y<<7&4294967295|y>>>25),y=b+(T^g&(I^T))+w[9]+2336552879&4294967295,b=g+(y<<12&4294967295|y>>>20),y=T+(I^b&(g^I))+w[10]+4294925233&4294967295,T=b+(y<<17&4294967295|y>>>15),y=I+(g^T&(b^g))+w[11]+2304563134&4294967295,I=T+(y<<22&4294967295|y>>>10),y=g+(b^I&(T^b))+w[12]+1804603682&4294967295,g=I+(y<<7&4294967295|y>>>25),y=b+(T^g&(I^T))+w[13]+4254626195&4294967295,b=g+(y<<12&4294967295|y>>>20),y=T+(I^b&(g^I))+w[14]+2792965006&4294967295,T=b+(y<<17&4294967295|y>>>15),y=I+(g^T&(b^g))+w[15]+1236535329&4294967295,I=T+(y<<22&4294967295|y>>>10),y=g+(T^b&(I^T))+w[1]+4129170786&4294967295,g=I+(y<<5&4294967295|y>>>27),y=b+(I^T&(g^I))+w[6]+3225465664&4294967295,b=g+(y<<9&4294967295|y>>>23),y=T+(g^I&(b^g))+w[11]+643717713&4294967295,T=b+(y<<14&4294967295|y>>>18),y=I+(b^g&(T^b))+w[0]+3921069994&4294967295,I=T+(y<<20&4294967295|y>>>12),y=g+(T^b&(I^T))+w[5]+3593408605&4294967295,g=I+(y<<5&4294967295|y>>>27),y=b+(I^T&(g^I))+w[10]+38016083&4294967295,b=g+(y<<9&4294967295|y>>>23),y=T+(g^I&(b^g))+w[15]+3634488961&4294967295,T=b+(y<<14&4294967295|y>>>18),y=I+(b^g&(T^b))+w[4]+3889429448&4294967295,I=T+(y<<20&4294967295|y>>>12),y=g+(T^b&(I^T))+w[9]+568446438&4294967295,g=I+(y<<5&4294967295|y>>>27),y=b+(I^T&(g^I))+w[14]+3275163606&4294967295,b=g+(y<<9&4294967295|y>>>23),y=T+(g^I&(b^g))+w[3]+4107603335&4294967295,T=b+(y<<14&4294967295|y>>>18),y=I+(b^g&(T^b))+w[8]+1163531501&4294967295,I=T+(y<<20&4294967295|y>>>12),y=g+(T^b&(I^T))+w[13]+2850285829&4294967295,g=I+(y<<5&4294967295|y>>>27),y=b+(I^T&(g^I))+w[2]+4243563512&4294967295,b=g+(y<<9&4294967295|y>>>23),y=T+(g^I&(b^g))+w[7]+1735328473&4294967295,T=b+(y<<14&4294967295|y>>>18),y=I+(b^g&(T^b))+w[12]+2368359562&4294967295,I=T+(y<<20&4294967295|y>>>12),y=g+(I^T^b)+w[5]+4294588738&4294967295,g=I+(y<<4&4294967295|y>>>28),y=b+(g^I^T)+w[8]+2272392833&4294967295,b=g+(y<<11&4294967295|y>>>21),y=T+(b^g^I)+w[11]+1839030562&4294967295,T=b+(y<<16&4294967295|y>>>16),y=I+(T^b^g)+w[14]+4259657740&4294967295,I=T+(y<<23&4294967295|y>>>9),y=g+(I^T^b)+w[1]+2763975236&4294967295,g=I+(y<<4&4294967295|y>>>28),y=b+(g^I^T)+w[4]+1272893353&4294967295,b=g+(y<<11&4294967295|y>>>21),y=T+(b^g^I)+w[7]+4139469664&4294967295,T=b+(y<<16&4294967295|y>>>16),y=I+(T^b^g)+w[10]+3200236656&4294967295,I=T+(y<<23&4294967295|y>>>9),y=g+(I^T^b)+w[13]+681279174&4294967295,g=I+(y<<4&4294967295|y>>>28),y=b+(g^I^T)+w[0]+3936430074&4294967295,b=g+(y<<11&4294967295|y>>>21),y=T+(b^g^I)+w[3]+3572445317&4294967295,T=b+(y<<16&4294967295|y>>>16),y=I+(T^b^g)+w[6]+76029189&4294967295,I=T+(y<<23&4294967295|y>>>9),y=g+(I^T^b)+w[9]+3654602809&4294967295,g=I+(y<<4&4294967295|y>>>28),y=b+(g^I^T)+w[12]+3873151461&4294967295,b=g+(y<<11&4294967295|y>>>21),y=T+(b^g^I)+w[15]+530742520&4294967295,T=b+(y<<16&4294967295|y>>>16),y=I+(T^b^g)+w[2]+3299628645&4294967295,I=T+(y<<23&4294967295|y>>>9),y=g+(T^(I|~b))+w[0]+4096336452&4294967295,g=I+(y<<6&4294967295|y>>>26),y=b+(I^(g|~T))+w[7]+1126891415&4294967295,b=g+(y<<10&4294967295|y>>>22),y=T+(g^(b|~I))+w[14]+2878612391&4294967295,T=b+(y<<15&4294967295|y>>>17),y=I+(b^(T|~g))+w[5]+4237533241&4294967295,I=T+(y<<21&4294967295|y>>>11),y=g+(T^(I|~b))+w[12]+1700485571&4294967295,g=I+(y<<6&4294967295|y>>>26),y=b+(I^(g|~T))+w[3]+2399980690&4294967295,b=g+(y<<10&4294967295|y>>>22),y=T+(g^(b|~I))+w[10]+4293915773&4294967295,T=b+(y<<15&4294967295|y>>>17),y=I+(b^(T|~g))+w[1]+2240044497&4294967295,I=T+(y<<21&4294967295|y>>>11),y=g+(T^(I|~b))+w[8]+1873313359&4294967295,g=I+(y<<6&4294967295|y>>>26),y=b+(I^(g|~T))+w[15]+4264355552&4294967295,b=g+(y<<10&4294967295|y>>>22),y=T+(g^(b|~I))+w[6]+2734768916&4294967295,T=b+(y<<15&4294967295|y>>>17),y=I+(b^(T|~g))+w[13]+1309151649&4294967295,I=T+(y<<21&4294967295|y>>>11),y=g+(T^(I|~b))+w[4]+4149444226&4294967295,g=I+(y<<6&4294967295|y>>>26),y=b+(I^(g|~T))+w[11]+3174756917&4294967295,b=g+(y<<10&4294967295|y>>>22),y=T+(g^(b|~I))+w[2]+718787259&4294967295,T=b+(y<<15&4294967295|y>>>17),y=I+(b^(T|~g))+w[9]+3951481745&4294967295,E.g[0]=E.g[0]+g&4294967295,E.g[1]=E.g[1]+(T+(y<<21&4294967295|y>>>11))&4294967295,E.g[2]=E.g[2]+T&4294967295,E.g[3]=E.g[3]+b&4294967295}n.prototype.v=function(E,g){g===void 0&&(g=E.length);const I=g-this.blockSize,w=this.C;let T=this.h,b=0;for(;b<g;){if(T==0)for(;b<=I;)s(this,E,b),b+=this.blockSize;if(typeof E=="string"){for(;b<g;)if(w[T++]=E.charCodeAt(b++),T==this.blockSize){s(this,w),T=0;break}}else for(;b<g;)if(w[T++]=E[b++],T==this.blockSize){s(this,w),T=0;break}}this.h=T,this.o+=g},n.prototype.A=function(){var E=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);E[0]=128;for(var g=1;g<E.length-8;++g)E[g]=0;g=this.o*8;for(var I=E.length-8;I<E.length;++I)E[I]=g&255,g/=256;for(this.v(E),E=Array(16),g=0,I=0;I<4;++I)for(let w=0;w<32;w+=8)E[g++]=this.g[I]>>>w&255;return E};function i(E,g){var I=u;return Object.prototype.hasOwnProperty.call(I,E)?I[E]:I[E]=g(E)}function o(E,g){this.h=g;const I=[];let w=!0;for(let T=E.length-1;T>=0;T--){const b=E[T]|0;w&&b==g||(I[T]=b,w=!1)}this.g=I}var u={};function c(E){return-128<=E&&E<128?i(E,function(g){return new o([g|0],g<0?-1:0)}):new o([E|0],E<0?-1:0)}function h(E){if(isNaN(E)||!isFinite(E))return p;if(E<0)return D(h(-E));const g=[];let I=1;for(let w=0;E>=I;w++)g[w]=E/I|0,I*=4294967296;return new o(g,0)}function f(E,g){if(E.length==0)throw Error("number format error: empty string");if(g=g||10,g<2||36<g)throw Error("radix out of range: "+g);if(E.charAt(0)=="-")return D(f(E.substring(1),g));if(E.indexOf("-")>=0)throw Error('number format error: interior "-" character');const I=h(Math.pow(g,8));let w=p;for(let b=0;b<E.length;b+=8){var T=Math.min(8,E.length-b);const y=parseInt(E.substring(b,b+T),g);T<8?(T=h(Math.pow(g,T)),w=w.j(T).add(h(y))):(w=w.j(I),w=w.add(h(y)))}return w}var p=c(0),_=c(1),R=c(16777216);r=o.prototype,r.m=function(){if(N(this))return-D(this).m();let E=0,g=1;for(let I=0;I<this.g.length;I++){const w=this.i(I);E+=(w>=0?w:4294967296+w)*g,g*=4294967296}return E},r.toString=function(E){if(E=E||10,E<2||36<E)throw Error("radix out of range: "+E);if(x(this))return"0";if(N(this))return"-"+D(this).toString(E);const g=h(Math.pow(E,6));var I=this;let w="";for(;;){const T=nt(I,g).g;I=q(I,T.j(g));let b=((I.g.length>0?I.g[0]:I.h)>>>0).toString(E);if(I=T,x(I))return b+w;for(;b.length<6;)b="0"+b;w=b+w}},r.i=function(E){return E<0?0:E<this.g.length?this.g[E]:this.h};function x(E){if(E.h!=0)return!1;for(let g=0;g<E.g.length;g++)if(E.g[g]!=0)return!1;return!0}function N(E){return E.h==-1}r.l=function(E){return E=q(this,E),N(E)?-1:x(E)?0:1};function D(E){const g=E.g.length,I=[];for(let w=0;w<g;w++)I[w]=~E.g[w];return new o(I,~E.h).add(_)}r.abs=function(){return N(this)?D(this):this},r.add=function(E){const g=Math.max(this.g.length,E.g.length),I=[];let w=0;for(let T=0;T<=g;T++){let b=w+(this.i(T)&65535)+(E.i(T)&65535),y=(b>>>16)+(this.i(T)>>>16)+(E.i(T)>>>16);w=y>>>16,b&=65535,y&=65535,I[T]=y<<16|b}return new o(I,I[I.length-1]&-2147483648?-1:0)};function q(E,g){return E.add(D(g))}r.j=function(E){if(x(this)||x(E))return p;if(N(this))return N(E)?D(this).j(D(E)):D(D(this).j(E));if(N(E))return D(this.j(D(E)));if(this.l(R)<0&&E.l(R)<0)return h(this.m()*E.m());const g=this.g.length+E.g.length,I=[];for(var w=0;w<2*g;w++)I[w]=0;for(w=0;w<this.g.length;w++)for(let T=0;T<E.g.length;T++){const b=this.i(w)>>>16,y=this.i(w)&65535,Ot=E.i(T)>>>16,je=E.i(T)&65535;I[2*w+2*T]+=y*je,j(I,2*w+2*T),I[2*w+2*T+1]+=b*je,j(I,2*w+2*T+1),I[2*w+2*T+1]+=y*Ot,j(I,2*w+2*T+1),I[2*w+2*T+2]+=b*Ot,j(I,2*w+2*T+2)}for(E=0;E<g;E++)I[E]=I[2*E+1]<<16|I[2*E];for(E=g;E<2*g;E++)I[E]=0;return new o(I,0)};function j(E,g){for(;(E[g]&65535)!=E[g];)E[g+1]+=E[g]>>>16,E[g]&=65535,g++}function U(E,g){this.g=E,this.h=g}function nt(E,g){if(x(g))throw Error("division by zero");if(x(E))return new U(p,p);if(N(E))return g=nt(D(E),g),new U(D(g.g),D(g.h));if(N(g))return g=nt(E,D(g)),new U(D(g.g),g.h);if(E.g.length>30){if(N(E)||N(g))throw Error("slowDivide_ only works with positive integers.");for(var I=_,w=g;w.l(E)<=0;)I=X(I),w=X(w);var T=H(I,1),b=H(w,1);for(w=H(w,2),I=H(I,2);!x(w);){var y=b.add(w);y.l(E)<=0&&(T=T.add(I),b=y),w=H(w,1),I=H(I,1)}return g=q(E,T.j(g)),new U(T,g)}for(T=p;E.l(g)>=0;){for(I=Math.max(1,Math.floor(E.m()/g.m())),w=Math.ceil(Math.log(I)/Math.LN2),w=w<=48?1:Math.pow(2,w-48),b=h(I),y=b.j(g);N(y)||y.l(E)>0;)I-=w,b=h(I),y=b.j(g);x(b)&&(b=_),T=T.add(b),E=q(E,y)}return new U(T,E)}r.B=function(E){return nt(this,E).h},r.and=function(E){const g=Math.max(this.g.length,E.g.length),I=[];for(let w=0;w<g;w++)I[w]=this.i(w)&E.i(w);return new o(I,this.h&E.h)},r.or=function(E){const g=Math.max(this.g.length,E.g.length),I=[];for(let w=0;w<g;w++)I[w]=this.i(w)|E.i(w);return new o(I,this.h|E.h)},r.xor=function(E){const g=Math.max(this.g.length,E.g.length),I=[];for(let w=0;w<g;w++)I[w]=this.i(w)^E.i(w);return new o(I,this.h^E.h)};function X(E){const g=E.g.length+1,I=[];for(let w=0;w<g;w++)I[w]=E.i(w)<<1|E.i(w-1)>>>31;return new o(I,E.h)}function H(E,g){const I=g>>5;g%=32;const w=E.g.length-I,T=[];for(let b=0;b<w;b++)T[b]=g>0?E.i(b+I)>>>g|E.i(b+I+1)<<32-g:E.i(b+I);return new o(T,E.h)}n.prototype.digest=n.prototype.A,n.prototype.reset=n.prototype.u,n.prototype.update=n.prototype.v,Dh=n,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.B,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=h,o.fromString=f,Pe=o}).apply(typeof Oc<"u"?Oc:typeof self<"u"?self:typeof window<"u"?window:{});var qs=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var xh,kr,Nh,Ws,Uo,kh,Mh,Oh;(function(){var r,t=Object.defineProperty;function e(a){a=[typeof globalThis=="object"&&globalThis,a,typeof window=="object"&&window,typeof self=="object"&&self,typeof qs=="object"&&qs];for(var l=0;l<a.length;++l){var d=a[l];if(d&&d.Math==Math)return d}throw Error("Cannot find global object")}var n=e(this);function s(a,l){if(l)t:{var d=n;a=a.split(".");for(var m=0;m<a.length-1;m++){var A=a[m];if(!(A in d))break t;d=d[A]}a=a[a.length-1],m=d[a],l=l(m),l!=m&&l!=null&&t(d,a,{configurable:!0,writable:!0,value:l})}}s("Symbol.dispose",function(a){return a||Symbol("Symbol.dispose")}),s("Array.prototype.values",function(a){return a||function(){return this[Symbol.iterator]()}}),s("Object.entries",function(a){return a||function(l){var d=[],m;for(m in l)Object.prototype.hasOwnProperty.call(l,m)&&d.push([m,l[m]]);return d}});var i=i||{},o=this||self;function u(a){var l=typeof a;return l=="object"&&a!=null||l=="function"}function c(a,l,d){return a.call.apply(a.bind,arguments)}function h(a,l,d){return h=c,h.apply(null,arguments)}function f(a,l){var d=Array.prototype.slice.call(arguments,1);return function(){var m=d.slice();return m.push.apply(m,arguments),a.apply(this,m)}}function p(a,l){function d(){}d.prototype=l.prototype,a.Z=l.prototype,a.prototype=new d,a.prototype.constructor=a,a.Ob=function(m,A,P){for(var k=Array(arguments.length-2),G=2;G<arguments.length;G++)k[G-2]=arguments[G];return l.prototype[A].apply(m,k)}}var _=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?a=>a&&AsyncContext.Snapshot.wrap(a):a=>a;function R(a){const l=a.length;if(l>0){const d=Array(l);for(let m=0;m<l;m++)d[m]=a[m];return d}return[]}function x(a,l){for(let m=1;m<arguments.length;m++){const A=arguments[m];var d=typeof A;if(d=d!="object"?d:A?Array.isArray(A)?"array":d:"null",d=="array"||d=="object"&&typeof A.length=="number"){d=a.length||0;const P=A.length||0;a.length=d+P;for(let k=0;k<P;k++)a[d+k]=A[k]}else a.push(A)}}class N{constructor(l,d){this.i=l,this.j=d,this.h=0,this.g=null}get(){let l;return this.h>0?(this.h--,l=this.g,this.g=l.next,l.next=null):l=this.i(),l}}function D(a){o.setTimeout(()=>{throw a},0)}function q(){var a=E;let l=null;return a.g&&(l=a.g,a.g=a.g.next,a.g||(a.h=null),l.next=null),l}class j{constructor(){this.h=this.g=null}add(l,d){const m=U.get();m.set(l,d),this.h?this.h.next=m:this.g=m,this.h=m}}var U=new N(()=>new nt,a=>a.reset());class nt{constructor(){this.next=this.g=this.h=null}set(l,d){this.h=l,this.g=d,this.next=null}reset(){this.next=this.g=this.h=null}}let X,H=!1,E=new j,g=()=>{const a=Promise.resolve(void 0);X=()=>{a.then(I)}};function I(){for(var a;a=q();){try{a.h.call(a.g)}catch(d){D(d)}var l=U;l.j(a),l.h<100&&(l.h++,a.next=l.g,l.g=a)}H=!1}function w(){this.u=this.u,this.C=this.C}w.prototype.u=!1,w.prototype.dispose=function(){this.u||(this.u=!0,this.N())},w.prototype[Symbol.dispose]=function(){this.dispose()},w.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function T(a,l){this.type=a,this.g=this.target=l,this.defaultPrevented=!1}T.prototype.h=function(){this.defaultPrevented=!0};var b=(function(){if(!o.addEventListener||!Object.defineProperty)return!1;var a=!1,l=Object.defineProperty({},"passive",{get:function(){a=!0}});try{const d=()=>{};o.addEventListener("test",d,l),o.removeEventListener("test",d,l)}catch{}return a})();function y(a){return/^[\s\xa0]*$/.test(a)}function Ot(a,l){T.call(this,a?a.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,a&&this.init(a,l)}p(Ot,T),Ot.prototype.init=function(a,l){const d=this.type=a.type,m=a.changedTouches&&a.changedTouches.length?a.changedTouches[0]:null;this.target=a.target||a.srcElement,this.g=l,l=a.relatedTarget,l||(d=="mouseover"?l=a.fromElement:d=="mouseout"&&(l=a.toElement)),this.relatedTarget=l,m?(this.clientX=m.clientX!==void 0?m.clientX:m.pageX,this.clientY=m.clientY!==void 0?m.clientY:m.pageY,this.screenX=m.screenX||0,this.screenY=m.screenY||0):(this.clientX=a.clientX!==void 0?a.clientX:a.pageX,this.clientY=a.clientY!==void 0?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0),this.button=a.button,this.key=a.key||"",this.ctrlKey=a.ctrlKey,this.altKey=a.altKey,this.shiftKey=a.shiftKey,this.metaKey=a.metaKey,this.pointerId=a.pointerId||0,this.pointerType=a.pointerType,this.state=a.state,this.i=a,a.defaultPrevented&&Ot.Z.h.call(this)},Ot.prototype.h=function(){Ot.Z.h.call(this);const a=this.i;a.preventDefault?a.preventDefault():a.returnValue=!1};var je="closure_listenable_"+(Math.random()*1e6|0),am=0;function um(a,l,d,m,A){this.listener=a,this.proxy=null,this.src=l,this.type=d,this.capture=!!m,this.ha=A,this.key=++am,this.da=this.fa=!1}function Rs(a){a.da=!0,a.listener=null,a.proxy=null,a.src=null,a.ha=null}function Ss(a,l,d){for(const m in a)l.call(d,a[m],m,a)}function cm(a,l){for(const d in a)l.call(void 0,a[d],d,a)}function bu(a){const l={};for(const d in a)l[d]=a[d];return l}const Ru="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Su(a,l){let d,m;for(let A=1;A<arguments.length;A++){m=arguments[A];for(d in m)a[d]=m[d];for(let P=0;P<Ru.length;P++)d=Ru[P],Object.prototype.hasOwnProperty.call(m,d)&&(a[d]=m[d])}}function Ps(a){this.src=a,this.g={},this.h=0}Ps.prototype.add=function(a,l,d,m,A){const P=a.toString();a=this.g[P],a||(a=this.g[P]=[],this.h++);const k=Yi(a,l,m,A);return k>-1?(l=a[k],d||(l.fa=!1)):(l=new um(l,this.src,P,!!m,A),l.fa=d,a.push(l)),l};function Xi(a,l){const d=l.type;if(d in a.g){var m=a.g[d],A=Array.prototype.indexOf.call(m,l,void 0),P;(P=A>=0)&&Array.prototype.splice.call(m,A,1),P&&(Rs(l),a.g[d].length==0&&(delete a.g[d],a.h--))}}function Yi(a,l,d,m){for(let A=0;A<a.length;++A){const P=a[A];if(!P.da&&P.listener==l&&P.capture==!!d&&P.ha==m)return A}return-1}var Zi="closure_lm_"+(Math.random()*1e6|0),to={};function Pu(a,l,d,m,A){if(Array.isArray(l)){for(let P=0;P<l.length;P++)Pu(a,l[P],d,m,A);return null}return d=Du(d),a&&a[je]?a.J(l,d,u(m)?!!m.capture:!1,A):lm(a,l,d,!1,m,A)}function lm(a,l,d,m,A,P){if(!l)throw Error("Invalid event type");const k=u(A)?!!A.capture:!!A;let G=no(a);if(G||(a[Zi]=G=new Ps(a)),d=G.add(l,d,m,k,P),d.proxy)return d;if(m=hm(),d.proxy=m,m.src=a,m.listener=d,a.addEventListener)b||(A=k),A===void 0&&(A=!1),a.addEventListener(l.toString(),m,A);else if(a.attachEvent)a.attachEvent(Cu(l.toString()),m);else if(a.addListener&&a.removeListener)a.addListener(m);else throw Error("addEventListener and attachEvent are unavailable.");return d}function hm(){function a(d){return l.call(a.src,a.listener,d)}const l=dm;return a}function Vu(a,l,d,m,A){if(Array.isArray(l))for(var P=0;P<l.length;P++)Vu(a,l[P],d,m,A);else m=u(m)?!!m.capture:!!m,d=Du(d),a&&a[je]?(a=a.i,P=String(l).toString(),P in a.g&&(l=a.g[P],d=Yi(l,d,m,A),d>-1&&(Rs(l[d]),Array.prototype.splice.call(l,d,1),l.length==0&&(delete a.g[P],a.h--)))):a&&(a=no(a))&&(l=a.g[l.toString()],a=-1,l&&(a=Yi(l,d,m,A)),(d=a>-1?l[a]:null)&&eo(d))}function eo(a){if(typeof a!="number"&&a&&!a.da){var l=a.src;if(l&&l[je])Xi(l.i,a);else{var d=a.type,m=a.proxy;l.removeEventListener?l.removeEventListener(d,m,a.capture):l.detachEvent?l.detachEvent(Cu(d),m):l.addListener&&l.removeListener&&l.removeListener(m),(d=no(l))?(Xi(d,a),d.h==0&&(d.src=null,l[Zi]=null)):Rs(a)}}}function Cu(a){return a in to?to[a]:to[a]="on"+a}function dm(a,l){if(a.da)a=!0;else{l=new Ot(l,this);const d=a.listener,m=a.ha||a.src;a.fa&&eo(a),a=d.call(m,l)}return a}function no(a){return a=a[Zi],a instanceof Ps?a:null}var ro="__closure_events_fn_"+(Math.random()*1e9>>>0);function Du(a){return typeof a=="function"?a:(a[ro]||(a[ro]=function(l){return a.handleEvent(l)}),a[ro])}function Pt(){w.call(this),this.i=new Ps(this),this.M=this,this.G=null}p(Pt,w),Pt.prototype[je]=!0,Pt.prototype.removeEventListener=function(a,l,d,m){Vu(this,a,l,d,m)};function xt(a,l){var d,m=a.G;if(m)for(d=[];m;m=m.G)d.push(m);if(a=a.M,m=l.type||l,typeof l=="string")l=new T(l,a);else if(l instanceof T)l.target=l.target||a;else{var A=l;l=new T(m,a),Su(l,A)}A=!0;let P,k;if(d)for(k=d.length-1;k>=0;k--)P=l.g=d[k],A=Vs(P,m,!0,l)&&A;if(P=l.g=a,A=Vs(P,m,!0,l)&&A,A=Vs(P,m,!1,l)&&A,d)for(k=0;k<d.length;k++)P=l.g=d[k],A=Vs(P,m,!1,l)&&A}Pt.prototype.N=function(){if(Pt.Z.N.call(this),this.i){var a=this.i;for(const l in a.g){const d=a.g[l];for(let m=0;m<d.length;m++)Rs(d[m]);delete a.g[l],a.h--}}this.G=null},Pt.prototype.J=function(a,l,d,m){return this.i.add(String(a),l,!1,d,m)},Pt.prototype.K=function(a,l,d,m){return this.i.add(String(a),l,!0,d,m)};function Vs(a,l,d,m){if(l=a.i.g[String(l)],!l)return!0;l=l.concat();let A=!0;for(let P=0;P<l.length;++P){const k=l[P];if(k&&!k.da&&k.capture==d){const G=k.listener,yt=k.ha||k.src;k.fa&&Xi(a.i,k),A=G.call(yt,m)!==!1&&A}}return A&&!m.defaultPrevented}function fm(a,l){if(typeof a!="function")if(a&&typeof a.handleEvent=="function")a=h(a.handleEvent,a);else throw Error("Invalid listener argument");return Number(l)>2147483647?-1:o.setTimeout(a,l||0)}function xu(a){a.g=fm(()=>{a.g=null,a.i&&(a.i=!1,xu(a))},a.l);const l=a.h;a.h=null,a.m.apply(null,l)}class mm extends w{constructor(l,d){super(),this.m=l,this.l=d,this.h=null,this.i=!1,this.g=null}j(l){this.h=arguments,this.g?this.i=!0:xu(this)}N(){super.N(),this.g&&(o.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function fr(a){w.call(this),this.h=a,this.g={}}p(fr,w);var Nu=[];function ku(a){Ss(a.g,function(l,d){this.g.hasOwnProperty(d)&&eo(l)},a),a.g={}}fr.prototype.N=function(){fr.Z.N.call(this),ku(this)},fr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var so=o.JSON.stringify,pm=o.JSON.parse,gm=class{stringify(a){return o.JSON.stringify(a,void 0)}parse(a){return o.JSON.parse(a,void 0)}};function Mu(){}function Ou(){}var mr={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function io(){T.call(this,"d")}p(io,T);function oo(){T.call(this,"c")}p(oo,T);var ze={},Fu=null;function Cs(){return Fu=Fu||new Pt}ze.Ia="serverreachability";function Lu(a){T.call(this,ze.Ia,a)}p(Lu,T);function pr(a){const l=Cs();xt(l,new Lu(l))}ze.STAT_EVENT="statevent";function Bu(a,l){T.call(this,ze.STAT_EVENT,a),this.stat=l}p(Bu,T);function Nt(a){const l=Cs();xt(l,new Bu(l,a))}ze.Ja="timingevent";function Uu(a,l){T.call(this,ze.Ja,a),this.size=l}p(Uu,T);function gr(a,l){if(typeof a!="function")throw Error("Fn must not be null and must be a function");return o.setTimeout(function(){a()},l)}function _r(){this.g=!0}_r.prototype.ua=function(){this.g=!1};function _m(a,l,d,m,A,P){a.info(function(){if(a.g)if(P){var k="",G=P.split("&");for(let rt=0;rt<G.length;rt++){var yt=G[rt].split("=");if(yt.length>1){const Et=yt[0];yt=yt[1];const Ht=Et.split("_");k=Ht.length>=2&&Ht[1]=="type"?k+(Et+"="+yt+"&"):k+(Et+"=redacted&")}}}else k=null;else k=P;return"XMLHTTP REQ ("+m+") [attempt "+A+"]: "+l+`
`+d+`
`+k})}function ym(a,l,d,m,A,P,k){a.info(function(){return"XMLHTTP RESP ("+m+") [ attempt "+A+"]: "+l+`
`+d+`
`+P+" "+k})}function Tn(a,l,d,m){a.info(function(){return"XMLHTTP TEXT ("+l+"): "+Em(a,d)+(m?" "+m:"")})}function Im(a,l){a.info(function(){return"TIMEOUT: "+l})}_r.prototype.info=function(){};function Em(a,l){if(!a.g)return l;if(!l)return null;try{const P=JSON.parse(l);if(P){for(a=0;a<P.length;a++)if(Array.isArray(P[a])){var d=P[a];if(!(d.length<2)){var m=d[1];if(Array.isArray(m)&&!(m.length<1)){var A=m[0];if(A!="noop"&&A!="stop"&&A!="close")for(let k=1;k<m.length;k++)m[k]=""}}}}return so(P)}catch{return l}}var Ds={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},qu={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},ju;function ao(){}p(ao,Mu),ao.prototype.g=function(){return new XMLHttpRequest},ju=new ao;function yr(a){return encodeURIComponent(String(a))}function Tm(a){var l=1;a=a.split(":");const d=[];for(;l>0&&a.length;)d.push(a.shift()),l--;return a.length&&d.push(a.join(":")),d}function pe(a,l,d,m){this.j=a,this.i=l,this.l=d,this.S=m||1,this.V=new fr(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new zu}function zu(){this.i=null,this.g="",this.h=!1}var $u={},uo={};function co(a,l,d){a.M=1,a.A=Ns(Wt(l)),a.u=d,a.R=!0,Gu(a,null)}function Gu(a,l){a.F=Date.now(),xs(a),a.B=Wt(a.A);var d=a.B,m=a.S;Array.isArray(m)||(m=[String(m)]),sc(d.i,"t",m),a.C=0,d=a.j.L,a.h=new zu,a.g=wc(a.j,d?l:null,!a.u),a.P>0&&(a.O=new mm(h(a.Y,a,a.g),a.P)),l=a.V,d=a.g,m=a.ba;var A="readystatechange";Array.isArray(A)||(A&&(Nu[0]=A.toString()),A=Nu);for(let P=0;P<A.length;P++){const k=Pu(d,A[P],m||l.handleEvent,!1,l.h||l);if(!k)break;l.g[k.key]=k}l=a.J?bu(a.J):{},a.u?(a.v||(a.v="POST"),l["Content-Type"]="application/x-www-form-urlencoded",a.g.ea(a.B,a.v,a.u,l)):(a.v="GET",a.g.ea(a.B,a.v,null,l)),pr(),_m(a.i,a.v,a.B,a.l,a.S,a.u)}pe.prototype.ba=function(a){a=a.target;const l=this.O;l&&ye(a)==3?l.j():this.Y(a)},pe.prototype.Y=function(a){try{if(a==this.g)t:{const G=ye(this.g),yt=this.g.ya(),rt=this.g.ca();if(!(G<3)&&(G!=3||this.g&&(this.h.h||this.g.la()||hc(this.g)))){this.K||G!=4||yt==7||(yt==8||rt<=0?pr(3):pr(2)),lo(this);var l=this.g.ca();this.X=l;var d=wm(this);if(this.o=l==200,ym(this.i,this.v,this.B,this.l,this.S,G,l),this.o){if(this.U&&!this.L){e:{if(this.g){var m,A=this.g;if((m=A.g?A.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!y(m)){var P=m;break e}}P=null}if(a=P)Tn(this.i,this.l,a,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,ho(this,a);else{this.o=!1,this.m=3,Nt(12),$e(this),Ir(this);break t}}if(this.R){a=!0;let Et;for(;!this.K&&this.C<d.length;)if(Et=vm(this,d),Et==uo){G==4&&(this.m=4,Nt(14),a=!1),Tn(this.i,this.l,null,"[Incomplete Response]");break}else if(Et==$u){this.m=4,Nt(15),Tn(this.i,this.l,d,"[Invalid Chunk]"),a=!1;break}else Tn(this.i,this.l,Et,null),ho(this,Et);if(Ku(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),G!=4||d.length!=0||this.h.h||(this.m=1,Nt(16),a=!1),this.o=this.o&&a,!a)Tn(this.i,this.l,d,"[Invalid Chunked Response]"),$e(this),Ir(this);else if(d.length>0&&!this.W){this.W=!0;var k=this.j;k.g==this&&k.aa&&!k.P&&(k.j.info("Great, no buffering proxy detected. Bytes received: "+d.length),Eo(k),k.P=!0,Nt(11))}}else Tn(this.i,this.l,d,null),ho(this,d);G==4&&$e(this),this.o&&!this.K&&(G==4?yc(this.j,this):(this.o=!1,xs(this)))}else Fm(this.g),l==400&&d.indexOf("Unknown SID")>0?(this.m=3,Nt(12)):(this.m=0,Nt(13)),$e(this),Ir(this)}}}catch{}};function wm(a){if(!Ku(a))return a.g.la();const l=hc(a.g);if(l==="")return"";let d="";const m=l.length,A=ye(a.g)==4;if(!a.h.i){if(typeof TextDecoder>"u")return $e(a),Ir(a),"";a.h.i=new o.TextDecoder}for(let P=0;P<m;P++)a.h.h=!0,d+=a.h.i.decode(l[P],{stream:!(A&&P==m-1)});return l.length=0,a.h.g+=d,a.C=0,a.h.g}function Ku(a){return a.g?a.v=="GET"&&a.M!=2&&a.j.Aa:!1}function vm(a,l){var d=a.C,m=l.indexOf(`
`,d);return m==-1?uo:(d=Number(l.substring(d,m)),isNaN(d)?$u:(m+=1,m+d>l.length?uo:(l=l.slice(m,m+d),a.C=m+d,l)))}pe.prototype.cancel=function(){this.K=!0,$e(this)};function xs(a){a.T=Date.now()+a.H,Qu(a,a.H)}function Qu(a,l){if(a.D!=null)throw Error("WatchDog timer not null");a.D=gr(h(a.aa,a),l)}function lo(a){a.D&&(o.clearTimeout(a.D),a.D=null)}pe.prototype.aa=function(){this.D=null;const a=Date.now();a-this.T>=0?(Im(this.i,this.B),this.M!=2&&(pr(),Nt(17)),$e(this),this.m=2,Ir(this)):Qu(this,this.T-a)};function Ir(a){a.j.I==0||a.K||yc(a.j,a)}function $e(a){lo(a);var l=a.O;l&&typeof l.dispose=="function"&&l.dispose(),a.O=null,ku(a.V),a.g&&(l=a.g,a.g=null,l.abort(),l.dispose())}function ho(a,l){try{var d=a.j;if(d.I!=0&&(d.g==a||fo(d.h,a))){if(!a.L&&fo(d.h,a)&&d.I==3){try{var m=d.Ba.g.parse(l)}catch{m=null}if(Array.isArray(m)&&m.length==3){var A=m;if(A[0]==0){t:if(!d.v){if(d.g)if(d.g.F+3e3<a.F)Ls(d),Os(d);else break t;Io(d),Nt(18)}}else d.xa=A[1],0<d.xa-d.K&&A[2]<37500&&d.F&&d.A==0&&!d.C&&(d.C=gr(h(d.Va,d),6e3));Ju(d.h)<=1&&d.ta&&(d.ta=void 0)}else Ke(d,11)}else if((a.L||d.g==a)&&Ls(d),!y(l))for(A=d.Ba.g.parse(l),l=0;l<A.length;l++){let rt=A[l];const Et=rt[0];if(!(Et<=d.K))if(d.K=Et,rt=rt[1],d.I==2)if(rt[0]=="c"){d.M=rt[1],d.ba=rt[2];const Ht=rt[3];Ht!=null&&(d.ka=Ht,d.j.info("VER="+d.ka));const Qe=rt[4];Qe!=null&&(d.za=Qe,d.j.info("SVER="+d.za));const Ie=rt[5];Ie!=null&&typeof Ie=="number"&&Ie>0&&(m=1.5*Ie,d.O=m,d.j.info("backChannelRequestTimeoutMs_="+m)),m=d;const Ee=a.g;if(Ee){const Us=Ee.g?Ee.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Us){var P=m.h;P.g||Us.indexOf("spdy")==-1&&Us.indexOf("quic")==-1&&Us.indexOf("h2")==-1||(P.j=P.l,P.g=new Set,P.h&&(mo(P,P.h),P.h=null))}if(m.G){const To=Ee.g?Ee.g.getResponseHeader("X-HTTP-Session-Id"):null;To&&(m.wa=To,it(m.J,m.G,To))}}d.I=3,d.l&&d.l.ra(),d.aa&&(d.T=Date.now()-a.F,d.j.info("Handshake RTT: "+d.T+"ms")),m=d;var k=a;if(m.na=Tc(m,m.L?m.ba:null,m.W),k.L){Xu(m.h,k);var G=k,yt=m.O;yt&&(G.H=yt),G.D&&(lo(G),xs(G)),m.g=k}else gc(m);d.i.length>0&&Fs(d)}else rt[0]!="stop"&&rt[0]!="close"||Ke(d,7);else d.I==3&&(rt[0]=="stop"||rt[0]=="close"?rt[0]=="stop"?Ke(d,7):yo(d):rt[0]!="noop"&&d.l&&d.l.qa(rt),d.A=0)}}pr(4)}catch{}}var Am=class{constructor(a,l){this.g=a,this.map=l}};function Wu(a){this.l=a||10,o.PerformanceNavigationTiming?(a=o.performance.getEntriesByType("navigation"),a=a.length>0&&(a[0].nextHopProtocol=="hq"||a[0].nextHopProtocol=="h2")):a=!!(o.chrome&&o.chrome.loadTimes&&o.chrome.loadTimes()&&o.chrome.loadTimes().wasFetchedViaSpdy),this.j=a?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function Hu(a){return a.h?!0:a.g?a.g.size>=a.j:!1}function Ju(a){return a.h?1:a.g?a.g.size:0}function fo(a,l){return a.h?a.h==l:a.g?a.g.has(l):!1}function mo(a,l){a.g?a.g.add(l):a.h=l}function Xu(a,l){a.h&&a.h==l?a.h=null:a.g&&a.g.has(l)&&a.g.delete(l)}Wu.prototype.cancel=function(){if(this.i=Yu(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const a of this.g.values())a.cancel();this.g.clear()}};function Yu(a){if(a.h!=null)return a.i.concat(a.h.G);if(a.g!=null&&a.g.size!==0){let l=a.i;for(const d of a.g.values())l=l.concat(d.G);return l}return R(a.i)}var Zu=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function bm(a,l){if(a){a=a.split("&");for(let d=0;d<a.length;d++){const m=a[d].indexOf("=");let A,P=null;m>=0?(A=a[d].substring(0,m),P=a[d].substring(m+1)):A=a[d],l(A,P?decodeURIComponent(P.replace(/\+/g," ")):"")}}}function ge(a){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let l;a instanceof ge?(this.l=a.l,Er(this,a.j),this.o=a.o,this.g=a.g,Tr(this,a.u),this.h=a.h,po(this,ic(a.i)),this.m=a.m):a&&(l=String(a).match(Zu))?(this.l=!1,Er(this,l[1]||"",!0),this.o=wr(l[2]||""),this.g=wr(l[3]||"",!0),Tr(this,l[4]),this.h=wr(l[5]||"",!0),po(this,l[6]||"",!0),this.m=wr(l[7]||"")):(this.l=!1,this.i=new Ar(null,this.l))}ge.prototype.toString=function(){const a=[];var l=this.j;l&&a.push(vr(l,tc,!0),":");var d=this.g;return(d||l=="file")&&(a.push("//"),(l=this.o)&&a.push(vr(l,tc,!0),"@"),a.push(yr(d).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),d=this.u,d!=null&&a.push(":",String(d))),(d=this.h)&&(this.g&&d.charAt(0)!="/"&&a.push("/"),a.push(vr(d,d.charAt(0)=="/"?Pm:Sm,!0))),(d=this.i.toString())&&a.push("?",d),(d=this.m)&&a.push("#",vr(d,Cm)),a.join("")},ge.prototype.resolve=function(a){const l=Wt(this);let d=!!a.j;d?Er(l,a.j):d=!!a.o,d?l.o=a.o:d=!!a.g,d?l.g=a.g:d=a.u!=null;var m=a.h;if(d)Tr(l,a.u);else if(d=!!a.h){if(m.charAt(0)!="/")if(this.g&&!this.h)m="/"+m;else{var A=l.h.lastIndexOf("/");A!=-1&&(m=l.h.slice(0,A+1)+m)}if(A=m,A==".."||A==".")m="";else if(A.indexOf("./")!=-1||A.indexOf("/.")!=-1){m=A.lastIndexOf("/",0)==0,A=A.split("/");const P=[];for(let k=0;k<A.length;){const G=A[k++];G=="."?m&&k==A.length&&P.push(""):G==".."?((P.length>1||P.length==1&&P[0]!="")&&P.pop(),m&&k==A.length&&P.push("")):(P.push(G),m=!0)}m=P.join("/")}else m=A}return d?l.h=m:d=a.i.toString()!=="",d?po(l,ic(a.i)):d=!!a.m,d&&(l.m=a.m),l};function Wt(a){return new ge(a)}function Er(a,l,d){a.j=d?wr(l,!0):l,a.j&&(a.j=a.j.replace(/:$/,""))}function Tr(a,l){if(l){if(l=Number(l),isNaN(l)||l<0)throw Error("Bad port number "+l);a.u=l}else a.u=null}function po(a,l,d){l instanceof Ar?(a.i=l,Dm(a.i,a.l)):(d||(l=vr(l,Vm)),a.i=new Ar(l,a.l))}function it(a,l,d){a.i.set(l,d)}function Ns(a){return it(a,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),a}function wr(a,l){return a?l?decodeURI(a.replace(/%25/g,"%2525")):decodeURIComponent(a):""}function vr(a,l,d){return typeof a=="string"?(a=encodeURI(a).replace(l,Rm),d&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null}function Rm(a){return a=a.charCodeAt(0),"%"+(a>>4&15).toString(16)+(a&15).toString(16)}var tc=/[#\/\?@]/g,Sm=/[#\?:]/g,Pm=/[#\?]/g,Vm=/[#\?@]/g,Cm=/#/g;function Ar(a,l){this.h=this.g=null,this.i=a||null,this.j=!!l}function Ge(a){a.g||(a.g=new Map,a.h=0,a.i&&bm(a.i,function(l,d){a.add(decodeURIComponent(l.replace(/\+/g," ")),d)}))}r=Ar.prototype,r.add=function(a,l){Ge(this),this.i=null,a=wn(this,a);let d=this.g.get(a);return d||this.g.set(a,d=[]),d.push(l),this.h+=1,this};function ec(a,l){Ge(a),l=wn(a,l),a.g.has(l)&&(a.i=null,a.h-=a.g.get(l).length,a.g.delete(l))}function nc(a,l){return Ge(a),l=wn(a,l),a.g.has(l)}r.forEach=function(a,l){Ge(this),this.g.forEach(function(d,m){d.forEach(function(A){a.call(l,A,m,this)},this)},this)};function rc(a,l){Ge(a);let d=[];if(typeof l=="string")nc(a,l)&&(d=d.concat(a.g.get(wn(a,l))));else for(a=Array.from(a.g.values()),l=0;l<a.length;l++)d=d.concat(a[l]);return d}r.set=function(a,l){return Ge(this),this.i=null,a=wn(this,a),nc(this,a)&&(this.h-=this.g.get(a).length),this.g.set(a,[l]),this.h+=1,this},r.get=function(a,l){return a?(a=rc(this,a),a.length>0?String(a[0]):l):l};function sc(a,l,d){ec(a,l),d.length>0&&(a.i=null,a.g.set(wn(a,l),R(d)),a.h+=d.length)}r.toString=function(){if(this.i)return this.i;if(!this.g)return"";const a=[],l=Array.from(this.g.keys());for(let m=0;m<l.length;m++){var d=l[m];const A=yr(d);d=rc(this,d);for(let P=0;P<d.length;P++){let k=A;d[P]!==""&&(k+="="+yr(d[P])),a.push(k)}}return this.i=a.join("&")};function ic(a){const l=new Ar;return l.i=a.i,a.g&&(l.g=new Map(a.g),l.h=a.h),l}function wn(a,l){return l=String(l),a.j&&(l=l.toLowerCase()),l}function Dm(a,l){l&&!a.j&&(Ge(a),a.i=null,a.g.forEach(function(d,m){const A=m.toLowerCase();m!=A&&(ec(this,m),sc(this,A,d))},a)),a.j=l}function xm(a,l){const d=new _r;if(o.Image){const m=new Image;m.onload=f(_e,d,"TestLoadImage: loaded",!0,l,m),m.onerror=f(_e,d,"TestLoadImage: error",!1,l,m),m.onabort=f(_e,d,"TestLoadImage: abort",!1,l,m),m.ontimeout=f(_e,d,"TestLoadImage: timeout",!1,l,m),o.setTimeout(function(){m.ontimeout&&m.ontimeout()},1e4),m.src=a}else l(!1)}function Nm(a,l){const d=new _r,m=new AbortController,A=setTimeout(()=>{m.abort(),_e(d,"TestPingServer: timeout",!1,l)},1e4);fetch(a,{signal:m.signal}).then(P=>{clearTimeout(A),P.ok?_e(d,"TestPingServer: ok",!0,l):_e(d,"TestPingServer: server error",!1,l)}).catch(()=>{clearTimeout(A),_e(d,"TestPingServer: error",!1,l)})}function _e(a,l,d,m,A){try{A&&(A.onload=null,A.onerror=null,A.onabort=null,A.ontimeout=null),m(d)}catch{}}function km(){this.g=new gm}function go(a){this.i=a.Sb||null,this.h=a.ab||!1}p(go,Mu),go.prototype.g=function(){return new ks(this.i,this.h)};function ks(a,l){Pt.call(this),this.H=a,this.o=l,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}p(ks,Pt),r=ks.prototype,r.open=function(a,l){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=a,this.D=l,this.readyState=1,Rr(this)},r.send=function(a){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const l={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};a&&(l.body=a),(this.H||o).fetch(new Request(this.D,l)).then(this.Pa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,br(this)),this.readyState=0},r.Pa=function(a){if(this.g&&(this.l=a,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=a.headers,this.readyState=2,Rr(this)),this.g&&(this.readyState=3,Rr(this),this.g)))if(this.responseType==="arraybuffer")a.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof o.ReadableStream<"u"&&"body"in a){if(this.j=a.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;oc(this)}else a.text().then(this.Oa.bind(this),this.ga.bind(this))};function oc(a){a.j.read().then(a.Ma.bind(a)).catch(a.ga.bind(a))}r.Ma=function(a){if(this.g){if(this.o&&a.value)this.response.push(a.value);else if(!this.o){var l=a.value?a.value:new Uint8Array(0);(l=this.B.decode(l,{stream:!a.done}))&&(this.response=this.responseText+=l)}a.done?br(this):Rr(this),this.readyState==3&&oc(this)}},r.Oa=function(a){this.g&&(this.response=this.responseText=a,br(this))},r.Na=function(a){this.g&&(this.response=a,br(this))},r.ga=function(){this.g&&br(this)};function br(a){a.readyState=4,a.l=null,a.j=null,a.B=null,Rr(a)}r.setRequestHeader=function(a,l){this.A.append(a,l)},r.getResponseHeader=function(a){return this.h&&this.h.get(a.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const a=[],l=this.h.entries();for(var d=l.next();!d.done;)d=d.value,a.push(d[0]+": "+d[1]),d=l.next();return a.join(`\r
`)};function Rr(a){a.onreadystatechange&&a.onreadystatechange.call(a)}Object.defineProperty(ks.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(a){this.m=a?"include":"same-origin"}});function ac(a){let l="";return Ss(a,function(d,m){l+=m,l+=":",l+=d,l+=`\r
`}),l}function _o(a,l,d){t:{for(m in d){var m=!1;break t}m=!0}m||(d=ac(d),typeof a=="string"?d!=null&&yr(d):it(a,l,d))}function lt(a){Pt.call(this),this.headers=new Map,this.L=a||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}p(lt,Pt);var Mm=/^https?$/i,Om=["POST","PUT"];r=lt.prototype,r.Fa=function(a){this.H=a},r.ea=function(a,l,d,m){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+a);l=l?l.toUpperCase():"GET",this.D=a,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():ju.g(),this.g.onreadystatechange=_(h(this.Ca,this));try{this.B=!0,this.g.open(l,String(a),!0),this.B=!1}catch(P){uc(this,P);return}if(a=d||"",d=new Map(this.headers),m)if(Object.getPrototypeOf(m)===Object.prototype)for(var A in m)d.set(A,m[A]);else if(typeof m.keys=="function"&&typeof m.get=="function")for(const P of m.keys())d.set(P,m.get(P));else throw Error("Unknown input type for opt_headers: "+String(m));m=Array.from(d.keys()).find(P=>P.toLowerCase()=="content-type"),A=o.FormData&&a instanceof o.FormData,!(Array.prototype.indexOf.call(Om,l,void 0)>=0)||m||A||d.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[P,k]of d)this.g.setRequestHeader(P,k);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(a),this.v=!1}catch(P){uc(this,P)}};function uc(a,l){a.h=!1,a.g&&(a.j=!0,a.g.abort(),a.j=!1),a.l=l,a.o=5,cc(a),Ms(a)}function cc(a){a.A||(a.A=!0,xt(a,"complete"),xt(a,"error"))}r.abort=function(a){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=a||7,xt(this,"complete"),xt(this,"abort"),Ms(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Ms(this,!0)),lt.Z.N.call(this)},r.Ca=function(){this.u||(this.B||this.v||this.j?lc(this):this.Xa())},r.Xa=function(){lc(this)};function lc(a){if(a.h&&typeof i<"u"){if(a.v&&ye(a)==4)setTimeout(a.Ca.bind(a),0);else if(xt(a,"readystatechange"),ye(a)==4){a.h=!1;try{const P=a.ca();t:switch(P){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var l=!0;break t;default:l=!1}var d;if(!(d=l)){var m;if(m=P===0){let k=String(a.D).match(Zu)[1]||null;!k&&o.self&&o.self.location&&(k=o.self.location.protocol.slice(0,-1)),m=!Mm.test(k?k.toLowerCase():"")}d=m}if(d)xt(a,"complete"),xt(a,"success");else{a.o=6;try{var A=ye(a)>2?a.g.statusText:""}catch{A=""}a.l=A+" ["+a.ca()+"]",cc(a)}}finally{Ms(a)}}}}function Ms(a,l){if(a.g){a.m&&(clearTimeout(a.m),a.m=null);const d=a.g;a.g=null,l||xt(a,"ready");try{d.onreadystatechange=null}catch{}}}r.isActive=function(){return!!this.g};function ye(a){return a.g?a.g.readyState:0}r.ca=function(){try{return ye(this)>2?this.g.status:-1}catch{return-1}},r.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.La=function(a){if(this.g){var l=this.g.responseText;return a&&l.indexOf(a)==0&&(l=l.substring(a.length)),pm(l)}};function hc(a){try{if(!a.g)return null;if("response"in a.g)return a.g.response;switch(a.F){case"":case"text":return a.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in a.g)return a.g.mozResponseArrayBuffer}return null}catch{return null}}function Fm(a){const l={};a=(a.g&&ye(a)>=2&&a.g.getAllResponseHeaders()||"").split(`\r
`);for(let m=0;m<a.length;m++){if(y(a[m]))continue;var d=Tm(a[m]);const A=d[0];if(d=d[1],typeof d!="string")continue;d=d.trim();const P=l[A]||[];l[A]=P,P.push(d)}cm(l,function(m){return m.join(", ")})}r.ya=function(){return this.o},r.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function Sr(a,l,d){return d&&d.internalChannelParams&&d.internalChannelParams[a]||l}function dc(a){this.za=0,this.i=[],this.j=new _r,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Sr("failFast",!1,a),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Sr("baseRetryDelayMs",5e3,a),this.Za=Sr("retryDelaySeedMs",1e4,a),this.Ta=Sr("forwardChannelMaxRetries",2,a),this.va=Sr("forwardChannelRequestTimeoutMs",2e4,a),this.ma=a&&a.xmlHttpFactory||void 0,this.Ua=a&&a.Rb||void 0,this.Aa=a&&a.useFetchStreams||!1,this.O=void 0,this.L=a&&a.supportsCrossDomainXhr||!1,this.M="",this.h=new Wu(a&&a.concurrentRequestLimit),this.Ba=new km,this.S=a&&a.fastHandshake||!1,this.R=a&&a.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=a&&a.Pb||!1,a&&a.ua&&this.j.ua(),a&&a.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&a&&a.detectBufferingProxy||!1,this.ia=void 0,a&&a.longPollingTimeout&&a.longPollingTimeout>0&&(this.ia=a.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}r=dc.prototype,r.ka=8,r.I=1,r.connect=function(a,l,d,m){Nt(0),this.W=a,this.H=l||{},d&&m!==void 0&&(this.H.OSID=d,this.H.OAID=m),this.F=this.X,this.J=Tc(this,null,this.W),Fs(this)};function yo(a){if(fc(a),a.I==3){var l=a.V++,d=Wt(a.J);if(it(d,"SID",a.M),it(d,"RID",l),it(d,"TYPE","terminate"),Pr(a,d),l=new pe(a,a.j,l),l.M=2,l.A=Ns(Wt(d)),d=!1,o.navigator&&o.navigator.sendBeacon)try{d=o.navigator.sendBeacon(l.A.toString(),"")}catch{}!d&&o.Image&&(new Image().src=l.A,d=!0),d||(l.g=wc(l.j,null),l.g.ea(l.A)),l.F=Date.now(),xs(l)}Ec(a)}function Os(a){a.g&&(Eo(a),a.g.cancel(),a.g=null)}function fc(a){Os(a),a.v&&(o.clearTimeout(a.v),a.v=null),Ls(a),a.h.cancel(),a.m&&(typeof a.m=="number"&&o.clearTimeout(a.m),a.m=null)}function Fs(a){if(!Hu(a.h)&&!a.m){a.m=!0;var l=a.Ea;X||g(),H||(X(),H=!0),E.add(l,a),a.D=0}}function Lm(a,l){return Ju(a.h)>=a.h.j-(a.m?1:0)?!1:a.m?(a.i=l.G.concat(a.i),!0):a.I==1||a.I==2||a.D>=(a.Sa?0:a.Ta)?!1:(a.m=gr(h(a.Ea,a,l),Ic(a,a.D)),a.D++,!0)}r.Ea=function(a){if(this.m)if(this.m=null,this.I==1){if(!a){this.V=Math.floor(Math.random()*1e5),a=this.V++;const A=new pe(this,this.j,a);let P=this.o;if(this.U&&(P?(P=bu(P),Su(P,this.U)):P=this.U),this.u!==null||this.R||(A.J=P,P=null),this.S)t:{for(var l=0,d=0;d<this.i.length;d++){e:{var m=this.i[d];if("__data__"in m.map&&(m=m.map.__data__,typeof m=="string")){m=m.length;break e}m=void 0}if(m===void 0)break;if(l+=m,l>4096){l=d;break t}if(l===4096||d===this.i.length-1){l=d+1;break t}}l=1e3}else l=1e3;l=pc(this,A,l),d=Wt(this.J),it(d,"RID",a),it(d,"CVER",22),this.G&&it(d,"X-HTTP-Session-Id",this.G),Pr(this,d),P&&(this.R?l="headers="+yr(ac(P))+"&"+l:this.u&&_o(d,this.u,P)),mo(this.h,A),this.Ra&&it(d,"TYPE","init"),this.S?(it(d,"$req",l),it(d,"SID","null"),A.U=!0,co(A,d,null)):co(A,d,l),this.I=2}}else this.I==3&&(a?mc(this,a):this.i.length==0||Hu(this.h)||mc(this))};function mc(a,l){var d;l?d=l.l:d=a.V++;const m=Wt(a.J);it(m,"SID",a.M),it(m,"RID",d),it(m,"AID",a.K),Pr(a,m),a.u&&a.o&&_o(m,a.u,a.o),d=new pe(a,a.j,d,a.D+1),a.u===null&&(d.J=a.o),l&&(a.i=l.G.concat(a.i)),l=pc(a,d,1e3),d.H=Math.round(a.va*.5)+Math.round(a.va*.5*Math.random()),mo(a.h,d),co(d,m,l)}function Pr(a,l){a.H&&Ss(a.H,function(d,m){it(l,m,d)}),a.l&&Ss({},function(d,m){it(l,m,d)})}function pc(a,l,d){d=Math.min(a.i.length,d);const m=a.l?h(a.l.Ka,a.l,a):null;t:{var A=a.i;let G=-1;for(;;){const yt=["count="+d];G==-1?d>0?(G=A[0].g,yt.push("ofs="+G)):G=0:yt.push("ofs="+G);let rt=!0;for(let Et=0;Et<d;Et++){var P=A[Et].g;const Ht=A[Et].map;if(P-=G,P<0)G=Math.max(0,A[Et].g-100),rt=!1;else try{P="req"+P+"_"||"";try{var k=Ht instanceof Map?Ht:Object.entries(Ht);for(const[Qe,Ie]of k){let Ee=Ie;u(Ie)&&(Ee=so(Ie)),yt.push(P+Qe+"="+encodeURIComponent(Ee))}}catch(Qe){throw yt.push(P+"type="+encodeURIComponent("_badmap")),Qe}}catch{m&&m(Ht)}}if(rt){k=yt.join("&");break t}}k=void 0}return a=a.i.splice(0,d),l.G=a,k}function gc(a){if(!a.g&&!a.v){a.Y=1;var l=a.Da;X||g(),H||(X(),H=!0),E.add(l,a),a.A=0}}function Io(a){return a.g||a.v||a.A>=3?!1:(a.Y++,a.v=gr(h(a.Da,a),Ic(a,a.A)),a.A++,!0)}r.Da=function(){if(this.v=null,_c(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var a=4*this.T;this.j.info("BP detection timer enabled: "+a),this.B=gr(h(this.Wa,this),a)}},r.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,Nt(10),Os(this),_c(this))};function Eo(a){a.B!=null&&(o.clearTimeout(a.B),a.B=null)}function _c(a){a.g=new pe(a,a.j,"rpc",a.Y),a.u===null&&(a.g.J=a.o),a.g.P=0;var l=Wt(a.na);it(l,"RID","rpc"),it(l,"SID",a.M),it(l,"AID",a.K),it(l,"CI",a.F?"0":"1"),!a.F&&a.ia&&it(l,"TO",a.ia),it(l,"TYPE","xmlhttp"),Pr(a,l),a.u&&a.o&&_o(l,a.u,a.o),a.O&&(a.g.H=a.O);var d=a.g;a=a.ba,d.M=1,d.A=Ns(Wt(l)),d.u=null,d.R=!0,Gu(d,a)}r.Va=function(){this.C!=null&&(this.C=null,Os(this),Io(this),Nt(19))};function Ls(a){a.C!=null&&(o.clearTimeout(a.C),a.C=null)}function yc(a,l){var d=null;if(a.g==l){Ls(a),Eo(a),a.g=null;var m=2}else if(fo(a.h,l))d=l.G,Xu(a.h,l),m=1;else return;if(a.I!=0){if(l.o)if(m==1){d=l.u?l.u.length:0,l=Date.now()-l.F;var A=a.D;m=Cs(),xt(m,new Uu(m,d)),Fs(a)}else gc(a);else if(A=l.m,A==3||A==0&&l.X>0||!(m==1&&Lm(a,l)||m==2&&Io(a)))switch(d&&d.length>0&&(l=a.h,l.i=l.i.concat(d)),A){case 1:Ke(a,5);break;case 4:Ke(a,10);break;case 3:Ke(a,6);break;default:Ke(a,2)}}}function Ic(a,l){let d=a.Qa+Math.floor(Math.random()*a.Za);return a.isActive()||(d*=2),d*l}function Ke(a,l){if(a.j.info("Error code "+l),l==2){var d=h(a.bb,a),m=a.Ua;const A=!m;m=new ge(m||"//www.google.com/images/cleardot.gif"),o.location&&o.location.protocol=="http"||Er(m,"https"),Ns(m),A?xm(m.toString(),d):Nm(m.toString(),d)}else Nt(2);a.I=0,a.l&&a.l.pa(l),Ec(a),fc(a)}r.bb=function(a){a?(this.j.info("Successfully pinged google.com"),Nt(2)):(this.j.info("Failed to ping google.com"),Nt(1))};function Ec(a){if(a.I=0,a.ja=[],a.l){const l=Yu(a.h);(l.length!=0||a.i.length!=0)&&(x(a.ja,l),x(a.ja,a.i),a.h.i.length=0,R(a.i),a.i.length=0),a.l.oa()}}function Tc(a,l,d){var m=d instanceof ge?Wt(d):new ge(d);if(m.g!="")l&&(m.g=l+"."+m.g),Tr(m,m.u);else{var A=o.location;m=A.protocol,l=l?l+"."+A.hostname:A.hostname,A=+A.port;const P=new ge(null);m&&Er(P,m),l&&(P.g=l),A&&Tr(P,A),d&&(P.h=d),m=P}return d=a.G,l=a.wa,d&&l&&it(m,d,l),it(m,"VER",a.ka),Pr(a,m),m}function wc(a,l,d){if(l&&!a.L)throw Error("Can't create secondary domain capable XhrIo object.");return l=a.Aa&&!a.ma?new lt(new go({ab:d})):new lt(a.ma),l.Fa(a.L),l}r.isActive=function(){return!!this.l&&this.l.isActive(this)};function vc(){}r=vc.prototype,r.ra=function(){},r.qa=function(){},r.pa=function(){},r.oa=function(){},r.isActive=function(){return!0},r.Ka=function(){};function Bs(){}Bs.prototype.g=function(a,l){return new Ut(a,l)};function Ut(a,l){Pt.call(this),this.g=new dc(l),this.l=a,this.h=l&&l.messageUrlParams||null,a=l&&l.messageHeaders||null,l&&l.clientProtocolHeaderRequired&&(a?a["X-Client-Protocol"]="webchannel":a={"X-Client-Protocol":"webchannel"}),this.g.o=a,a=l&&l.initMessageHeaders||null,l&&l.messageContentType&&(a?a["X-WebChannel-Content-Type"]=l.messageContentType:a={"X-WebChannel-Content-Type":l.messageContentType}),l&&l.sa&&(a?a["X-WebChannel-Client-Profile"]=l.sa:a={"X-WebChannel-Client-Profile":l.sa}),this.g.U=a,(a=l&&l.Qb)&&!y(a)&&(this.g.u=a),this.A=l&&l.supportsCrossDomainXhr||!1,this.v=l&&l.sendRawJson||!1,(l=l&&l.httpSessionIdParam)&&!y(l)&&(this.g.G=l,a=this.h,a!==null&&l in a&&(a=this.h,l in a&&delete a[l])),this.j=new vn(this)}p(Ut,Pt),Ut.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},Ut.prototype.close=function(){yo(this.g)},Ut.prototype.o=function(a){var l=this.g;if(typeof a=="string"){var d={};d.__data__=a,a=d}else this.v&&(d={},d.__data__=so(a),a=d);l.i.push(new Am(l.Ya++,a)),l.I==3&&Fs(l)},Ut.prototype.N=function(){this.g.l=null,delete this.j,yo(this.g),delete this.g,Ut.Z.N.call(this)};function Ac(a){io.call(this),a.__headers__&&(this.headers=a.__headers__,this.statusCode=a.__status__,delete a.__headers__,delete a.__status__);var l=a.__sm__;if(l){t:{for(const d in l){a=d;break t}a=void 0}(this.i=a)&&(a=this.i,l=l!==null&&a in l?l[a]:void 0),this.data=l}else this.data=a}p(Ac,io);function bc(){oo.call(this),this.status=1}p(bc,oo);function vn(a){this.g=a}p(vn,vc),vn.prototype.ra=function(){xt(this.g,"a")},vn.prototype.qa=function(a){xt(this.g,new Ac(a))},vn.prototype.pa=function(a){xt(this.g,new bc)},vn.prototype.oa=function(){xt(this.g,"b")},Bs.prototype.createWebChannel=Bs.prototype.g,Ut.prototype.send=Ut.prototype.o,Ut.prototype.open=Ut.prototype.m,Ut.prototype.close=Ut.prototype.close,Oh=function(){return new Bs},Mh=function(){return Cs()},kh=ze,Uo={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Ds.NO_ERROR=0,Ds.TIMEOUT=8,Ds.HTTP_ERROR=6,Ws=Ds,qu.COMPLETE="complete",Nh=qu,Ou.EventType=mr,mr.OPEN="a",mr.CLOSE="b",mr.ERROR="c",mr.MESSAGE="d",Pt.prototype.listen=Pt.prototype.J,kr=Ou,lt.prototype.listenOnce=lt.prototype.K,lt.prototype.getLastError=lt.prototype.Ha,lt.prototype.getLastErrorCode=lt.prototype.ya,lt.prototype.getStatus=lt.prototype.ca,lt.prototype.getResponseJson=lt.prototype.La,lt.prototype.getResponseText=lt.prototype.la,lt.prototype.send=lt.prototype.ea,lt.prototype.setWithCredentials=lt.prototype.Fa,xh=lt}).apply(typeof qs<"u"?qs:typeof self<"u"?self:typeof window<"u"?window:{});const Fc="@firebase/firestore",Lc="4.9.3";class wt{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}wt.UNAUTHENTICATED=new wt(null),wt.GOOGLE_CREDENTIALS=new wt("google-credentials-uid"),wt.FIRST_PARTY=new wt("first-party-uid"),wt.MOCK_USER=new wt("mock-user");let sr="12.7.0";const De=new Ih("@firebase/firestore");function Cn(){return De.logLevel}function nE(r){De.setLogLevel(r)}function C(r,...t){if(De.logLevel<=W.DEBUG){const e=t.map(Ia);De.debug(`Firestore (${sr}): ${r}`,...e)}}function ft(r,...t){if(De.logLevel<=W.ERROR){const e=t.map(Ia);De.error(`Firestore (${sr}): ${r}`,...e)}}function ue(r,...t){if(De.logLevel<=W.WARN){const e=t.map(Ia);De.warn(`Firestore (${sr}): ${r}`,...e)}}function Ia(r){if(typeof r=="string")return r;try{return(function(e){return JSON.stringify(e)})(r)}catch{return r}}function F(r,t,e){let n="Unexpected state";typeof t=="string"?n=t:e=t,Fh(r,n,e)}function Fh(r,t,e){let n=`FIRESTORE (${sr}) INTERNAL ASSERTION FAILED: ${t} (ID: ${r.toString(16)})`;if(e!==void 0)try{n+=" CONTEXT: "+JSON.stringify(e)}catch{n+=" CONTEXT: "+e}throw ft(n),new Error(n)}function L(r,t,e,n){let s="Unexpected state";typeof e=="string"?s=e:n=e,r||Fh(t,s,n)}function rE(r,t){r||F(57014,t)}function O(r,t){return r}const S={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class V extends gn{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Rt{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}class Lh{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class wg{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable((()=>e(wt.UNAUTHENTICATED)))}shutdown(){}}class vg{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable((()=>e(this.token.user)))}shutdown(){this.changeListener=null}}class Ag{constructor(t){this.t=t,this.currentUser=wt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){L(this.o===void 0,42304);let n=this.i;const s=c=>this.i!==n?(n=this.i,e(c)):Promise.resolve();let i=new Rt;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Rt,t.enqueueRetryable((()=>s(this.currentUser)))};const o=()=>{const c=i;t.enqueueRetryable((async()=>{await c.promise,await s(this.currentUser)}))},u=c=>{C("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit((c=>u(c))),setTimeout((()=>{if(!this.auth){const c=this.t.getImmediate({optional:!0});c?u(c):(C("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Rt)}}),0),o()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then((n=>this.i!==t?(C("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(L(typeof n.accessToken=="string",31837,{l:n}),new Lh(n.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const t=this.auth&&this.auth.getUid();return L(t===null||typeof t=="string",2055,{h:t}),new wt(t)}}class bg{constructor(t,e,n){this.P=t,this.T=e,this.I=n,this.type="FirstParty",this.user=wt.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const t=this.R();return t&&this.A.set("Authorization",t),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class Rg{constructor(t,e,n){this.P=t,this.T=e,this.I=n}getToken(){return Promise.resolve(new bg(this.P,this.T,this.I))}start(t,e){t.enqueueRetryable((()=>e(wt.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Bc{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Sg{constructor(t,e){this.V=e,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Ah(t)&&t.settings.appCheckToken&&(this.p=t.settings.appCheckToken)}start(t,e){L(this.o===void 0,3512);const n=i=>{i.error!=null&&C("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.m;return this.m=i.token,C("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?e(i.token):Promise.resolve()};this.o=i=>{t.enqueueRetryable((()=>n(i)))};const s=i=>{C("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((i=>s(i))),setTimeout((()=>{if(!this.appCheck){const i=this.V.getImmediate({optional:!0});i?s(i):C("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new Bc(this.p));const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((e=>e?(L(typeof e.token=="string",44558,{tokenResult:e}),this.m=e.token,new Bc(e.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function Pg(r){const t=typeof self<"u"&&(self.crypto||self.msCrypto),e=new Uint8Array(r);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(e);else for(let n=0;n<r;n++)e[n]=Math.floor(256*Math.random());return e}class Ea{static newId(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=62*Math.floor(4.129032258064516);let n="";for(;n.length<20;){const s=Pg(40);for(let i=0;i<s.length;++i)n.length<20&&s[i]<e&&(n+=t.charAt(s[i]%62))}return n}}function z(r,t){return r<t?-1:r>t?1:0}function qo(r,t){const e=Math.min(r.length,t.length);for(let n=0;n<e;n++){const s=r.charAt(n),i=t.charAt(n);if(s!==i)return So(s)===So(i)?z(s,i):So(s)?1:-1}return z(r.length,t.length)}const Vg=55296,Cg=57343;function So(r){const t=r.charCodeAt(0);return t>=Vg&&t<=Cg}function Un(r,t,e){return r.length===t.length&&r.every(((n,s)=>e(n,t[s])))}function Bh(r){return r+"\0"}const Uc="__name__";class Jt{constructor(t,e,n){e===void 0?e=0:e>t.length&&F(637,{offset:e,range:t.length}),n===void 0?n=t.length-e:n>t.length-e&&F(1746,{length:n,range:t.length-e}),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return Jt.comparator(this,t)===0}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof Jt?t.forEach((n=>{e.push(n)})):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const n=Math.min(t.length,e.length);for(let s=0;s<n;s++){const i=Jt.compareSegments(t.get(s),e.get(s));if(i!==0)return i}return z(t.length,e.length)}static compareSegments(t,e){const n=Jt.isNumericId(t),s=Jt.isNumericId(e);return n&&!s?-1:!n&&s?1:n&&s?Jt.extractNumericId(t).compare(Jt.extractNumericId(e)):qo(t,e)}static isNumericId(t){return t.startsWith("__id")&&t.endsWith("__")}static extractNumericId(t){return Pe.fromString(t.substring(4,t.length-2))}}class K extends Jt{construct(t,e,n){return new K(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new V(S.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter((s=>s.length>0)))}return new K(e)}static emptyPath(){return new K([])}}const Dg=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ct extends Jt{construct(t,e,n){return new ct(t,e,n)}static isValidIdentifier(t){return Dg.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ct.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Uc}static keyField(){return new ct([Uc])}static fromServerFormat(t){const e=[];let n="",s=0;const i=()=>{if(n.length===0)throw new V(S.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let o=!1;for(;s<t.length;){const u=t[s];if(u==="\\"){if(s+1===t.length)throw new V(S.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const c=t[s+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new V(S.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=c,s+=2}else u==="`"?(o=!o,s++):u!=="."||o?(n+=u,s++):(i(),s++)}if(i(),o)throw new V(S.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new ct(e)}static emptyPath(){return new ct([])}}class M{constructor(t){this.path=t}static fromPath(t){return new M(K.fromString(t))}static fromName(t){return new M(K.fromString(t).popFirst(5))}static empty(){return new M(K.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&K.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,e){return K.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new M(new K(t.slice()))}}function Ta(r,t,e){if(!e)throw new V(S.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${t}.`)}function xg(r,t,e,n){if(t===!0&&n===!0)throw new V(S.INVALID_ARGUMENT,`${r} and ${e} cannot be used together.`)}function qc(r){if(!M.isDocumentKey(r))throw new V(S.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function jc(r){if(M.isDocumentKey(r))throw new V(S.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function Uh(r){return typeof r=="object"&&r!==null&&(Object.getPrototypeOf(r)===Object.prototype||Object.getPrototypeOf(r)===null)}function bi(r){if(r===void 0)return"undefined";if(r===null)return"null";if(typeof r=="string")return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if(typeof r=="number"||typeof r=="boolean")return""+r;if(typeof r=="object"){if(r instanceof Array)return"an array";{const t=(function(n){return n.constructor?n.constructor.name:null})(r);return t?`a custom ${t} object`:"an object"}}return typeof r=="function"?"a function":F(12329,{type:typeof r})}function Y(r,t){if("_delegate"in r&&(r=r._delegate),!(r instanceof t)){if(t.name===r.constructor.name)throw new V(S.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const e=bi(r);throw new V(S.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${e}`)}}return r}function qh(r,t){if(t<=0)throw new V(S.INVALID_ARGUMENT,`Function ${r}() requires a positive number, but it was: ${t}.`)}function _t(r,t){const e={typeString:r};return t&&(e.value=t),e}function ds(r,t){if(!Uh(r))throw new V(S.INVALID_ARGUMENT,"JSON must be an object");let e;for(const n in t)if(t[n]){const s=t[n].typeString,i="value"in t[n]?{value:t[n].value}:void 0;if(!(n in r)){e=`JSON missing required field: '${n}'`;break}const o=r[n];if(s&&typeof o!==s){e=`JSON field '${n}' must be a ${s}.`;break}if(i!==void 0&&o!==i.value){e=`Expected '${n}' field to equal '${i.value}'`;break}}if(e)throw new V(S.INVALID_ARGUMENT,e);return!0}const zc=-62135596800,$c=1e6;class Z{static now(){return Z.fromMillis(Date.now())}static fromDate(t){return Z.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),n=Math.floor((t-1e3*e)*$c);return new Z(e,n)}constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new V(S.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new V(S.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<zc)throw new V(S.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new V(S.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/$c}_compareTo(t){return this.seconds===t.seconds?z(this.nanoseconds,t.nanoseconds):z(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:Z._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(t){if(ds(t,Z._jsonSchema))return new Z(t.seconds,t.nanoseconds)}valueOf(){const t=this.seconds-zc;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}Z._jsonSchemaVersion="firestore/timestamp/1.0",Z._jsonSchema={type:_t("string",Z._jsonSchemaVersion),seconds:_t("number"),nanoseconds:_t("number")};class B{static fromTimestamp(t){return new B(t)}static min(){return new B(new Z(0,0))}static max(){return new B(new Z(253402300799,999999999))}constructor(t){this.timestamp=t}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const qn=-1;class ci{constructor(t,e,n,s){this.indexId=t,this.collectionGroup=e,this.fields=n,this.indexState=s}}function jo(r){return r.fields.find((t=>t.kind===2))}function Je(r){return r.fields.filter((t=>t.kind!==2))}ci.UNKNOWN_ID=-1;class Hs{constructor(t,e){this.fieldPath=t,this.kind=e}}class Yr{constructor(t,e){this.sequenceNumber=t,this.offset=e}static empty(){return new Yr(0,$t.min())}}function jh(r,t){const e=r.toTimestamp().seconds,n=r.toTimestamp().nanoseconds+1,s=B.fromTimestamp(n===1e9?new Z(e+1,0):new Z(e,n));return new $t(s,M.empty(),t)}function zh(r){return new $t(r.readTime,r.key,qn)}class $t{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new $t(B.min(),M.empty(),qn)}static max(){return new $t(B.max(),M.empty(),qn)}}function wa(r,t){let e=r.readTime.compareTo(t.readTime);return e!==0?e:(e=M.comparator(r.documentKey,t.documentKey),e!==0?e:z(r.largestBatchId,t.largestBatchId))}const $h="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Gh{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((t=>t()))}}async function Fe(r){if(r.code!==S.FAILED_PRECONDITION||r.message!==$h)throw r;C("LocalStore","Unexpectedly lost primary lease")}class v{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)}),(e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)}))}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&F(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new v(((n,s)=>{this.nextCallback=i=>{this.wrapSuccess(t,i).next(n,s)},this.catchCallback=i=>{this.wrapFailure(e,i).next(n,s)}}))}toPromise(){return new Promise(((t,e)=>{this.next(t,e)}))}wrapUserFunction(t){try{const e=t();return e instanceof v?e:v.resolve(e)}catch(e){return v.reject(e)}}wrapSuccess(t,e){return t?this.wrapUserFunction((()=>t(e))):v.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction((()=>t(e))):v.reject(e)}static resolve(t){return new v(((e,n)=>{e(t)}))}static reject(t){return new v(((e,n)=>{n(t)}))}static waitFor(t){return new v(((e,n)=>{let s=0,i=0,o=!1;t.forEach((u=>{++s,u.next((()=>{++i,o&&i===s&&e()}),(c=>n(c)))})),o=!0,i===s&&e()}))}static or(t){let e=v.resolve(!1);for(const n of t)e=e.next((s=>s?v.resolve(s):n()));return e}static forEach(t,e){const n=[];return t.forEach(((s,i)=>{n.push(e.call(this,s,i))})),this.waitFor(n)}static mapArray(t,e){return new v(((n,s)=>{const i=t.length,o=new Array(i);let u=0;for(let c=0;c<i;c++){const h=c;e(t[h]).next((f=>{o[h]=f,++u,u===i&&n(o)}),(f=>s(f)))}}))}static doWhile(t,e){return new v(((n,s)=>{const i=()=>{t()===!0?e().next((()=>{i()}),s):n()};i()}))}}const qt="SimpleDb";class Ri{static open(t,e,n,s){try{return new Ri(e,t.transaction(s,n))}catch(i){throw new Ur(e,i)}}constructor(t,e){this.action=t,this.transaction=e,this.aborted=!1,this.S=new Rt,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{e.error?this.S.reject(new Ur(t,e.error)):this.S.resolve()},this.transaction.onerror=n=>{const s=va(n.target.error);this.S.reject(new Ur(t,s))}}get D(){return this.S.promise}abort(t){t&&this.S.reject(t),this.aborted||(C(qt,"Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}C(){const t=this.transaction;this.aborted||typeof t.commit!="function"||t.commit()}store(t){const e=this.transaction.objectStore(t);return new kg(e)}}class te{static delete(t){return C(qt,"Removing database:",t),Ye(ch().indexedDB.deleteDatabase(t)).toPromise()}static v(){if(!ph())return!1;if(te.F())return!0;const t=ai(),e=te.M(t),n=0<e&&e<10,s=Kh(t),i=0<s&&s<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||n||i)}static F(){return typeof process<"u"&&process.__PRIVATE_env?.__PRIVATE_USE_MOCK_PERSISTENCE==="YES"}static O(t,e){return t.store(e)}static M(t){const e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)}constructor(t,e,n){this.name=t,this.version=e,this.N=n,this.B=null,te.M(ai())===12.2&&ft("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async L(t){return this.db||(C(qt,"Opening database:",this.name),this.db=await new Promise(((e,n)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=i=>{const o=i.target.result;e(o)},s.onblocked=()=>{n(new Ur(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=i=>{const o=i.target.error;o.name==="VersionError"?n(new V(S.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?n(new V(S.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):n(new Ur(t,o))},s.onupgradeneeded=i=>{C(qt,'Database "'+this.name+'" requires upgrade from version:',i.oldVersion);const o=i.target.result;this.N.k(o,s.transaction,i.oldVersion,this.version).next((()=>{C(qt,"Database upgrade to version "+this.version+" complete")}))}}))),this.q&&(this.db.onversionchange=e=>this.q(e)),this.db}$(t){this.q=t,this.db&&(this.db.onversionchange=e=>t(e))}async runTransaction(t,e,n,s){const i=e==="readonly";let o=0;for(;;){++o;try{this.db=await this.L(t);const u=Ri.open(this.db,t,i?"readonly":"readwrite",n),c=s(u).next((h=>(u.C(),h))).catch((h=>(u.abort(h),v.reject(h)))).toPromise();return c.catch((()=>{})),await u.D,c}catch(u){const c=u,h=c.name!=="FirebaseError"&&o<3;if(C(qt,"Transaction failed with error:",c.message,"Retrying:",h),this.close(),!h)return Promise.reject(c)}}}close(){this.db&&this.db.close(),this.db=void 0}}function Kh(r){const t=r.match(/Android ([\d.]+)/i),e=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(e)}class Ng{constructor(t){this.U=t,this.K=!1,this.W=null}get isDone(){return this.K}get G(){return this.W}set cursor(t){this.U=t}done(){this.K=!0}j(t){this.W=t}delete(){return Ye(this.U.delete())}}class Ur extends V{constructor(t,e){super(S.UNAVAILABLE,`IndexedDB transaction '${t}' failed: ${e}`),this.name="IndexedDbTransactionError"}}function Le(r){return r.name==="IndexedDbTransactionError"}class kg{constructor(t){this.store=t}put(t,e){let n;return e!==void 0?(C(qt,"PUT",this.store.name,t,e),n=this.store.put(e,t)):(C(qt,"PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),Ye(n)}add(t){return C(qt,"ADD",this.store.name,t,t),Ye(this.store.add(t))}get(t){return Ye(this.store.get(t)).next((e=>(e===void 0&&(e=null),C(qt,"GET",this.store.name,t,e),e)))}delete(t){return C(qt,"DELETE",this.store.name,t),Ye(this.store.delete(t))}count(){return C(qt,"COUNT",this.store.name),Ye(this.store.count())}J(t,e){const n=this.options(t,e),s=n.index?this.store.index(n.index):this.store;if(typeof s.getAll=="function"){const i=s.getAll(n.range);return new v(((o,u)=>{i.onerror=c=>{u(c.target.error)},i.onsuccess=c=>{o(c.target.result)}}))}{const i=this.cursor(n),o=[];return this.H(i,((u,c)=>{o.push(c)})).next((()=>o))}}Y(t,e){const n=this.store.getAll(t,e===null?void 0:e);return new v(((s,i)=>{n.onerror=o=>{i(o.target.error)},n.onsuccess=o=>{s(o.target.result)}}))}Z(t,e){C(qt,"DELETE ALL",this.store.name);const n=this.options(t,e);n.X=!1;const s=this.cursor(n);return this.H(s,((i,o,u)=>u.delete()))}ee(t,e){let n;e?n=t:(n={},e=t);const s=this.cursor(n);return this.H(s,e)}te(t){const e=this.cursor({});return new v(((n,s)=>{e.onerror=i=>{const o=va(i.target.error);s(o)},e.onsuccess=i=>{const o=i.target.result;o?t(o.primaryKey,o.value).next((u=>{u?o.continue():n()})):n()}}))}H(t,e){const n=[];return new v(((s,i)=>{t.onerror=o=>{i(o.target.error)},t.onsuccess=o=>{const u=o.target.result;if(!u)return void s();const c=new Ng(u),h=e(u.primaryKey,u.value,c);if(h instanceof v){const f=h.catch((p=>(c.done(),v.reject(p))));n.push(f)}c.isDone?s():c.G===null?u.continue():u.continue(c.G)}})).next((()=>v.waitFor(n)))}options(t,e){let n;return t!==void 0&&(typeof t=="string"?n=t:e=t),{index:n,range:e}}cursor(t){let e="next";if(t.reverse&&(e="prev"),t.index){const n=this.store.index(t.index);return t.X?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)}}function Ye(r){return new v(((t,e)=>{r.onsuccess=n=>{const s=n.target.result;t(s)},r.onerror=n=>{const s=va(n.target.error);e(s)}}))}let Gc=!1;function va(r){const t=te.M(ai());if(t>=12.2&&t<13){const e="An internal error was encountered in the Indexed Database server";if(r.message.indexOf(e)>=0){const n=new V("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${e}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Gc||(Gc=!0,setTimeout((()=>{throw n}),0)),n}}return r}const qr="IndexBackfiller";class Mg{constructor(t,e){this.asyncQueue=t,this.ne=e,this.task=null}start(){this.re(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}re(t){C(qr,`Scheduled in ${t}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",t,(async()=>{this.task=null;try{const e=await this.ne.ie();C(qr,`Documents written: ${e}`)}catch(e){Le(e)?C(qr,"Ignoring IndexedDB error during index backfill: ",e):await Fe(e)}await this.re(6e4)}))}}class Og{constructor(t,e){this.localStore=t,this.persistence=e}async ie(t=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",(e=>this.se(e,t)))}se(t,e){const n=new Set;let s=e,i=!0;return v.doWhile((()=>i===!0&&s>0),(()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(t).next((o=>{if(o!==null&&!n.has(o))return C(qr,`Processing collection: ${o}`),this.oe(t,o,s).next((u=>{s-=u,n.add(o)}));i=!1})))).next((()=>e-s))}oe(t,e,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(t,e).next((s=>this.localStore.localDocuments.getNextDocuments(t,e,s,n).next((i=>{const o=i.changes;return this.localStore.indexManager.updateIndexEntries(t,o).next((()=>this._e(s,i))).next((u=>(C(qr,`Updating offset: ${u}`),this.localStore.indexManager.updateCollectionGroup(t,e,u)))).next((()=>o.size))}))))}_e(t,e){let n=t;return e.changes.forEach(((s,i)=>{const o=zh(i);wa(o,n)>0&&(n=o)})),new $t(n.readTime,n.documentKey,Math.max(e.batchId,t.largestBatchId))}}class Ft{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=n=>this.ae(n),this.ue=n=>e.writeSequenceNumber(n))}ae(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.ue&&this.ue(t),t}}Ft.ce=-1;const Ve=-1;function fs(r){return r==null}function Zr(r){return r===0&&1/r==-1/0}function Qh(r){return typeof r=="number"&&Number.isInteger(r)&&!Zr(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}const li="";function Dt(r){let t="";for(let e=0;e<r.length;e++)t.length>0&&(t=Kc(t)),t=Fg(r.get(e),t);return Kc(t)}function Fg(r,t){let e=t;const n=r.length;for(let s=0;s<n;s++){const i=r.charAt(s);switch(i){case"\0":e+="";break;case li:e+="";break;default:e+=i}}return e}function Kc(r){return r+li+""}function Yt(r){const t=r.length;if(L(t>=2,64408,{path:r}),t===2)return L(r.charAt(0)===li&&r.charAt(1)==="",56145,{path:r}),K.emptyPath();const e=t-2,n=[];let s="";for(let i=0;i<t;){const o=r.indexOf(li,i);switch((o<0||o>e)&&F(50515,{path:r}),r.charAt(o+1)){case"":const u=r.substring(i,o);let c;s.length===0?c=u:(s+=u,c=s,s=""),n.push(c);break;case"":s+=r.substring(i,o),s+="\0";break;case"":s+=r.substring(i,o+1);break;default:F(61167,{path:r})}i=o+2}return new K(n)}const Xe="remoteDocuments",ms="owner",An="owner",ts="mutationQueues",Lg="userId",Gt="mutations",Qc="batchId",nn="userMutationsIndex",Wc=["userId","batchId"];function Js(r,t){return[r,Dt(t)]}function Wh(r,t,e){return[r,Dt(t),e]}const Bg={},jn="documentMutations",hi="remoteDocumentsV14",Ug=["prefixPath","collectionGroup","readTime","documentId"],Xs="documentKeyIndex",qg=["prefixPath","collectionGroup","documentId"],Hh="collectionGroupIndex",jg=["collectionGroup","readTime","prefixPath","documentId"],es="remoteDocumentGlobal",zo="remoteDocumentGlobalKey",zn="targets",Jh="queryTargetsIndex",zg=["canonicalId","targetId"],$n="targetDocuments",$g=["targetId","path"],Aa="documentTargetsIndex",Gg=["path","targetId"],di="targetGlobalKey",on="targetGlobal",ns="collectionParents",Kg=["collectionId","parent"],Gn="clientMetadata",Qg="clientId",Si="bundles",Wg="bundleId",Pi="namedQueries",Hg="name",ba="indexConfiguration",Jg="indexId",$o="collectionGroupIndex",Xg="collectionGroup",jr="indexState",Yg=["indexId","uid"],Xh="sequenceNumberIndex",Zg=["uid","sequenceNumber"],zr="indexEntries",t_=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Yh="documentKeyIndex",e_=["indexId","uid","orderedDocumentKey"],Vi="documentOverlays",n_=["userId","collectionPath","documentId"],Go="collectionPathOverlayIndex",r_=["userId","collectionPath","largestBatchId"],Zh="collectionGroupOverlayIndex",s_=["userId","collectionGroup","largestBatchId"],Ra="globals",i_="name",td=[ts,Gt,jn,Xe,zn,ms,on,$n,Gn,es,ns,Si,Pi],o_=[...td,Vi],ed=[ts,Gt,jn,hi,zn,ms,on,$n,Gn,es,ns,Si,Pi,Vi],nd=ed,Sa=[...nd,ba,jr,zr],a_=Sa,rd=[...Sa,Ra],u_=rd;class Ko extends Gh{constructor(t,e){super(),this.le=t,this.currentSequenceNumber=e}}function It(r,t){const e=O(r);return te.O(e.le,t)}function Hc(r){let t=0;for(const e in r)Object.prototype.hasOwnProperty.call(r,e)&&t++;return t}function Be(r,t){for(const e in r)Object.prototype.hasOwnProperty.call(r,e)&&t(e,r[e])}function sd(r){for(const t in r)if(Object.prototype.hasOwnProperty.call(r,t))return!1;return!0}class st{constructor(t,e){this.comparator=t,this.root=e||At.EMPTY}insert(t,e){return new st(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,At.BLACK,null,null))}remove(t){return new st(this.comparator,this.root.remove(t,this.comparator).copy(null,null,At.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const n=this.comparator(t,e.key);if(n===0)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){const s=this.comparator(t,n.key);if(s===0)return e+n.left.size;s<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((e,n)=>(t(e,n),!1)))}toString(){const t=[];return this.inorderTraversal(((e,n)=>(t.push(`${e}:${n}`),!1))),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new js(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new js(this.root,t,this.comparator,!1)}getReverseIterator(){return new js(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new js(this.root,t,this.comparator,!0)}}class js{constructor(t,e,n,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!t.isEmpty();)if(i=e?n(t.key,e):1,e&&s&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(i===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class At{constructor(t,e,n,s,i){this.key=t,this.value=e,this.color=n??At.RED,this.left=s??At.EMPTY,this.right=i??At.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,s,i){return new At(t??this.key,e??this.value,n??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let s=this;const i=n(t,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(t,e,n),null):i===0?s.copy(null,e,null,null,null):s.copy(null,null,null,null,s.right.insert(t,e,n)),s.fixUp()}removeMin(){if(this.left.isEmpty())return At.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,s=this;if(e(t,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,e),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),e(t,s.key)===0){if(s.right.isEmpty())return At.EMPTY;n=s.right.min(),s=s.copy(n.key,n.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,e))}return s.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,At.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,At.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw F(43730,{key:this.key,value:this.value});if(this.right.isRed())throw F(14113,{key:this.key,value:this.value});const t=this.left.check();if(t!==this.right.check())throw F(27949);return t+(this.isRed()?0:1)}}At.EMPTY=null,At.RED=!0,At.BLACK=!1;At.EMPTY=new class{constructor(){this.size=0}get key(){throw F(57766)}get value(){throw F(16141)}get color(){throw F(16727)}get left(){throw F(29726)}get right(){throw F(36894)}copy(t,e,n,s,i){return this}insert(t,e,n){return new At(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class et{constructor(t){this.comparator=t,this.data=new st(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((e,n)=>(t(e),!1)))}forEachInRange(t,e){const n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){const s=n.getNext();if(this.comparator(s.key,t[1])>=0)return;e(s.key)}}forEachWhile(t,e){let n;for(n=e!==void 0?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new Jc(this.data.getIterator())}getIteratorFrom(t){return new Jc(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach((n=>{e=e.add(n)})),e}isEqual(t){if(!(t instanceof et)||this.size!==t.size)return!1;const e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){const s=e.getNext().key,i=n.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const t=[];return this.forEach((e=>{t.push(e)})),t}toString(){const t=[];return this.forEach((e=>t.push(e))),"SortedSet("+t.toString()+")"}copy(t){const e=new et(this.comparator);return e.data=t,e}}class Jc{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function bn(r){return r.hasNext()?r.getNext():void 0}class Lt{constructor(t){this.fields=t,t.sort(ct.comparator)}static empty(){return new Lt([])}unionWith(t){let e=new et(ct.comparator);for(const n of this.fields)e=e.add(n);for(const n of t)e=e.add(n);return new Lt(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return Un(this.fields,t.fields,((e,n)=>e.isEqual(n)))}}class id extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}function iE(){return typeof atob<"u"}class dt{constructor(t){this.binaryString=t}static fromBase64String(t){const e=(function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new id("Invalid base64 string: "+i):i}})(t);return new dt(e)}static fromUint8Array(t){const e=(function(s){let i="";for(let o=0;o<s.length;++o)i+=String.fromCharCode(s[o]);return i})(t);return new dt(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(e){return btoa(e)})(this.binaryString)}toUint8Array(){return(function(e){const n=new Uint8Array(e.length);for(let s=0;s<e.length;s++)n[s]=e.charCodeAt(s);return n})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return z(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}dt.EMPTY_BYTE_STRING=new dt("");const c_=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ce(r){if(L(!!r,39018),typeof r=="string"){let t=0;const e=c_.exec(r);if(L(!!e,46558,{timestamp:r}),e[1]){let s=e[1];s=(s+"000000000").substr(0,9),t=Number(s)}const n=new Date(r);return{seconds:Math.floor(n.getTime()/1e3),nanos:t}}return{seconds:at(r.seconds),nanos:at(r.nanos)}}function at(r){return typeof r=="number"?r:typeof r=="string"?Number(r):0}function le(r){return typeof r=="string"?dt.fromBase64String(r):dt.fromUint8Array(r)}const od="server_timestamp",ad="__type__",ud="__previous_value__",cd="__local_write_time__";function Ci(r){return(r?.mapValue?.fields||{})[ad]?.stringValue===od}function Di(r){const t=r.mapValue.fields[ud];return Ci(t)?Di(t):t}function rs(r){const t=ce(r.mapValue.fields[cd].timestampValue);return new Z(t.seconds,t.nanos)}class l_{constructor(t,e,n,s,i,o,u,c,h,f){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=s,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=u,this.longPollingOptions=c,this.useFetchStreams=h,this.isUsingEmulator=f}}const Qo="(default)";class an{constructor(t,e){this.projectId=t,this.database=e||Qo}static empty(){return new an("","")}get isDefaultDatabase(){return this.database===Qo}isEqual(t){return t instanceof an&&t.projectId===this.projectId&&t.database===this.database}}const Pa="__type__",ld="__max__",be={mapValue:{fields:{__type__:{stringValue:ld}}}},Va="__vector__",Kn="value",Ys={nullValue:"NULL_VALUE"};function xe(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?Ci(r)?4:hd(r)?9007199254740991:xi(r)?10:11:F(28295,{value:r})}function ie(r,t){if(r===t)return!0;const e=xe(r);if(e!==xe(t))return!1;switch(e){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===t.booleanValue;case 4:return rs(r).isEqual(rs(t));case 3:return(function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const o=ce(s.timestampValue),u=ce(i.timestampValue);return o.seconds===u.seconds&&o.nanos===u.nanos})(r,t);case 5:return r.stringValue===t.stringValue;case 6:return(function(s,i){return le(s.bytesValue).isEqual(le(i.bytesValue))})(r,t);case 7:return r.referenceValue===t.referenceValue;case 8:return(function(s,i){return at(s.geoPointValue.latitude)===at(i.geoPointValue.latitude)&&at(s.geoPointValue.longitude)===at(i.geoPointValue.longitude)})(r,t);case 2:return(function(s,i){if("integerValue"in s&&"integerValue"in i)return at(s.integerValue)===at(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const o=at(s.doubleValue),u=at(i.doubleValue);return o===u?Zr(o)===Zr(u):isNaN(o)&&isNaN(u)}return!1})(r,t);case 9:return Un(r.arrayValue.values||[],t.arrayValue.values||[],ie);case 10:case 11:return(function(s,i){const o=s.mapValue.fields||{},u=i.mapValue.fields||{};if(Hc(o)!==Hc(u))return!1;for(const c in o)if(o.hasOwnProperty(c)&&(u[c]===void 0||!ie(o[c],u[c])))return!1;return!0})(r,t);default:return F(52216,{left:r})}}function ss(r,t){return(r.values||[]).find((e=>ie(e,t)))!==void 0}function Ne(r,t){if(r===t)return 0;const e=xe(r),n=xe(t);if(e!==n)return z(e,n);switch(e){case 0:case 9007199254740991:return 0;case 1:return z(r.booleanValue,t.booleanValue);case 2:return(function(i,o){const u=at(i.integerValue||i.doubleValue),c=at(o.integerValue||o.doubleValue);return u<c?-1:u>c?1:u===c?0:isNaN(u)?isNaN(c)?0:-1:1})(r,t);case 3:return Xc(r.timestampValue,t.timestampValue);case 4:return Xc(rs(r),rs(t));case 5:return qo(r.stringValue,t.stringValue);case 6:return(function(i,o){const u=le(i),c=le(o);return u.compareTo(c)})(r.bytesValue,t.bytesValue);case 7:return(function(i,o){const u=i.split("/"),c=o.split("/");for(let h=0;h<u.length&&h<c.length;h++){const f=z(u[h],c[h]);if(f!==0)return f}return z(u.length,c.length)})(r.referenceValue,t.referenceValue);case 8:return(function(i,o){const u=z(at(i.latitude),at(o.latitude));return u!==0?u:z(at(i.longitude),at(o.longitude))})(r.geoPointValue,t.geoPointValue);case 9:return Yc(r.arrayValue,t.arrayValue);case 10:return(function(i,o){const u=i.fields||{},c=o.fields||{},h=u[Kn]?.arrayValue,f=c[Kn]?.arrayValue,p=z(h?.values?.length||0,f?.values?.length||0);return p!==0?p:Yc(h,f)})(r.mapValue,t.mapValue);case 11:return(function(i,o){if(i===be.mapValue&&o===be.mapValue)return 0;if(i===be.mapValue)return 1;if(o===be.mapValue)return-1;const u=i.fields||{},c=Object.keys(u),h=o.fields||{},f=Object.keys(h);c.sort(),f.sort();for(let p=0;p<c.length&&p<f.length;++p){const _=qo(c[p],f[p]);if(_!==0)return _;const R=Ne(u[c[p]],h[f[p]]);if(R!==0)return R}return z(c.length,f.length)})(r.mapValue,t.mapValue);default:throw F(23264,{he:e})}}function Xc(r,t){if(typeof r=="string"&&typeof t=="string"&&r.length===t.length)return z(r,t);const e=ce(r),n=ce(t),s=z(e.seconds,n.seconds);return s!==0?s:z(e.nanos,n.nanos)}function Yc(r,t){const e=r.values||[],n=t.values||[];for(let s=0;s<e.length&&s<n.length;++s){const i=Ne(e[s],n[s]);if(i)return i}return z(e.length,n.length)}function Qn(r){return Wo(r)}function Wo(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?(function(e){const n=ce(e);return`time(${n.seconds},${n.nanos})`})(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?(function(e){return le(e).toBase64()})(r.bytesValue):"referenceValue"in r?(function(e){return M.fromName(e).toString()})(r.referenceValue):"geoPointValue"in r?(function(e){return`geo(${e.latitude},${e.longitude})`})(r.geoPointValue):"arrayValue"in r?(function(e){let n="[",s=!0;for(const i of e.values||[])s?s=!1:n+=",",n+=Wo(i);return n+"]"})(r.arrayValue):"mapValue"in r?(function(e){const n=Object.keys(e.fields||{}).sort();let s="{",i=!0;for(const o of n)i?i=!1:s+=",",s+=`${o}:${Wo(e.fields[o])}`;return s+"}"})(r.mapValue):F(61005,{value:r})}function Zs(r){switch(xe(r)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const t=Di(r);return t?16+Zs(t):16;case 5:return 2*r.stringValue.length;case 6:return le(r.bytesValue).approximateByteSize();case 7:return r.referenceValue.length;case 9:return(function(n){return(n.values||[]).reduce(((s,i)=>s+Zs(i)),0)})(r.arrayValue);case 10:case 11:return(function(n){let s=0;return Be(n.fields,((i,o)=>{s+=i.length+Zs(o)})),s})(r.mapValue);default:throw F(13486,{value:r})}}function un(r,t){return{referenceValue:`projects/${r.projectId}/databases/${r.database}/documents/${t.path.canonicalString()}`}}function Ho(r){return!!r&&"integerValue"in r}function is(r){return!!r&&"arrayValue"in r}function Zc(r){return!!r&&"nullValue"in r}function tl(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function ti(r){return!!r&&"mapValue"in r}function xi(r){return(r?.mapValue?.fields||{})[Pa]?.stringValue===Va}function $r(r){if(r.geoPointValue)return{geoPointValue:{...r.geoPointValue}};if(r.timestampValue&&typeof r.timestampValue=="object")return{timestampValue:{...r.timestampValue}};if(r.mapValue){const t={mapValue:{fields:{}}};return Be(r.mapValue.fields,((e,n)=>t.mapValue.fields[e]=$r(n))),t}if(r.arrayValue){const t={arrayValue:{values:[]}};for(let e=0;e<(r.arrayValue.values||[]).length;++e)t.arrayValue.values[e]=$r(r.arrayValue.values[e]);return t}return{...r}}function hd(r){return(((r.mapValue||{}).fields||{}).__type__||{}).stringValue===ld}const dd={mapValue:{fields:{[Pa]:{stringValue:Va},[Kn]:{arrayValue:{}}}}};function h_(r){return"nullValue"in r?Ys:"booleanValue"in r?{booleanValue:!1}:"integerValue"in r||"doubleValue"in r?{doubleValue:NaN}:"timestampValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in r?{stringValue:""}:"bytesValue"in r?{bytesValue:""}:"referenceValue"in r?un(an.empty(),M.empty()):"geoPointValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in r?{arrayValue:{}}:"mapValue"in r?xi(r)?dd:{mapValue:{}}:F(35942,{value:r})}function d_(r){return"nullValue"in r?{booleanValue:!1}:"booleanValue"in r?{doubleValue:NaN}:"integerValue"in r||"doubleValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in r?{stringValue:""}:"stringValue"in r?{bytesValue:""}:"bytesValue"in r?un(an.empty(),M.empty()):"referenceValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in r?{arrayValue:{}}:"arrayValue"in r?dd:"mapValue"in r?xi(r)?{mapValue:{}}:be:F(61959,{value:r})}function el(r,t){const e=Ne(r.value,t.value);return e!==0?e:r.inclusive&&!t.inclusive?-1:!r.inclusive&&t.inclusive?1:0}function nl(r,t){const e=Ne(r.value,t.value);return e!==0?e:r.inclusive&&!t.inclusive?1:!r.inclusive&&t.inclusive?-1:0}class bt{constructor(t){this.value=t}static empty(){return new bt({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!ti(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=$r(e)}setAll(t){let e=ct.emptyPath(),n={},s=[];t.forEach(((o,u)=>{if(!e.isImmediateParentOf(u)){const c=this.getFieldsMap(e);this.applyChanges(c,n,s),n={},s=[],e=u.popLast()}o?n[u.lastSegment()]=$r(o):s.push(u.lastSegment())}));const i=this.getFieldsMap(e);this.applyChanges(i,n,s)}delete(t){const e=this.field(t.popLast());ti(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return ie(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let s=e.mapValue.fields[t.get(n)];ti(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=s),e=s}return e.mapValue.fields}applyChanges(t,e,n){Be(e,((s,i)=>t[s]=i));for(const s of n)delete t[s]}clone(){return new bt($r(this.value))}}function fd(r){const t=[];return Be(r.fields,((e,n)=>{const s=new ct([e]);if(ti(n)){const i=fd(n.mapValue).fields;if(i.length===0)t.push(s);else for(const o of i)t.push(s.child(o))}else t.push(s)})),new Lt(t)}class ot{constructor(t,e,n,s,i,o,u){this.key=t,this.documentType=e,this.version=n,this.readTime=s,this.createTime=i,this.data=o,this.documentState=u}static newInvalidDocument(t){return new ot(t,0,B.min(),B.min(),B.min(),bt.empty(),0)}static newFoundDocument(t,e,n,s){return new ot(t,1,e,B.min(),n,s,0)}static newNoDocument(t,e){return new ot(t,2,e,B.min(),B.min(),bt.empty(),0)}static newUnknownDocument(t,e){return new ot(t,3,e,B.min(),B.min(),bt.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(B.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=bt.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=bt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=B.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof ot&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new ot(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class ke{constructor(t,e){this.position=t,this.inclusive=e}}function rl(r,t,e){let n=0;for(let s=0;s<r.position.length;s++){const i=t[s],o=r.position[s];if(i.field.isKeyField()?n=M.comparator(M.fromName(o.referenceValue),e.key):n=Ne(o,e.data.field(i.field)),i.dir==="desc"&&(n*=-1),n!==0)break}return n}function sl(r,t){if(r===null)return t===null;if(t===null||r.inclusive!==t.inclusive||r.position.length!==t.position.length)return!1;for(let e=0;e<r.position.length;e++)if(!ie(r.position[e],t.position[e]))return!1;return!0}class os{constructor(t,e="asc"){this.field=t,this.dir=e}}function f_(r,t){return r.dir===t.dir&&r.field.isEqual(t.field)}class md{}class Q extends md{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?e==="in"||e==="not-in"?this.createKeyFieldInFilter(t,e,n):new m_(t,e,n):e==="array-contains"?new __(t,n):e==="in"?new Ed(t,n):e==="not-in"?new y_(t,n):e==="array-contains-any"?new I_(t,n):new Q(t,e,n)}static createKeyFieldInFilter(t,e,n){return e==="in"?new p_(t,n):new g_(t,n)}matches(t){const e=t.data.field(this.field);return this.op==="!="?e!==null&&e.nullValue===void 0&&this.matchesComparison(Ne(e,this.value)):e!==null&&xe(this.value)===xe(e)&&this.matchesComparison(Ne(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return F(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class tt extends md{constructor(t,e){super(),this.filters=t,this.op=e,this.Pe=null}static create(t,e){return new tt(t,e)}matches(t){return Wn(this)?this.filters.find((e=>!e.matches(t)))===void 0:this.filters.find((e=>e.matches(t)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((t,e)=>t.concat(e.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function Wn(r){return r.op==="and"}function Jo(r){return r.op==="or"}function Ca(r){return pd(r)&&Wn(r)}function pd(r){for(const t of r.filters)if(t instanceof tt)return!1;return!0}function Xo(r){if(r instanceof Q)return r.field.canonicalString()+r.op.toString()+Qn(r.value);if(Ca(r))return r.filters.map((t=>Xo(t))).join(",");{const t=r.filters.map((e=>Xo(e))).join(",");return`${r.op}(${t})`}}function gd(r,t){return r instanceof Q?(function(n,s){return s instanceof Q&&n.op===s.op&&n.field.isEqual(s.field)&&ie(n.value,s.value)})(r,t):r instanceof tt?(function(n,s){return s instanceof tt&&n.op===s.op&&n.filters.length===s.filters.length?n.filters.reduce(((i,o,u)=>i&&gd(o,s.filters[u])),!0):!1})(r,t):void F(19439)}function _d(r,t){const e=r.filters.concat(t);return tt.create(e,r.op)}function yd(r){return r instanceof Q?(function(e){return`${e.field.canonicalString()} ${e.op} ${Qn(e.value)}`})(r):r instanceof tt?(function(e){return e.op.toString()+" {"+e.getFilters().map(yd).join(" ,")+"}"})(r):"Filter"}class m_ extends Q{constructor(t,e,n){super(t,e,n),this.key=M.fromName(n.referenceValue)}matches(t){const e=M.comparator(t.key,this.key);return this.matchesComparison(e)}}class p_ extends Q{constructor(t,e){super(t,"in",e),this.keys=Id("in",e)}matches(t){return this.keys.some((e=>e.isEqual(t.key)))}}class g_ extends Q{constructor(t,e){super(t,"not-in",e),this.keys=Id("not-in",e)}matches(t){return!this.keys.some((e=>e.isEqual(t.key)))}}function Id(r,t){return(t.arrayValue?.values||[]).map((e=>M.fromName(e.referenceValue)))}class __ extends Q{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return is(e)&&ss(e.arrayValue,this.value)}}class Ed extends Q{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return e!==null&&ss(this.value.arrayValue,e)}}class y_ extends Q{constructor(t,e){super(t,"not-in",e)}matches(t){if(ss(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return e!==null&&e.nullValue===void 0&&!ss(this.value.arrayValue,e)}}class I_ extends Q{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!is(e)||!e.arrayValue.values)&&e.arrayValue.values.some((n=>ss(this.value.arrayValue,n)))}}class E_{constructor(t,e=null,n=[],s=[],i=null,o=null,u=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=s,this.limit=i,this.startAt=o,this.endAt=u,this.Te=null}}function Yo(r,t=null,e=[],n=[],s=null,i=null,o=null){return new E_(r,t,e,n,s,i,o)}function cn(r){const t=O(r);if(t.Te===null){let e=t.path.canonicalString();t.collectionGroup!==null&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map((n=>Xo(n))).join(","),e+="|ob:",e+=t.orderBy.map((n=>(function(i){return i.field.canonicalString()+i.dir})(n))).join(","),fs(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((n=>Qn(n))).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((n=>Qn(n))).join(",")),t.Te=e}return t.Te}function ps(r,t){if(r.limit!==t.limit||r.orderBy.length!==t.orderBy.length)return!1;for(let e=0;e<r.orderBy.length;e++)if(!f_(r.orderBy[e],t.orderBy[e]))return!1;if(r.filters.length!==t.filters.length)return!1;for(let e=0;e<r.filters.length;e++)if(!gd(r.filters[e],t.filters[e]))return!1;return r.collectionGroup===t.collectionGroup&&!!r.path.isEqual(t.path)&&!!sl(r.startAt,t.startAt)&&sl(r.endAt,t.endAt)}function fi(r){return M.isDocumentKey(r.path)&&r.collectionGroup===null&&r.filters.length===0}function mi(r,t){return r.filters.filter((e=>e instanceof Q&&e.field.isEqual(t)))}function il(r,t,e){let n=Ys,s=!0;for(const i of mi(r,t)){let o=Ys,u=!0;switch(i.op){case"<":case"<=":o=h_(i.value);break;case"==":case"in":case">=":o=i.value;break;case">":o=i.value,u=!1;break;case"!=":case"not-in":o=Ys}el({value:n,inclusive:s},{value:o,inclusive:u})<0&&(n=o,s=u)}if(e!==null){for(let i=0;i<r.orderBy.length;++i)if(r.orderBy[i].field.isEqual(t)){const o=e.position[i];el({value:n,inclusive:s},{value:o,inclusive:e.inclusive})<0&&(n=o,s=e.inclusive);break}}return{value:n,inclusive:s}}function ol(r,t,e){let n=be,s=!0;for(const i of mi(r,t)){let o=be,u=!0;switch(i.op){case">=":case">":o=d_(i.value),u=!1;break;case"==":case"in":case"<=":o=i.value;break;case"<":o=i.value,u=!1;break;case"!=":case"not-in":o=be}nl({value:n,inclusive:s},{value:o,inclusive:u})>0&&(n=o,s=u)}if(e!==null){for(let i=0;i<r.orderBy.length;++i)if(r.orderBy[i].field.isEqual(t)){const o=e.position[i];nl({value:n,inclusive:s},{value:o,inclusive:e.inclusive})>0&&(n=o,s=e.inclusive);break}}return{value:n,inclusive:s}}class he{constructor(t,e=null,n=[],s=[],i=null,o="F",u=null,c=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=s,this.limit=i,this.limitType=o,this.startAt=u,this.endAt=c,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function Td(r,t,e,n,s,i,o,u){return new he(r,t,e,n,s,i,o,u)}function ir(r){return new he(r)}function al(r){return r.filters.length===0&&r.limit===null&&r.startAt==null&&r.endAt==null&&(r.explicitOrderBy.length===0||r.explicitOrderBy.length===1&&r.explicitOrderBy[0].field.isKeyField())}function Da(r){return r.collectionGroup!==null}function Mn(r){const t=O(r);if(t.Ie===null){t.Ie=[];const e=new Set;for(const i of t.explicitOrderBy)t.Ie.push(i),e.add(i.field.canonicalString());const n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(o){let u=new et(ct.comparator);return o.filters.forEach((c=>{c.getFlattenedFilters().forEach((h=>{h.isInequality()&&(u=u.add(h.field))}))})),u})(t).forEach((i=>{e.has(i.canonicalString())||i.isKeyField()||t.Ie.push(new os(i,n))})),e.has(ct.keyField().canonicalString())||t.Ie.push(new os(ct.keyField(),n))}return t.Ie}function kt(r){const t=O(r);return t.Ee||(t.Ee=T_(t,Mn(r))),t.Ee}function T_(r,t){if(r.limitType==="F")return Yo(r.path,r.collectionGroup,t,r.filters,r.limit,r.startAt,r.endAt);{t=t.map((s=>{const i=s.dir==="desc"?"asc":"desc";return new os(s.field,i)}));const e=r.endAt?new ke(r.endAt.position,r.endAt.inclusive):null,n=r.startAt?new ke(r.startAt.position,r.startAt.inclusive):null;return Yo(r.path,r.collectionGroup,t,r.filters,r.limit,e,n)}}function Zo(r,t){const e=r.filters.concat([t]);return new he(r.path,r.collectionGroup,r.explicitOrderBy.slice(),e,r.limit,r.limitType,r.startAt,r.endAt)}function pi(r,t,e){return new he(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),t,e,r.startAt,r.endAt)}function gs(r,t){return ps(kt(r),kt(t))&&r.limitType===t.limitType}function wd(r){return`${cn(kt(r))}|lt:${r.limitType}`}function Dn(r){return`Query(target=${(function(e){let n=e.path.canonicalString();return e.collectionGroup!==null&&(n+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(n+=`, filters: [${e.filters.map((s=>yd(s))).join(", ")}]`),fs(e.limit)||(n+=", limit: "+e.limit),e.orderBy.length>0&&(n+=`, orderBy: [${e.orderBy.map((s=>(function(o){return`${o.field.canonicalString()} (${o.dir})`})(s))).join(", ")}]`),e.startAt&&(n+=", startAt: ",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map((s=>Qn(s))).join(",")),e.endAt&&(n+=", endAt: ",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map((s=>Qn(s))).join(",")),`Target(${n})`})(kt(r))}; limitType=${r.limitType})`}function _s(r,t){return t.isFoundDocument()&&(function(n,s){const i=s.key.path;return n.collectionGroup!==null?s.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(i):M.isDocumentKey(n.path)?n.path.isEqual(i):n.path.isImmediateParentOf(i)})(r,t)&&(function(n,s){for(const i of Mn(n))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0})(r,t)&&(function(n,s){for(const i of n.filters)if(!i.matches(s))return!1;return!0})(r,t)&&(function(n,s){return!(n.startAt&&!(function(o,u,c){const h=rl(o,u,c);return o.inclusive?h<=0:h<0})(n.startAt,Mn(n),s)||n.endAt&&!(function(o,u,c){const h=rl(o,u,c);return o.inclusive?h>=0:h>0})(n.endAt,Mn(n),s))})(r,t)}function vd(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}function Ad(r){return(t,e)=>{let n=!1;for(const s of Mn(r)){const i=w_(s,t,e);if(i!==0)return i;n=n||s.field.isKeyField()}return 0}}function w_(r,t,e){const n=r.field.isKeyField()?M.comparator(t.key,e.key):(function(i,o,u){const c=o.data.field(i),h=u.data.field(i);return c!==null&&h!==null?Ne(c,h):F(42886)})(r.field,t,e);switch(r.dir){case"asc":return n;case"desc":return-1*n;default:return F(19790,{direction:r.dir})}}class de{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),n=this.inner[e];if(n!==void 0){for(const[s,i]of n)if(this.equalsFn(s,t))return i}}has(t){return this.get(t)!==void 0}set(t,e){const n=this.mapKeyFn(t),s=this.inner[n];if(s===void 0)return this.inner[n]=[[t,e]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],t))return void(s[i]=[t,e]);s.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),n=this.inner[e];if(n===void 0)return!1;for(let s=0;s<n.length;s++)if(this.equalsFn(n[s][0],t))return n.length===1?delete this.inner[e]:n.splice(s,1),this.innerSize--,!0;return!1}forEach(t){Be(this.inner,((e,n)=>{for(const[s,i]of n)t(s,i)}))}isEmpty(){return sd(this.inner)}size(){return this.innerSize}}const v_=new st(M.comparator);function Bt(){return v_}const bd=new st(M.comparator);function Mr(...r){let t=bd;for(const e of r)t=t.insert(e.key,e);return t}function Rd(r){let t=bd;return r.forEach(((e,n)=>t=t.insert(e,n.overlayedDocument))),t}function Zt(){return Gr()}function Sd(){return Gr()}function Gr(){return new de((r=>r.toString()),((r,t)=>r.isEqual(t)))}const A_=new st(M.comparator),b_=new et(M.comparator);function $(...r){let t=b_;for(const e of r)t=t.add(e);return t}const R_=new et(z);function xa(){return R_}function Na(r,t){if(r.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Zr(t)?"-0":t}}function Pd(r){return{integerValue:""+r}}function Vd(r,t){return Qh(t)?Pd(t):Na(r,t)}class Ni{constructor(){this._=void 0}}function S_(r,t,e){return r instanceof Hn?(function(s,i){const o={fields:{[ad]:{stringValue:od},[cd]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&Ci(i)&&(i=Di(i)),i&&(o.fields[ud]=i),{mapValue:o}})(e,t):r instanceof ln?Dd(r,t):r instanceof hn?xd(r,t):(function(s,i){const o=Cd(s,i),u=ul(o)+ul(s.Ae);return Ho(o)&&Ho(s.Ae)?Pd(u):Na(s.serializer,u)})(r,t)}function P_(r,t,e){return r instanceof ln?Dd(r,t):r instanceof hn?xd(r,t):e}function Cd(r,t){return r instanceof Jn?(function(n){return Ho(n)||(function(i){return!!i&&"doubleValue"in i})(n)})(t)?t:{integerValue:0}:null}class Hn extends Ni{}class ln extends Ni{constructor(t){super(),this.elements=t}}function Dd(r,t){const e=Nd(t);for(const n of r.elements)e.some((s=>ie(s,n)))||e.push(n);return{arrayValue:{values:e}}}class hn extends Ni{constructor(t){super(),this.elements=t}}function xd(r,t){let e=Nd(t);for(const n of r.elements)e=e.filter((s=>!ie(s,n)));return{arrayValue:{values:e}}}class Jn extends Ni{constructor(t,e){super(),this.serializer=t,this.Ae=e}}function ul(r){return at(r.integerValue||r.doubleValue)}function Nd(r){return is(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}class ys{constructor(t,e){this.field=t,this.transform=e}}function V_(r,t){return r.field.isEqual(t.field)&&(function(n,s){return n instanceof ln&&s instanceof ln||n instanceof hn&&s instanceof hn?Un(n.elements,s.elements,ie):n instanceof Jn&&s instanceof Jn?ie(n.Ae,s.Ae):n instanceof Hn&&s instanceof Hn})(r.transform,t.transform)}class C_{constructor(t,e){this.version=t,this.transformResults=e}}class ut{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new ut}static exists(t){return new ut(void 0,t)}static updateTime(t){return new ut(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function ei(r,t){return r.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(r.updateTime):r.exists===void 0||r.exists===t.isFoundDocument()}class ki{}function kd(r,t){if(!r.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return r.isNoDocument()?new ar(r.key,ut.none()):new or(r.key,r.data,ut.none());{const e=r.data,n=bt.empty();let s=new et(ct.comparator);for(let i of t.fields)if(!s.has(i)){let o=e.field(i);o===null&&i.length>1&&(i=i.popLast(),o=e.field(i)),o===null?n.delete(i):n.set(i,o),s=s.add(i)}return new fe(r.key,n,new Lt(s.toArray()),ut.none())}}function D_(r,t,e){r instanceof or?(function(s,i,o){const u=s.value.clone(),c=ll(s.fieldTransforms,i,o.transformResults);u.setAll(c),i.convertToFoundDocument(o.version,u).setHasCommittedMutations()})(r,t,e):r instanceof fe?(function(s,i,o){if(!ei(s.precondition,i))return void i.convertToUnknownDocument(o.version);const u=ll(s.fieldTransforms,i,o.transformResults),c=i.data;c.setAll(Md(s)),c.setAll(u),i.convertToFoundDocument(o.version,c).setHasCommittedMutations()})(r,t,e):(function(s,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()})(0,t,e)}function Kr(r,t,e,n){return r instanceof or?(function(i,o,u,c){if(!ei(i.precondition,o))return u;const h=i.value.clone(),f=hl(i.fieldTransforms,c,o);return h.setAll(f),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),null})(r,t,e,n):r instanceof fe?(function(i,o,u,c){if(!ei(i.precondition,o))return u;const h=hl(i.fieldTransforms,c,o),f=o.data;return f.setAll(Md(i)),f.setAll(h),o.convertToFoundDocument(o.version,f).setHasLocalMutations(),u===null?null:u.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map((p=>p.field)))})(r,t,e,n):(function(i,o,u){return ei(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):u})(r,t,e)}function x_(r,t){let e=null;for(const n of r.fieldTransforms){const s=t.data.field(n.field),i=Cd(n.transform,s||null);i!=null&&(e===null&&(e=bt.empty()),e.set(n.field,i))}return e||null}function cl(r,t){return r.type===t.type&&!!r.key.isEqual(t.key)&&!!r.precondition.isEqual(t.precondition)&&!!(function(n,s){return n===void 0&&s===void 0||!(!n||!s)&&Un(n,s,((i,o)=>V_(i,o)))})(r.fieldTransforms,t.fieldTransforms)&&(r.type===0?r.value.isEqual(t.value):r.type!==1||r.data.isEqual(t.data)&&r.fieldMask.isEqual(t.fieldMask))}class or extends ki{constructor(t,e,n,s=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class fe extends ki{constructor(t,e,n,s,i=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function Md(r){const t=new Map;return r.fieldMask.fields.forEach((e=>{if(!e.isEmpty()){const n=r.data.field(e);t.set(e,n)}})),t}function ll(r,t,e){const n=new Map;L(r.length===e.length,32656,{Re:e.length,Ve:r.length});for(let s=0;s<e.length;s++){const i=r[s],o=i.transform,u=t.data.field(i.field);n.set(i.field,P_(o,u,e[s]))}return n}function hl(r,t,e){const n=new Map;for(const s of r){const i=s.transform,o=e.data.field(s.field);n.set(s.field,S_(i,o,t))}return n}class ar extends ki{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class ka extends ki{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Ma{constructor(t,e,n,s){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=s}applyToRemoteDocument(t,e){const n=e.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(t.key)&&D_(i,t,n[s])}}applyToLocalView(t,e){for(const n of this.baseMutations)n.key.isEqual(t.key)&&(e=Kr(n,t,e,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(t.key)&&(e=Kr(n,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){const n=Sd();return this.mutations.forEach((s=>{const i=t.get(s.key),o=i.overlayedDocument;let u=this.applyToLocalView(o,i.mutatedFields);u=e.has(s.key)?null:u;const c=kd(o,u);c!==null&&n.set(s.key,c),o.isValidDocument()||o.convertToNoDocument(B.min())})),n}keys(){return this.mutations.reduce(((t,e)=>t.add(e.key)),$())}isEqual(t){return this.batchId===t.batchId&&Un(this.mutations,t.mutations,((e,n)=>cl(e,n)))&&Un(this.baseMutations,t.baseMutations,((e,n)=>cl(e,n)))}}class Oa{constructor(t,e,n,s){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=s}static from(t,e,n){L(t.mutations.length===n.length,58842,{me:t.mutations.length,fe:n.length});let s=(function(){return A_})();const i=t.mutations;for(let o=0;o<i.length;o++)s=s.insert(i[o].key,n[o].version);return new Oa(t,e,n,s)}}class Fa{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class N_{constructor(t,e){this.count=t,this.unchangedNames=e}}var gt,J;function Od(r){switch(r){case S.OK:return F(64938);case S.CANCELLED:case S.UNKNOWN:case S.DEADLINE_EXCEEDED:case S.RESOURCE_EXHAUSTED:case S.INTERNAL:case S.UNAVAILABLE:case S.UNAUTHENTICATED:return!1;case S.INVALID_ARGUMENT:case S.NOT_FOUND:case S.ALREADY_EXISTS:case S.PERMISSION_DENIED:case S.FAILED_PRECONDITION:case S.ABORTED:case S.OUT_OF_RANGE:case S.UNIMPLEMENTED:case S.DATA_LOSS:return!0;default:return F(15467,{code:r})}}function Fd(r){if(r===void 0)return ft("GRPC error has no .code"),S.UNKNOWN;switch(r){case gt.OK:return S.OK;case gt.CANCELLED:return S.CANCELLED;case gt.UNKNOWN:return S.UNKNOWN;case gt.DEADLINE_EXCEEDED:return S.DEADLINE_EXCEEDED;case gt.RESOURCE_EXHAUSTED:return S.RESOURCE_EXHAUSTED;case gt.INTERNAL:return S.INTERNAL;case gt.UNAVAILABLE:return S.UNAVAILABLE;case gt.UNAUTHENTICATED:return S.UNAUTHENTICATED;case gt.INVALID_ARGUMENT:return S.INVALID_ARGUMENT;case gt.NOT_FOUND:return S.NOT_FOUND;case gt.ALREADY_EXISTS:return S.ALREADY_EXISTS;case gt.PERMISSION_DENIED:return S.PERMISSION_DENIED;case gt.FAILED_PRECONDITION:return S.FAILED_PRECONDITION;case gt.ABORTED:return S.ABORTED;case gt.OUT_OF_RANGE:return S.OUT_OF_RANGE;case gt.UNIMPLEMENTED:return S.UNIMPLEMENTED;case gt.DATA_LOSS:return S.DATA_LOSS;default:return F(39323,{code:r})}}(J=gt||(gt={}))[J.OK=0]="OK",J[J.CANCELLED=1]="CANCELLED",J[J.UNKNOWN=2]="UNKNOWN",J[J.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",J[J.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",J[J.NOT_FOUND=5]="NOT_FOUND",J[J.ALREADY_EXISTS=6]="ALREADY_EXISTS",J[J.PERMISSION_DENIED=7]="PERMISSION_DENIED",J[J.UNAUTHENTICATED=16]="UNAUTHENTICATED",J[J.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",J[J.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",J[J.ABORTED=10]="ABORTED",J[J.OUT_OF_RANGE=11]="OUT_OF_RANGE",J[J.UNIMPLEMENTED=12]="UNIMPLEMENTED",J[J.INTERNAL=13]="INTERNAL",J[J.UNAVAILABLE=14]="UNAVAILABLE",J[J.DATA_LOSS=15]="DATA_LOSS";function Ld(){return new TextEncoder}const k_=new Pe([4294967295,4294967295],0);function dl(r){const t=Ld().encode(r),e=new Dh;return e.update(t),new Uint8Array(e.digest())}function fl(r){const t=new DataView(r.buffer),e=t.getUint32(0,!0),n=t.getUint32(4,!0),s=t.getUint32(8,!0),i=t.getUint32(12,!0);return[new Pe([e,n],0),new Pe([s,i],0)]}class La{constructor(t,e,n){if(this.bitmap=t,this.padding=e,this.hashCount=n,e<0||e>=8)throw new Or(`Invalid padding: ${e}`);if(n<0)throw new Or(`Invalid hash count: ${n}`);if(t.length>0&&this.hashCount===0)throw new Or(`Invalid hash count: ${n}`);if(t.length===0&&e!==0)throw new Or(`Invalid padding when bitmap length is 0: ${e}`);this.ge=8*t.length-e,this.pe=Pe.fromNumber(this.ge)}ye(t,e,n){let s=t.add(e.multiply(Pe.fromNumber(n)));return s.compare(k_)===1&&(s=new Pe([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(t){return!!(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(this.ge===0)return!1;const e=dl(t),[n,s]=fl(e);for(let i=0;i<this.hashCount;i++){const o=this.ye(n,s,i);if(!this.we(o))return!1}return!0}static create(t,e,n){const s=t%8==0?0:8-t%8,i=new Uint8Array(Math.ceil(t/8)),o=new La(i,s,e);return n.forEach((u=>o.insert(u))),o}insert(t){if(this.ge===0)return;const e=dl(t),[n,s]=fl(e);for(let i=0;i<this.hashCount;i++){const o=this.ye(n,s,i);this.Se(o)}}Se(t){const e=Math.floor(t/8),n=t%8;this.bitmap[e]|=1<<n}}class Or extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Is{constructor(t,e,n,s,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(t,e,n){const s=new Map;return s.set(t,Es.createSynthesizedTargetChangeForCurrentChange(t,e,n)),new Is(B.min(),s,new st(z),Bt(),$())}}class Es{constructor(t,e,n,s,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(t,e,n){return new Es(n,e,$(),$(),$())}}class ni{constructor(t,e,n,s){this.be=t,this.removedTargetIds=e,this.key=n,this.De=s}}class Bd{constructor(t,e){this.targetId=t,this.Ce=e}}class Ud{constructor(t,e,n=dt.EMPTY_BYTE_STRING,s=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=s}}class ml{constructor(){this.ve=0,this.Fe=pl(),this.Me=dt.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(t){t.approximateByteSize()>0&&(this.Oe=!0,this.Me=t)}ke(){let t=$(),e=$(),n=$();return this.Fe.forEach(((s,i)=>{switch(i){case 0:t=t.add(s);break;case 2:e=e.add(s);break;case 1:n=n.add(s);break;default:F(38017,{changeType:i})}})),new Es(this.Me,this.xe,t,e,n)}qe(){this.Oe=!1,this.Fe=pl()}Qe(t,e){this.Oe=!0,this.Fe=this.Fe.insert(t,e)}$e(t){this.Oe=!0,this.Fe=this.Fe.remove(t)}Ue(){this.ve+=1}Ke(){this.ve-=1,L(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class M_{constructor(t){this.Ge=t,this.ze=new Map,this.je=Bt(),this.Je=zs(),this.He=zs(),this.Ye=new st(z)}Ze(t){for(const e of t.be)t.De&&t.De.isFoundDocument()?this.Xe(e,t.De):this.et(e,t.key,t.De);for(const e of t.removedTargetIds)this.et(e,t.key,t.De)}tt(t){this.forEachTarget(t,(e=>{const n=this.nt(e);switch(t.state){case 0:this.rt(e)&&n.Le(t.resumeToken);break;case 1:n.Ke(),n.Ne||n.qe(),n.Le(t.resumeToken);break;case 2:n.Ke(),n.Ne||this.removeTarget(e);break;case 3:this.rt(e)&&(n.We(),n.Le(t.resumeToken));break;case 4:this.rt(e)&&(this.it(e),n.Le(t.resumeToken));break;default:F(56790,{state:t.state})}}))}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.ze.forEach(((n,s)=>{this.rt(s)&&e(s)}))}st(t){const e=t.targetId,n=t.Ce.count,s=this.ot(e);if(s){const i=s.target;if(fi(i))if(n===0){const o=new M(i.path);this.et(e,o,ot.newNoDocument(o,B.min()))}else L(n===1,20013,{expectedCount:n});else{const o=this._t(e);if(o!==n){const u=this.ut(t),c=u?this.ct(u,t,o):1;if(c!==0){this.it(e);const h=c===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(e,h)}}}}}ut(t){const e=t.Ce.unchangedNames;if(!e||!e.bits)return null;const{bits:{bitmap:n="",padding:s=0},hashCount:i=0}=e;let o,u;try{o=le(n).toUint8Array()}catch(c){if(c instanceof id)return ue("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{u=new La(o,s,i)}catch(c){return ue(c instanceof Or?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return u.ge===0?null:u}ct(t,e,n){return e.Ce.count===n-this.Pt(t,e.targetId)?0:2}Pt(t,e){const n=this.Ge.getRemoteKeysForTarget(e);let s=0;return n.forEach((i=>{const o=this.Ge.ht(),u=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;t.mightContain(u)||(this.et(e,i,null),s++)})),s}Tt(t){const e=new Map;this.ze.forEach(((i,o)=>{const u=this.ot(o);if(u){if(i.current&&fi(u.target)){const c=new M(u.target.path);this.It(c).has(o)||this.Et(o,c)||this.et(o,c,ot.newNoDocument(c,t))}i.Be&&(e.set(o,i.ke()),i.qe())}}));let n=$();this.He.forEach(((i,o)=>{let u=!0;o.forEachWhile((c=>{const h=this.ot(c);return!h||h.purpose==="TargetPurposeLimboResolution"||(u=!1,!1)})),u&&(n=n.add(i))})),this.je.forEach(((i,o)=>o.setReadTime(t)));const s=new Is(t,e,this.Ye,this.je,n);return this.je=Bt(),this.Je=zs(),this.He=zs(),this.Ye=new st(z),s}Xe(t,e){if(!this.rt(t))return;const n=this.Et(t,e.key)?2:0;this.nt(t).Qe(e.key,n),this.je=this.je.insert(e.key,e),this.Je=this.Je.insert(e.key,this.It(e.key).add(t)),this.He=this.He.insert(e.key,this.dt(e.key).add(t))}et(t,e,n){if(!this.rt(t))return;const s=this.nt(t);this.Et(t,e)?s.Qe(e,1):s.$e(e),this.He=this.He.insert(e,this.dt(e).delete(t)),this.He=this.He.insert(e,this.dt(e).add(t)),n&&(this.je=this.je.insert(e,n))}removeTarget(t){this.ze.delete(t)}_t(t){const e=this.nt(t).ke();return this.Ge.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}Ue(t){this.nt(t).Ue()}nt(t){let e=this.ze.get(t);return e||(e=new ml,this.ze.set(t,e)),e}dt(t){let e=this.He.get(t);return e||(e=new et(z),this.He=this.He.insert(t,e)),e}It(t){let e=this.Je.get(t);return e||(e=new et(z),this.Je=this.Je.insert(t,e)),e}rt(t){const e=this.ot(t)!==null;return e||C("WatchChangeAggregator","Detected inactive target",t),e}ot(t){const e=this.ze.get(t);return e&&e.Ne?null:this.Ge.At(t)}it(t){this.ze.set(t,new ml),this.Ge.getRemoteKeysForTarget(t).forEach((e=>{this.et(t,e,null)}))}Et(t,e){return this.Ge.getRemoteKeysForTarget(t).has(e)}}function zs(){return new st(M.comparator)}function pl(){return new st(M.comparator)}const O_={asc:"ASCENDING",desc:"DESCENDING"},F_={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},L_={and:"AND",or:"OR"};class B_{constructor(t,e){this.databaseId=t,this.useProto3Json=e}}function ta(r,t){return r.useProto3Json||fs(t)?t:{value:t}}function Xn(r,t){return r.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function qd(r,t){return r.useProto3Json?t.toBase64():t.toUint8Array()}function U_(r,t){return Xn(r,t.toTimestamp())}function mt(r){return L(!!r,49232),B.fromTimestamp((function(e){const n=ce(e);return new Z(n.seconds,n.nanos)})(r))}function Ba(r,t){return ea(r,t).canonicalString()}function ea(r,t){const e=(function(s){return new K(["projects",s.projectId,"databases",s.database])})(r).child("documents");return t===void 0?e:e.child(t)}function jd(r){const t=K.fromString(r);return L(Yd(t),10190,{key:t.toString()}),t}function as(r,t){return Ba(r.databaseId,t.path)}function ee(r,t){const e=jd(t);if(e.get(1)!==r.databaseId.projectId)throw new V(S.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+r.databaseId.projectId);if(e.get(3)!==r.databaseId.database)throw new V(S.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+r.databaseId.database);return new M(Gd(e))}function zd(r,t){return Ba(r.databaseId,t)}function $d(r){const t=jd(r);return t.length===4?K.emptyPath():Gd(t)}function na(r){return new K(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function Gd(r){return L(r.length>4&&r.get(4)==="documents",29091,{key:r.toString()}),r.popFirst(5)}function gl(r,t,e){return{name:as(r,t),fields:e.value.mapValue.fields}}function Kd(r,t,e){const n=ee(r,t.name),s=mt(t.updateTime),i=t.createTime?mt(t.createTime):B.min(),o=new bt({mapValue:{fields:t.fields}}),u=ot.newFoundDocument(n,s,i,o);return e&&u.setHasCommittedMutations(),e?u.setHasCommittedMutations():u}function q_(r,t){return"found"in t?(function(n,s){L(!!s.found,43571),s.found.name,s.found.updateTime;const i=ee(n,s.found.name),o=mt(s.found.updateTime),u=s.found.createTime?mt(s.found.createTime):B.min(),c=new bt({mapValue:{fields:s.found.fields}});return ot.newFoundDocument(i,o,u,c)})(r,t):"missing"in t?(function(n,s){L(!!s.missing,3894),L(!!s.readTime,22933);const i=ee(n,s.missing),o=mt(s.readTime);return ot.newNoDocument(i,o)})(r,t):F(7234,{result:t})}function j_(r,t){let e;if("targetChange"in t){t.targetChange;const n=(function(h){return h==="NO_CHANGE"?0:h==="ADD"?1:h==="REMOVE"?2:h==="CURRENT"?3:h==="RESET"?4:F(39313,{state:h})})(t.targetChange.targetChangeType||"NO_CHANGE"),s=t.targetChange.targetIds||[],i=(function(h,f){return h.useProto3Json?(L(f===void 0||typeof f=="string",58123),dt.fromBase64String(f||"")):(L(f===void 0||f instanceof Buffer||f instanceof Uint8Array,16193),dt.fromUint8Array(f||new Uint8Array))})(r,t.targetChange.resumeToken),o=t.targetChange.cause,u=o&&(function(h){const f=h.code===void 0?S.UNKNOWN:Fd(h.code);return new V(f,h.message||"")})(o);e=new Ud(n,s,i,u||null)}else if("documentChange"in t){t.documentChange;const n=t.documentChange;n.document,n.document.name,n.document.updateTime;const s=ee(r,n.document.name),i=mt(n.document.updateTime),o=n.document.createTime?mt(n.document.createTime):B.min(),u=new bt({mapValue:{fields:n.document.fields}}),c=ot.newFoundDocument(s,i,o,u),h=n.targetIds||[],f=n.removedTargetIds||[];e=new ni(h,f,c.key,c)}else if("documentDelete"in t){t.documentDelete;const n=t.documentDelete;n.document;const s=ee(r,n.document),i=n.readTime?mt(n.readTime):B.min(),o=ot.newNoDocument(s,i),u=n.removedTargetIds||[];e=new ni([],u,o.key,o)}else if("documentRemove"in t){t.documentRemove;const n=t.documentRemove;n.document;const s=ee(r,n.document),i=n.removedTargetIds||[];e=new ni([],i,s,null)}else{if(!("filter"in t))return F(11601,{Rt:t});{t.filter;const n=t.filter;n.targetId;const{count:s=0,unchangedNames:i}=n,o=new N_(s,i),u=n.targetId;e=new Bd(u,o)}}return e}function us(r,t){let e;if(t instanceof or)e={update:gl(r,t.key,t.value)};else if(t instanceof ar)e={delete:as(r,t.key)};else if(t instanceof fe)e={update:gl(r,t.key,t.data),updateMask:W_(t.fieldMask)};else{if(!(t instanceof ka))return F(16599,{Vt:t.type});e={verify:as(r,t.key)}}return t.fieldTransforms.length>0&&(e.updateTransforms=t.fieldTransforms.map((n=>(function(i,o){const u=o.transform;if(u instanceof Hn)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof ln)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof hn)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof Jn)return{fieldPath:o.field.canonicalString(),increment:u.Ae};throw F(20930,{transform:o.transform})})(0,n)))),t.precondition.isNone||(e.currentDocument=(function(s,i){return i.updateTime!==void 0?{updateTime:U_(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:F(27497)})(r,t.precondition)),e}function ra(r,t){const e=t.currentDocument?(function(i){return i.updateTime!==void 0?ut.updateTime(mt(i.updateTime)):i.exists!==void 0?ut.exists(i.exists):ut.none()})(t.currentDocument):ut.none(),n=t.updateTransforms?t.updateTransforms.map((s=>(function(o,u){let c=null;if("setToServerValue"in u)L(u.setToServerValue==="REQUEST_TIME",16630,{proto:u}),c=new Hn;else if("appendMissingElements"in u){const f=u.appendMissingElements.values||[];c=new ln(f)}else if("removeAllFromArray"in u){const f=u.removeAllFromArray.values||[];c=new hn(f)}else"increment"in u?c=new Jn(o,u.increment):F(16584,{proto:u});const h=ct.fromServerFormat(u.fieldPath);return new ys(h,c)})(r,s))):[];if(t.update){t.update.name;const s=ee(r,t.update.name),i=new bt({mapValue:{fields:t.update.fields}});if(t.updateMask){const o=(function(c){const h=c.fieldPaths||[];return new Lt(h.map((f=>ct.fromServerFormat(f))))})(t.updateMask);return new fe(s,i,o,e,n)}return new or(s,i,e,n)}if(t.delete){const s=ee(r,t.delete);return new ar(s,e)}if(t.verify){const s=ee(r,t.verify);return new ka(s,e)}return F(1463,{proto:t})}function z_(r,t){return r&&r.length>0?(L(t!==void 0,14353),r.map((e=>(function(s,i){let o=s.updateTime?mt(s.updateTime):mt(i);return o.isEqual(B.min())&&(o=mt(i)),new C_(o,s.transformResults||[])})(e,t)))):[]}function Qd(r,t){return{documents:[zd(r,t.path)]}}function Wd(r,t){const e={structuredQuery:{}},n=t.path;let s;t.collectionGroup!==null?(s=n,e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(s=n.popLast(),e.structuredQuery.from=[{collectionId:n.lastSegment()}]),e.parent=zd(r,s);const i=(function(h){if(h.length!==0)return Xd(tt.create(h,"and"))})(t.filters);i&&(e.structuredQuery.where=i);const o=(function(h){if(h.length!==0)return h.map((f=>(function(_){return{field:xn(_.field),direction:G_(_.dir)}})(f)))})(t.orderBy);o&&(e.structuredQuery.orderBy=o);const u=ta(r,t.limit);return u!==null&&(e.structuredQuery.limit=u),t.startAt&&(e.structuredQuery.startAt=(function(h){return{before:h.inclusive,values:h.position}})(t.startAt)),t.endAt&&(e.structuredQuery.endAt=(function(h){return{before:!h.inclusive,values:h.position}})(t.endAt)),{ft:e,parent:s}}function Hd(r){let t=$d(r.parent);const e=r.structuredQuery,n=e.from?e.from.length:0;let s=null;if(n>0){L(n===1,65062);const f=e.from[0];f.allDescendants?s=f.collectionId:t=t.child(f.collectionId)}let i=[];e.where&&(i=(function(p){const _=Jd(p);return _ instanceof tt&&Ca(_)?_.getFilters():[_]})(e.where));let o=[];e.orderBy&&(o=(function(p){return p.map((_=>(function(x){return new os(Nn(x.field),(function(D){switch(D){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(x.direction))})(_)))})(e.orderBy));let u=null;e.limit&&(u=(function(p){let _;return _=typeof p=="object"?p.value:p,fs(_)?null:_})(e.limit));let c=null;e.startAt&&(c=(function(p){const _=!!p.before,R=p.values||[];return new ke(R,_)})(e.startAt));let h=null;return e.endAt&&(h=(function(p){const _=!p.before,R=p.values||[];return new ke(R,_)})(e.endAt)),Td(t,s,o,i,u,"F",c,h)}function $_(r,t){const e=(function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return F(28987,{purpose:s})}})(t.purpose);return e==null?null:{"goog-listen-tags":e}}function Jd(r){return r.unaryFilter!==void 0?(function(e){switch(e.unaryFilter.op){case"IS_NAN":const n=Nn(e.unaryFilter.field);return Q.create(n,"==",{doubleValue:NaN});case"IS_NULL":const s=Nn(e.unaryFilter.field);return Q.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Nn(e.unaryFilter.field);return Q.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=Nn(e.unaryFilter.field);return Q.create(o,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return F(61313);default:return F(60726)}})(r):r.fieldFilter!==void 0?(function(e){return Q.create(Nn(e.fieldFilter.field),(function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return F(58110);default:return F(50506)}})(e.fieldFilter.op),e.fieldFilter.value)})(r):r.compositeFilter!==void 0?(function(e){return tt.create(e.compositeFilter.filters.map((n=>Jd(n))),(function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return F(1026)}})(e.compositeFilter.op))})(r):F(30097,{filter:r})}function G_(r){return O_[r]}function K_(r){return F_[r]}function Q_(r){return L_[r]}function xn(r){return{fieldPath:r.canonicalString()}}function Nn(r){return ct.fromServerFormat(r.fieldPath)}function Xd(r){return r instanceof Q?(function(e){if(e.op==="=="){if(tl(e.value))return{unaryFilter:{field:xn(e.field),op:"IS_NAN"}};if(Zc(e.value))return{unaryFilter:{field:xn(e.field),op:"IS_NULL"}}}else if(e.op==="!="){if(tl(e.value))return{unaryFilter:{field:xn(e.field),op:"IS_NOT_NAN"}};if(Zc(e.value))return{unaryFilter:{field:xn(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:xn(e.field),op:K_(e.op),value:e.value}}})(r):r instanceof tt?(function(e){const n=e.getFilters().map((s=>Xd(s)));return n.length===1?n[0]:{compositeFilter:{op:Q_(e.op),filters:n}}})(r):F(54877,{filter:r})}function W_(r){const t=[];return r.fields.forEach((e=>t.push(e.canonicalString()))),{fieldPaths:t}}function Yd(r){return r.length>=4&&r.get(0)==="projects"&&r.get(2)==="databases"}class oe{constructor(t,e,n,s,i=B.min(),o=B.min(),u=dt.EMPTY_BYTE_STRING,c=null){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=u,this.expectedCount=c}withSequenceNumber(t){return new oe(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new oe(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new oe(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new oe(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}class Zd{constructor(t){this.yt=t}}function H_(r,t){let e;if(t.document)e=Kd(r.yt,t.document,!!t.hasCommittedMutations);else if(t.noDocument){const n=M.fromSegments(t.noDocument.path),s=fn(t.noDocument.readTime);e=ot.newNoDocument(n,s),t.hasCommittedMutations&&e.setHasCommittedMutations()}else{if(!t.unknownDocument)return F(56709);{const n=M.fromSegments(t.unknownDocument.path),s=fn(t.unknownDocument.version);e=ot.newUnknownDocument(n,s)}}return t.readTime&&e.setReadTime((function(s){const i=new Z(s[0],s[1]);return B.fromTimestamp(i)})(t.readTime)),e}function _l(r,t){const e=t.key,n={prefixPath:e.getCollectionPath().popLast().toArray(),collectionGroup:e.collectionGroup,documentId:e.path.lastSegment(),readTime:gi(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())n.document=(function(i,o){return{name:as(i,o.key),fields:o.data.value.mapValue.fields,updateTime:Xn(i,o.version.toTimestamp()),createTime:Xn(i,o.createTime.toTimestamp())}})(r.yt,t);else if(t.isNoDocument())n.noDocument={path:e.path.toArray(),readTime:dn(t.version)};else{if(!t.isUnknownDocument())return F(57904,{document:t});n.unknownDocument={path:e.path.toArray(),version:dn(t.version)}}return n}function gi(r){const t=r.toTimestamp();return[t.seconds,t.nanoseconds]}function dn(r){const t=r.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function fn(r){const t=new Z(r.seconds,r.nanoseconds);return B.fromTimestamp(t)}function Ze(r,t){const e=(t.baseMutations||[]).map((i=>ra(r.yt,i)));for(let i=0;i<t.mutations.length-1;++i){const o=t.mutations[i];if(i+1<t.mutations.length&&t.mutations[i+1].transform!==void 0){const u=t.mutations[i+1];o.updateTransforms=u.transform.fieldTransforms,t.mutations.splice(i+1,1),++i}}const n=t.mutations.map((i=>ra(r.yt,i))),s=Z.fromMillis(t.localWriteTimeMs);return new Ma(t.batchId,s,e,n)}function Fr(r){const t=fn(r.readTime),e=r.lastLimboFreeSnapshotVersion!==void 0?fn(r.lastLimboFreeSnapshotVersion):B.min();let n;return n=(function(i){return i.documents!==void 0})(r.query)?(function(i){const o=i.documents.length;return L(o===1,1966,{count:o}),kt(ir($d(i.documents[0])))})(r.query):(function(i){return kt(Hd(i))})(r.query),new oe(n,r.targetId,"TargetPurposeListen",r.lastListenSequenceNumber,t,e,dt.fromBase64String(r.resumeToken))}function tf(r,t){const e=dn(t.snapshotVersion),n=dn(t.lastLimboFreeSnapshotVersion);let s;s=fi(t.target)?Qd(r.yt,t.target):Wd(r.yt,t.target).ft;const i=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:cn(t.target),readTime:e,resumeToken:i,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:n,query:s}}function Ua(r){const t=Hd({parent:r.parent,structuredQuery:r.structuredQuery});return r.limitType==="LAST"?pi(t,t.limit,"L"):t}function Po(r,t){return new Fa(t.largestBatchId,ra(r.yt,t.overlayMutation))}function yl(r,t){const e=t.path.lastSegment();return[r,Dt(t.path.popLast()),e]}function Il(r,t,e,n){return{indexId:r,uid:t,sequenceNumber:e,readTime:dn(n.readTime),documentKey:Dt(n.documentKey.path),largestBatchId:n.largestBatchId}}class J_{getBundleMetadata(t,e){return El(t).get(e).next((n=>{if(n)return(function(i){return{id:i.bundleId,createTime:fn(i.createTime),version:i.version}})(n)}))}saveBundleMetadata(t,e){return El(t).put((function(s){return{bundleId:s.id,createTime:dn(mt(s.createTime)),version:s.version}})(e))}getNamedQuery(t,e){return Tl(t).get(e).next((n=>{if(n)return(function(i){return{name:i.name,query:Ua(i.bundledQuery),readTime:fn(i.readTime)}})(n)}))}saveNamedQuery(t,e){return Tl(t).put((function(s){return{name:s.name,readTime:dn(mt(s.readTime)),bundledQuery:s.bundledQuery}})(e))}}function El(r){return It(r,Si)}function Tl(r){return It(r,Pi)}class Mi{constructor(t,e){this.serializer=t,this.userId=e}static wt(t,e){const n=e.uid||"";return new Mi(t,n)}getOverlay(t,e){return Vr(t).get(yl(this.userId,e)).next((n=>n?Po(this.serializer,n):null))}getOverlays(t,e){const n=Zt();return v.forEach(e,(s=>this.getOverlay(t,s).next((i=>{i!==null&&n.set(s,i)})))).next((()=>n))}saveOverlays(t,e,n){const s=[];return n.forEach(((i,o)=>{const u=new Fa(e,o);s.push(this.St(t,u))})),v.waitFor(s)}removeOverlaysForBatchId(t,e,n){const s=new Set;e.forEach((o=>s.add(Dt(o.getCollectionPath()))));const i=[];return s.forEach((o=>{const u=IDBKeyRange.bound([this.userId,o,n],[this.userId,o,n+1],!1,!0);i.push(Vr(t).Z(Go,u))})),v.waitFor(i)}getOverlaysForCollection(t,e,n){const s=Zt(),i=Dt(e),o=IDBKeyRange.bound([this.userId,i,n],[this.userId,i,Number.POSITIVE_INFINITY],!0);return Vr(t).J(Go,o).next((u=>{for(const c of u){const h=Po(this.serializer,c);s.set(h.getKey(),h)}return s}))}getOverlaysForCollectionGroup(t,e,n,s){const i=Zt();let o;const u=IDBKeyRange.bound([this.userId,e,n],[this.userId,e,Number.POSITIVE_INFINITY],!0);return Vr(t).ee({index:Zh,range:u},((c,h,f)=>{const p=Po(this.serializer,h);i.size()<s||p.largestBatchId===o?(i.set(p.getKey(),p),o=p.largestBatchId):f.done()})).next((()=>i))}St(t,e){return Vr(t).put((function(s,i,o){const[u,c,h]=yl(i,o.mutation.key);return{userId:i,collectionPath:c,documentId:h,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:us(s.yt,o.mutation)}})(this.serializer,this.userId,e))}}function Vr(r){return It(r,Vi)}class X_{bt(t){return It(t,Ra)}getSessionToken(t){return this.bt(t).get("sessionToken").next((e=>{const n=e?.value;return n?dt.fromUint8Array(n):dt.EMPTY_BYTE_STRING}))}setSessionToken(t,e){return this.bt(t).put({name:"sessionToken",value:e.toUint8Array()})}}class tn{constructor(){}Dt(t,e){this.Ct(t,e),e.vt()}Ct(t,e){if("nullValue"in t)this.Ft(e,5);else if("booleanValue"in t)this.Ft(e,10),e.Mt(t.booleanValue?1:0);else if("integerValue"in t)this.Ft(e,15),e.Mt(at(t.integerValue));else if("doubleValue"in t){const n=at(t.doubleValue);isNaN(n)?this.Ft(e,13):(this.Ft(e,15),Zr(n)?e.Mt(0):e.Mt(n))}else if("timestampValue"in t){let n=t.timestampValue;this.Ft(e,20),typeof n=="string"&&(n=ce(n)),e.xt(`${n.seconds||""}`),e.Mt(n.nanos||0)}else if("stringValue"in t)this.Ot(t.stringValue,e),this.Nt(e);else if("bytesValue"in t)this.Ft(e,30),e.Bt(le(t.bytesValue)),this.Nt(e);else if("referenceValue"in t)this.Lt(t.referenceValue,e);else if("geoPointValue"in t){const n=t.geoPointValue;this.Ft(e,45),e.Mt(n.latitude||0),e.Mt(n.longitude||0)}else"mapValue"in t?hd(t)?this.Ft(e,Number.MAX_SAFE_INTEGER):xi(t)?this.kt(t.mapValue,e):(this.qt(t.mapValue,e),this.Nt(e)):"arrayValue"in t?(this.Qt(t.arrayValue,e),this.Nt(e)):F(19022,{$t:t})}Ot(t,e){this.Ft(e,25),this.Ut(t,e)}Ut(t,e){e.xt(t)}qt(t,e){const n=t.fields||{};this.Ft(e,55);for(const s of Object.keys(n))this.Ot(s,e),this.Ct(n[s],e)}kt(t,e){const n=t.fields||{};this.Ft(e,53);const s=Kn,i=n[s].arrayValue?.values?.length||0;this.Ft(e,15),e.Mt(at(i)),this.Ot(s,e),this.Ct(n[s],e)}Qt(t,e){const n=t.values||[];this.Ft(e,50);for(const s of n)this.Ct(s,e)}Lt(t,e){this.Ft(e,37),M.fromName(t).path.forEach((n=>{this.Ft(e,60),this.Ut(n,e)}))}Ft(t,e){t.Mt(e)}Nt(t){t.Mt(2)}}tn.Kt=new tn;const Rn=255;function Y_(r){if(r===0)return 8;let t=0;return r>>4||(t+=4,r<<=4),r>>6||(t+=2,r<<=2),r>>7||(t+=1),t}function wl(r){const t=64-(function(n){let s=0;for(let i=0;i<8;++i){const o=Y_(255&n[i]);if(s+=o,o!==8)break}return s})(r);return Math.ceil(t/8)}class Z_{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Wt(t){const e=t[Symbol.iterator]();let n=e.next();for(;!n.done;)this.Gt(n.value),n=e.next();this.zt()}jt(t){const e=t[Symbol.iterator]();let n=e.next();for(;!n.done;)this.Jt(n.value),n=e.next();this.Ht()}Yt(t){for(const e of t){const n=e.charCodeAt(0);if(n<128)this.Gt(n);else if(n<2048)this.Gt(960|n>>>6),this.Gt(128|63&n);else if(e<"\uD800"||"\uDBFF"<e)this.Gt(480|n>>>12),this.Gt(128|63&n>>>6),this.Gt(128|63&n);else{const s=e.codePointAt(0);this.Gt(240|s>>>18),this.Gt(128|63&s>>>12),this.Gt(128|63&s>>>6),this.Gt(128|63&s)}}this.zt()}Zt(t){for(const e of t){const n=e.charCodeAt(0);if(n<128)this.Jt(n);else if(n<2048)this.Jt(960|n>>>6),this.Jt(128|63&n);else if(e<"\uD800"||"\uDBFF"<e)this.Jt(480|n>>>12),this.Jt(128|63&n>>>6),this.Jt(128|63&n);else{const s=e.codePointAt(0);this.Jt(240|s>>>18),this.Jt(128|63&s>>>12),this.Jt(128|63&s>>>6),this.Jt(128|63&s)}}this.Ht()}Xt(t){const e=this.en(t),n=wl(e);this.tn(1+n),this.buffer[this.position++]=255&n;for(let s=e.length-n;s<e.length;++s)this.buffer[this.position++]=255&e[s]}nn(t){const e=this.en(t),n=wl(e);this.tn(1+n),this.buffer[this.position++]=~(255&n);for(let s=e.length-n;s<e.length;++s)this.buffer[this.position++]=~(255&e[s])}rn(){this.sn(Rn),this.sn(255)}_n(){this.an(Rn),this.an(255)}reset(){this.position=0}seed(t){this.tn(t.length),this.buffer.set(t,this.position),this.position+=t.length}un(){return this.buffer.slice(0,this.position)}en(t){const e=(function(i){const o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,i,!1),new Uint8Array(o.buffer)})(t),n=!!(128&e[0]);e[0]^=n?255:128;for(let s=1;s<e.length;++s)e[s]^=n?255:0;return e}Gt(t){const e=255&t;e===0?(this.sn(0),this.sn(255)):e===Rn?(this.sn(Rn),this.sn(0)):this.sn(e)}Jt(t){const e=255&t;e===0?(this.an(0),this.an(255)):e===Rn?(this.an(Rn),this.an(0)):this.an(t)}zt(){this.sn(0),this.sn(1)}Ht(){this.an(0),this.an(1)}sn(t){this.tn(1),this.buffer[this.position++]=t}an(t){this.tn(1),this.buffer[this.position++]=~t}tn(t){const e=t+this.position;if(e<=this.buffer.length)return;let n=2*this.buffer.length;n<e&&(n=e);const s=new Uint8Array(n);s.set(this.buffer),this.buffer=s}}class ty{constructor(t){this.cn=t}Bt(t){this.cn.Wt(t)}xt(t){this.cn.Yt(t)}Mt(t){this.cn.Xt(t)}vt(){this.cn.rn()}}class ey{constructor(t){this.cn=t}Bt(t){this.cn.jt(t)}xt(t){this.cn.Zt(t)}Mt(t){this.cn.nn(t)}vt(){this.cn._n()}}class Cr{constructor(){this.cn=new Z_,this.ln=new ty(this.cn),this.hn=new ey(this.cn)}seed(t){this.cn.seed(t)}Pn(t){return t===0?this.ln:this.hn}un(){return this.cn.un()}reset(){this.cn.reset()}}class en{constructor(t,e,n,s){this.Tn=t,this.In=e,this.En=n,this.dn=s}An(){const t=this.dn.length,e=t===0||this.dn[t-1]===255?t+1:t,n=new Uint8Array(e);return n.set(this.dn,0),e!==t?n.set([0],this.dn.length):++n[n.length-1],new en(this.Tn,this.In,this.En,n)}Rn(t,e,n){return{indexId:this.Tn,uid:t,arrayValue:ri(this.En),directionalValue:ri(this.dn),orderedDocumentKey:ri(e),documentKey:n.path.toArray()}}Vn(t,e,n){const s=this.Rn(t,e,n);return[s.indexId,s.uid,s.arrayValue,s.directionalValue,s.orderedDocumentKey,s.documentKey]}}function Te(r,t){let e=r.Tn-t.Tn;return e!==0?e:(e=vl(r.En,t.En),e!==0?e:(e=vl(r.dn,t.dn),e!==0?e:M.comparator(r.In,t.In)))}function vl(r,t){for(let e=0;e<r.length&&e<t.length;++e){const n=r[e]-t[e];if(n!==0)return n}return r.length-t.length}function ri(r){return mh()?(function(e){let n="";for(let s=0;s<e.length;s++)n+=String.fromCharCode(e[s]);return n})(r):r}function Al(r){return typeof r!="string"?r:(function(e){const n=new Uint8Array(e.length);for(let s=0;s<e.length;s++)n[s]=e.charCodeAt(s);return n})(r)}class bl{constructor(t){this.mn=new et(((e,n)=>ct.comparator(e.field,n.field))),this.collectionId=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment(),this.fn=t.orderBy,this.gn=[];for(const e of t.filters){const n=e;n.isInequality()?this.mn=this.mn.add(n):this.gn.push(n)}}get pn(){return this.mn.size>1}yn(t){if(L(t.collectionGroup===this.collectionId,49279),this.pn)return!1;const e=jo(t);if(e!==void 0&&!this.wn(e))return!1;const n=Je(t);let s=new Set,i=0,o=0;for(;i<n.length&&this.wn(n[i]);++i)s=s.add(n[i].fieldPath.canonicalString());if(i===n.length)return!0;if(this.mn.size>0){const u=this.mn.getIterator().getNext();if(!s.has(u.field.canonicalString())){const c=n[i];if(!this.Sn(u,c)||!this.bn(this.fn[o++],c))return!1}++i}for(;i<n.length;++i){const u=n[i];if(o>=this.fn.length||!this.bn(this.fn[o++],u))return!1}return!0}Dn(){if(this.pn)return null;let t=new et(ct.comparator);const e=[];for(const n of this.gn)if(!n.field.isKeyField())if(n.op==="array-contains"||n.op==="array-contains-any")e.push(new Hs(n.field,2));else{if(t.has(n.field))continue;t=t.add(n.field),e.push(new Hs(n.field,0))}for(const n of this.fn)n.field.isKeyField()||t.has(n.field)||(t=t.add(n.field),e.push(new Hs(n.field,n.dir==="asc"?0:1)));return new ci(ci.UNKNOWN_ID,this.collectionId,e,Yr.empty())}wn(t){for(const e of this.gn)if(this.Sn(e,t))return!0;return!1}Sn(t,e){if(t===void 0||!t.field.isEqual(e.fieldPath))return!1;const n=t.op==="array-contains"||t.op==="array-contains-any";return e.kind===2===n}bn(t,e){return!!t.field.isEqual(e.fieldPath)&&(e.kind===0&&t.dir==="asc"||e.kind===1&&t.dir==="desc")}}function ef(r){if(L(r instanceof Q||r instanceof tt,20012),r instanceof Q){if(r instanceof Ed){const e=r.value.arrayValue?.values?.map((n=>Q.create(r.field,"==",n)))||[];return tt.create(e,"or")}return r}const t=r.filters.map((e=>ef(e)));return tt.create(t,r.op)}function ny(r){if(r.getFilters().length===0)return[];const t=oa(ef(r));return L(nf(t),7391),sa(t)||ia(t)?[t]:t.getFilters()}function sa(r){return r instanceof Q}function ia(r){return r instanceof tt&&Ca(r)}function nf(r){return sa(r)||ia(r)||(function(e){if(e instanceof tt&&Jo(e)){for(const n of e.getFilters())if(!sa(n)&&!ia(n))return!1;return!0}return!1})(r)}function oa(r){if(L(r instanceof Q||r instanceof tt,34018),r instanceof Q)return r;if(r.filters.length===1)return oa(r.filters[0]);const t=r.filters.map((n=>oa(n)));let e=tt.create(t,r.op);return e=_i(e),nf(e)?e:(L(e instanceof tt,64498),L(Wn(e),40251),L(e.filters.length>1,57927),e.filters.reduce(((n,s)=>qa(n,s))))}function qa(r,t){let e;return L(r instanceof Q||r instanceof tt,38388),L(t instanceof Q||t instanceof tt,25473),e=r instanceof Q?t instanceof Q?(function(s,i){return tt.create([s,i],"and")})(r,t):Rl(r,t):t instanceof Q?Rl(t,r):(function(s,i){if(L(s.filters.length>0&&i.filters.length>0,48005),Wn(s)&&Wn(i))return _d(s,i.getFilters());const o=Jo(s)?s:i,u=Jo(s)?i:s,c=o.filters.map((h=>qa(h,u)));return tt.create(c,"or")})(r,t),_i(e)}function Rl(r,t){if(Wn(t))return _d(t,r.getFilters());{const e=t.filters.map((n=>qa(r,n)));return tt.create(e,"or")}}function _i(r){if(L(r instanceof Q||r instanceof tt,11850),r instanceof Q)return r;const t=r.getFilters();if(t.length===1)return _i(t[0]);if(pd(r))return r;const e=t.map((s=>_i(s))),n=[];return e.forEach((s=>{s instanceof Q?n.push(s):s instanceof tt&&(s.op===r.op?n.push(...s.filters):n.push(s))})),n.length===1?n[0]:tt.create(n,r.op)}class ry{constructor(){this.Cn=new ja}addToCollectionParentIndex(t,e){return this.Cn.add(e),v.resolve()}getCollectionParents(t,e){return v.resolve(this.Cn.getEntries(e))}addFieldIndex(t,e){return v.resolve()}deleteFieldIndex(t,e){return v.resolve()}deleteAllFieldIndexes(t){return v.resolve()}createTargetIndexes(t,e){return v.resolve()}getDocumentsMatchingTarget(t,e){return v.resolve(null)}getIndexType(t,e){return v.resolve(0)}getFieldIndexes(t,e){return v.resolve([])}getNextCollectionGroupToUpdate(t){return v.resolve(null)}getMinOffset(t,e){return v.resolve($t.min())}getMinOffsetFromCollectionGroup(t,e){return v.resolve($t.min())}updateCollectionGroup(t,e,n){return v.resolve()}updateIndexEntries(t,e){return v.resolve()}}class ja{constructor(){this.index={}}add(t){const e=t.lastSegment(),n=t.popLast(),s=this.index[e]||new et(K.comparator),i=!s.has(n);return this.index[e]=s.add(n),i}has(t){const e=t.lastSegment(),n=t.popLast(),s=this.index[e];return s&&s.has(n)}getEntries(t){return(this.index[t]||new et(K.comparator)).toArray()}}const Sl="IndexedDbIndexManager",$s=new Uint8Array(0);class sy{constructor(t,e){this.databaseId=e,this.vn=new ja,this.Fn=new de((n=>cn(n)),((n,s)=>ps(n,s))),this.uid=t.uid||""}addToCollectionParentIndex(t,e){if(!this.vn.has(e)){const n=e.lastSegment(),s=e.popLast();t.addOnCommittedListener((()=>{this.vn.add(e)}));const i={collectionId:n,parent:Dt(s)};return Pl(t).put(i)}return v.resolve()}getCollectionParents(t,e){const n=[],s=IDBKeyRange.bound([e,""],[Bh(e),""],!1,!0);return Pl(t).J(s).next((i=>{for(const o of i){if(o.collectionId!==e)break;n.push(Yt(o.parent))}return n}))}addFieldIndex(t,e){const n=Dr(t),s=(function(u){return{indexId:u.indexId,collectionGroup:u.collectionGroup,fields:u.fields.map((c=>[c.fieldPath.canonicalString(),c.kind]))}})(e);delete s.indexId;const i=n.add(s);if(e.indexState){const o=Pn(t);return i.next((u=>{o.put(Il(u,this.uid,e.indexState.sequenceNumber,e.indexState.offset))}))}return i.next()}deleteFieldIndex(t,e){const n=Dr(t),s=Pn(t),i=Sn(t);return n.delete(e.indexId).next((()=>s.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0)))).next((()=>i.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0))))}deleteAllFieldIndexes(t){const e=Dr(t),n=Sn(t),s=Pn(t);return e.Z().next((()=>n.Z())).next((()=>s.Z()))}createTargetIndexes(t,e){return v.forEach(this.Mn(e),(n=>this.getIndexType(t,n).next((s=>{if(s===0||s===1){const i=new bl(n).Dn();if(i!=null)return this.addFieldIndex(t,i)}}))))}getDocumentsMatchingTarget(t,e){const n=Sn(t);let s=!0;const i=new Map;return v.forEach(this.Mn(e),(o=>this.xn(t,o).next((u=>{s&&(s=!!u),i.set(o,u)})))).next((()=>{if(s){let o=$();const u=[];return v.forEach(i,((c,h)=>{C(Sl,`Using index ${(function(U){return`id=${U.indexId}|cg=${U.collectionGroup}|f=${U.fields.map((nt=>`${nt.fieldPath}:${nt.kind}`)).join(",")}`})(c)} to execute ${cn(e)}`);const f=(function(U,nt){const X=jo(nt);if(X===void 0)return null;for(const H of mi(U,X.fieldPath))switch(H.op){case"array-contains-any":return H.value.arrayValue.values||[];case"array-contains":return[H.value]}return null})(h,c),p=(function(U,nt){const X=new Map;for(const H of Je(nt))for(const E of mi(U,H.fieldPath))switch(E.op){case"==":case"in":X.set(H.fieldPath.canonicalString(),E.value);break;case"not-in":case"!=":return X.set(H.fieldPath.canonicalString(),E.value),Array.from(X.values())}return null})(h,c),_=(function(U,nt){const X=[];let H=!0;for(const E of Je(nt)){const g=E.kind===0?il(U,E.fieldPath,U.startAt):ol(U,E.fieldPath,U.startAt);X.push(g.value),H&&(H=g.inclusive)}return new ke(X,H)})(h,c),R=(function(U,nt){const X=[];let H=!0;for(const E of Je(nt)){const g=E.kind===0?ol(U,E.fieldPath,U.endAt):il(U,E.fieldPath,U.endAt);X.push(g.value),H&&(H=g.inclusive)}return new ke(X,H)})(h,c),x=this.On(c,h,_),N=this.On(c,h,R),D=this.Nn(c,h,p),q=this.Bn(c.indexId,f,x,_.inclusive,N,R.inclusive,D);return v.forEach(q,(j=>n.Y(j,e.limit).next((U=>{U.forEach((nt=>{const X=M.fromSegments(nt.documentKey);o.has(X)||(o=o.add(X),u.push(X))}))}))))})).next((()=>u))}return v.resolve(null)}))}Mn(t){let e=this.Fn.get(t);return e||(t.filters.length===0?e=[t]:e=ny(tt.create(t.filters,"and")).map((n=>Yo(t.path,t.collectionGroup,t.orderBy,n.getFilters(),t.limit,t.startAt,t.endAt))),this.Fn.set(t,e),e)}Bn(t,e,n,s,i,o,u){const c=(e!=null?e.length:1)*Math.max(n.length,i.length),h=c/(e!=null?e.length:1),f=[];for(let p=0;p<c;++p){const _=e?this.Ln(e[p/h]):$s,R=this.kn(t,_,n[p%h],s),x=this.qn(t,_,i[p%h],o),N=u.map((D=>this.kn(t,_,D,!0)));f.push(...this.createRange(R,x,N))}return f}kn(t,e,n,s){const i=new en(t,M.empty(),e,n);return s?i:i.An()}qn(t,e,n,s){const i=new en(t,M.empty(),e,n);return s?i.An():i}xn(t,e){const n=new bl(e),s=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment();return this.getFieldIndexes(t,s).next((i=>{let o=null;for(const u of i)n.yn(u)&&(!o||u.fields.length>o.fields.length)&&(o=u);return o}))}getIndexType(t,e){let n=2;const s=this.Mn(e);return v.forEach(s,(i=>this.xn(t,i).next((o=>{o?n!==0&&o.fields.length<(function(c){let h=new et(ct.comparator),f=!1;for(const p of c.filters)for(const _ of p.getFlattenedFilters())_.field.isKeyField()||(_.op==="array-contains"||_.op==="array-contains-any"?f=!0:h=h.add(_.field));for(const p of c.orderBy)p.field.isKeyField()||(h=h.add(p.field));return h.size+(f?1:0)})(i)&&(n=1):n=0})))).next((()=>(function(o){return o.limit!==null})(e)&&s.length>1&&n===2?1:n))}Qn(t,e){const n=new Cr;for(const s of Je(t)){const i=e.data.field(s.fieldPath);if(i==null)return null;const o=n.Pn(s.kind);tn.Kt.Dt(i,o)}return n.un()}Ln(t){const e=new Cr;return tn.Kt.Dt(t,e.Pn(0)),e.un()}$n(t,e){const n=new Cr;return tn.Kt.Dt(un(this.databaseId,e),n.Pn((function(i){const o=Je(i);return o.length===0?0:o[o.length-1].kind})(t))),n.un()}Nn(t,e,n){if(n===null)return[];let s=[];s.push(new Cr);let i=0;for(const o of Je(t)){const u=n[i++];for(const c of s)if(this.Un(e,o.fieldPath)&&is(u))s=this.Kn(s,o,u);else{const h=c.Pn(o.kind);tn.Kt.Dt(u,h)}}return this.Wn(s)}On(t,e,n){return this.Nn(t,e,n.position)}Wn(t){const e=[];for(let n=0;n<t.length;++n)e[n]=t[n].un();return e}Kn(t,e,n){const s=[...t],i=[];for(const o of n.arrayValue.values||[])for(const u of s){const c=new Cr;c.seed(u.un()),tn.Kt.Dt(o,c.Pn(e.kind)),i.push(c)}return i}Un(t,e){return!!t.filters.find((n=>n instanceof Q&&n.field.isEqual(e)&&(n.op==="in"||n.op==="not-in")))}getFieldIndexes(t,e){const n=Dr(t),s=Pn(t);return(e?n.J($o,IDBKeyRange.bound(e,e)):n.J()).next((i=>{const o=[];return v.forEach(i,(u=>s.get([u.indexId,this.uid]).next((c=>{o.push((function(f,p){const _=p?new Yr(p.sequenceNumber,new $t(fn(p.readTime),new M(Yt(p.documentKey)),p.largestBatchId)):Yr.empty(),R=f.fields.map((([x,N])=>new Hs(ct.fromServerFormat(x),N)));return new ci(f.indexId,f.collectionGroup,R,_)})(u,c))})))).next((()=>o))}))}getNextCollectionGroupToUpdate(t){return this.getFieldIndexes(t).next((e=>e.length===0?null:(e.sort(((n,s)=>{const i=n.indexState.sequenceNumber-s.indexState.sequenceNumber;return i!==0?i:z(n.collectionGroup,s.collectionGroup)})),e[0].collectionGroup)))}updateCollectionGroup(t,e,n){const s=Dr(t),i=Pn(t);return this.Gn(t).next((o=>s.J($o,IDBKeyRange.bound(e,e)).next((u=>v.forEach(u,(c=>i.put(Il(c.indexId,this.uid,o,n))))))))}updateIndexEntries(t,e){const n=new Map;return v.forEach(e,((s,i)=>{const o=n.get(s.collectionGroup);return(o?v.resolve(o):this.getFieldIndexes(t,s.collectionGroup)).next((u=>(n.set(s.collectionGroup,u),v.forEach(u,(c=>this.zn(t,s,c).next((h=>{const f=this.jn(i,c);return h.isEqual(f)?v.resolve():this.Jn(t,i,c,h,f)})))))))}))}Hn(t,e,n,s){return Sn(t).put(s.Rn(this.uid,this.$n(n,e.key),e.key))}Yn(t,e,n,s){return Sn(t).delete(s.Vn(this.uid,this.$n(n,e.key),e.key))}zn(t,e,n){const s=Sn(t);let i=new et(Te);return s.ee({index:Yh,range:IDBKeyRange.only([n.indexId,this.uid,ri(this.$n(n,e))])},((o,u)=>{i=i.add(new en(n.indexId,e,Al(u.arrayValue),Al(u.directionalValue)))})).next((()=>i))}jn(t,e){let n=new et(Te);const s=this.Qn(e,t);if(s==null)return n;const i=jo(e);if(i!=null){const o=t.data.field(i.fieldPath);if(is(o))for(const u of o.arrayValue.values||[])n=n.add(new en(e.indexId,t.key,this.Ln(u),s))}else n=n.add(new en(e.indexId,t.key,$s,s));return n}Jn(t,e,n,s,i){C(Sl,"Updating index entries for document '%s'",e.key);const o=[];return(function(c,h,f,p,_){const R=c.getIterator(),x=h.getIterator();let N=bn(R),D=bn(x);for(;N||D;){let q=!1,j=!1;if(N&&D){const U=f(N,D);U<0?j=!0:U>0&&(q=!0)}else N!=null?j=!0:q=!0;q?(p(D),D=bn(x)):j?(_(N),N=bn(R)):(N=bn(R),D=bn(x))}})(s,i,Te,(u=>{o.push(this.Hn(t,e,n,u))}),(u=>{o.push(this.Yn(t,e,n,u))})),v.waitFor(o)}Gn(t){let e=1;return Pn(t).ee({index:Xh,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},((n,s,i)=>{i.done(),e=s.sequenceNumber+1})).next((()=>e))}createRange(t,e,n){n=n.sort(((o,u)=>Te(o,u))).filter(((o,u,c)=>!u||Te(o,c[u-1])!==0));const s=[];s.push(t);for(const o of n){const u=Te(o,t),c=Te(o,e);if(u===0)s[0]=t.An();else if(u>0&&c<0)s.push(o),s.push(o.An());else if(c>0)break}s.push(e);const i=[];for(let o=0;o<s.length;o+=2){if(this.Zn(s[o],s[o+1]))return[];const u=s[o].Vn(this.uid,$s,M.empty()),c=s[o+1].Vn(this.uid,$s,M.empty());i.push(IDBKeyRange.bound(u,c))}return i}Zn(t,e){return Te(t,e)>0}getMinOffsetFromCollectionGroup(t,e){return this.getFieldIndexes(t,e).next(Vl)}getMinOffset(t,e){return v.mapArray(this.Mn(e),(n=>this.xn(t,n).next((s=>s||F(44426))))).next(Vl)}}function Pl(r){return It(r,ns)}function Sn(r){return It(r,zr)}function Dr(r){return It(r,ba)}function Pn(r){return It(r,jr)}function Vl(r){L(r.length!==0,28825);let t=r[0].indexState.offset,e=t.largestBatchId;for(let n=1;n<r.length;n++){const s=r[n].indexState.offset;wa(s,t)<0&&(t=s),e<s.largestBatchId&&(e=s.largestBatchId)}return new $t(t.readTime,t.documentKey,e)}const Cl={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},rf=41943040;class Ct{static withCacheSize(t){return new Ct(t,Ct.DEFAULT_COLLECTION_PERCENTILE,Ct.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}}function sf(r,t,e){const n=r.store(Gt),s=r.store(jn),i=[],o=IDBKeyRange.only(e.batchId);let u=0;const c=n.ee({range:o},((f,p,_)=>(u++,_.delete())));i.push(c.next((()=>{L(u===1,47070,{batchId:e.batchId})})));const h=[];for(const f of e.mutations){const p=Wh(t,f.key.path,e.batchId);i.push(s.delete(p)),h.push(f.key)}return v.waitFor(i).next((()=>h))}function yi(r){if(!r)return 0;let t;if(r.document)t=r.document;else if(r.unknownDocument)t=r.unknownDocument;else{if(!r.noDocument)throw F(14731);t=r.noDocument}return JSON.stringify(t).length}Ct.DEFAULT_COLLECTION_PERCENTILE=10,Ct.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ct.DEFAULT=new Ct(rf,Ct.DEFAULT_COLLECTION_PERCENTILE,Ct.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ct.DISABLED=new Ct(-1,0,0);class Oi{constructor(t,e,n,s){this.userId=t,this.serializer=e,this.indexManager=n,this.referenceDelegate=s,this.Xn={}}static wt(t,e,n,s){L(t.uid!=="",64387);const i=t.isAuthenticated()?t.uid:"";return new Oi(i,e,n,s)}checkEmpty(t){let e=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return we(t).ee({index:nn,range:n},((s,i,o)=>{e=!1,o.done()})).next((()=>e))}addMutationBatch(t,e,n,s){const i=kn(t),o=we(t);return o.add({}).next((u=>{L(typeof u=="number",49019);const c=new Ma(u,e,n,s),h=(function(R,x,N){const D=N.baseMutations.map((j=>us(R.yt,j))),q=N.mutations.map((j=>us(R.yt,j)));return{userId:x,batchId:N.batchId,localWriteTimeMs:N.localWriteTime.toMillis(),baseMutations:D,mutations:q}})(this.serializer,this.userId,c),f=[];let p=new et(((_,R)=>z(_.canonicalString(),R.canonicalString())));for(const _ of s){const R=Wh(this.userId,_.key.path,u);p=p.add(_.key.path.popLast()),f.push(o.put(h)),f.push(i.put(R,Bg))}return p.forEach((_=>{f.push(this.indexManager.addToCollectionParentIndex(t,_))})),t.addOnCommittedListener((()=>{this.Xn[u]=c.keys()})),v.waitFor(f).next((()=>c))}))}lookupMutationBatch(t,e){return we(t).get(e).next((n=>n?(L(n.userId===this.userId,48,"Unexpected user for mutation batch",{userId:n.userId,batchId:e}),Ze(this.serializer,n)):null))}er(t,e){return this.Xn[e]?v.resolve(this.Xn[e]):this.lookupMutationBatch(t,e).next((n=>{if(n){const s=n.keys();return this.Xn[e]=s,s}return null}))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,s=IDBKeyRange.lowerBound([this.userId,n]);let i=null;return we(t).ee({index:nn,range:s},((o,u,c)=>{u.userId===this.userId&&(L(u.batchId>=n,47524,{tr:n}),i=Ze(this.serializer,u)),c.done()})).next((()=>i))}getHighestUnacknowledgedBatchId(t){const e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=Ve;return we(t).ee({index:nn,range:e,reverse:!0},((s,i,o)=>{n=i.batchId,o.done()})).next((()=>n))}getAllMutationBatches(t){const e=IDBKeyRange.bound([this.userId,Ve],[this.userId,Number.POSITIVE_INFINITY]);return we(t).J(nn,e).next((n=>n.map((s=>Ze(this.serializer,s)))))}getAllMutationBatchesAffectingDocumentKey(t,e){const n=Js(this.userId,e.path),s=IDBKeyRange.lowerBound(n),i=[];return kn(t).ee({range:s},((o,u,c)=>{const[h,f,p]=o,_=Yt(f);if(h===this.userId&&e.path.isEqual(_))return we(t).get(p).next((R=>{if(!R)throw F(61480,{nr:o,batchId:p});L(R.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:R.userId,batchId:p}),i.push(Ze(this.serializer,R))}));c.done()})).next((()=>i))}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new et(z);const s=[];return e.forEach((i=>{const o=Js(this.userId,i.path),u=IDBKeyRange.lowerBound(o),c=kn(t).ee({range:u},((h,f,p)=>{const[_,R,x]=h,N=Yt(R);_===this.userId&&i.path.isEqual(N)?n=n.add(x):p.done()}));s.push(c)})),v.waitFor(s).next((()=>this.rr(t,n)))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,s=n.length+1,i=Js(this.userId,n),o=IDBKeyRange.lowerBound(i);let u=new et(z);return kn(t).ee({range:o},((c,h,f)=>{const[p,_,R]=c,x=Yt(_);p===this.userId&&n.isPrefixOf(x)?x.length===s&&(u=u.add(R)):f.done()})).next((()=>this.rr(t,u)))}rr(t,e){const n=[],s=[];return e.forEach((i=>{s.push(we(t).get(i).next((o=>{if(o===null)throw F(35274,{batchId:i});L(o.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:o.userId,batchId:i}),n.push(Ze(this.serializer,o))})))})),v.waitFor(s).next((()=>n))}removeMutationBatch(t,e){return sf(t.le,this.userId,e).next((n=>(t.addOnCommittedListener((()=>{this.ir(e.batchId)})),v.forEach(n,(s=>this.referenceDelegate.markPotentiallyOrphaned(t,s))))))}ir(t){delete this.Xn[t]}performConsistencyCheck(t){return this.checkEmpty(t).next((e=>{if(!e)return v.resolve();const n=IDBKeyRange.lowerBound((function(o){return[o]})(this.userId)),s=[];return kn(t).ee({range:n},((i,o,u)=>{if(i[0]===this.userId){const c=Yt(i[1]);s.push(c)}else u.done()})).next((()=>{L(s.length===0,56720,{sr:s.map((i=>i.canonicalString()))})}))}))}containsKey(t,e){return of(t,this.userId,e)}_r(t){return af(t).get(this.userId).next((e=>e||{userId:this.userId,lastAcknowledgedBatchId:Ve,lastStreamToken:""}))}}function of(r,t,e){const n=Js(t,e.path),s=n[1],i=IDBKeyRange.lowerBound(n);let o=!1;return kn(r).ee({range:i,X:!0},((u,c,h)=>{const[f,p,_]=u;f===t&&p===s&&(o=!0),h.done()})).next((()=>o))}function we(r){return It(r,Gt)}function kn(r){return It(r,jn)}function af(r){return It(r,ts)}class mn{constructor(t){this.ar=t}next(){return this.ar+=2,this.ar}static ur(){return new mn(0)}static cr(){return new mn(-1)}}class iy{constructor(t,e){this.referenceDelegate=t,this.serializer=e}allocateTargetId(t){return this.lr(t).next((e=>{const n=new mn(e.highestTargetId);return e.highestTargetId=n.next(),this.hr(t,e).next((()=>e.highestTargetId))}))}getLastRemoteSnapshotVersion(t){return this.lr(t).next((e=>B.fromTimestamp(new Z(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds))))}getHighestSequenceNumber(t){return this.lr(t).next((e=>e.highestListenSequenceNumber))}setTargetsMetadata(t,e,n){return this.lr(t).next((s=>(s.highestListenSequenceNumber=e,n&&(s.lastRemoteSnapshotVersion=n.toTimestamp()),e>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=e),this.hr(t,s))))}addTargetData(t,e){return this.Pr(t,e).next((()=>this.lr(t).next((n=>(n.targetCount+=1,this.Tr(e,n),this.hr(t,n))))))}updateTargetData(t,e){return this.Pr(t,e)}removeTargetData(t,e){return this.removeMatchingKeysForTargetId(t,e.targetId).next((()=>Vn(t).delete(e.targetId))).next((()=>this.lr(t))).next((n=>(L(n.targetCount>0,8065),n.targetCount-=1,this.hr(t,n))))}removeTargets(t,e,n){let s=0;const i=[];return Vn(t).ee(((o,u)=>{const c=Fr(u);c.sequenceNumber<=e&&n.get(c.targetId)===null&&(s++,i.push(this.removeTargetData(t,c)))})).next((()=>v.waitFor(i))).next((()=>s))}forEachTarget(t,e){return Vn(t).ee(((n,s)=>{const i=Fr(s);e(i)}))}lr(t){return Dl(t).get(di).next((e=>(L(e!==null,2888),e)))}hr(t,e){return Dl(t).put(di,e)}Pr(t,e){return Vn(t).put(tf(this.serializer,e))}Tr(t,e){let n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n}getTargetCount(t){return this.lr(t).next((e=>e.targetCount))}getTargetData(t,e){const n=cn(e),s=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let i=null;return Vn(t).ee({range:s,index:Jh},((o,u,c)=>{const h=Fr(u);ps(e,h.target)&&(i=h,c.done())})).next((()=>i))}addMatchingKeys(t,e,n){const s=[],i=Ae(t);return e.forEach((o=>{const u=Dt(o.path);s.push(i.put({targetId:n,path:u})),s.push(this.referenceDelegate.addReference(t,n,o))})),v.waitFor(s)}removeMatchingKeys(t,e,n){const s=Ae(t);return v.forEach(e,(i=>{const o=Dt(i.path);return v.waitFor([s.delete([n,o]),this.referenceDelegate.removeReference(t,n,i)])}))}removeMatchingKeysForTargetId(t,e){const n=Ae(t),s=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(s)}getMatchingKeysForTargetId(t,e){const n=IDBKeyRange.bound([e],[e+1],!1,!0),s=Ae(t);let i=$();return s.ee({range:n,X:!0},((o,u,c)=>{const h=Yt(o[1]),f=new M(h);i=i.add(f)})).next((()=>i))}containsKey(t,e){const n=Dt(e.path),s=IDBKeyRange.bound([n],[Bh(n)],!1,!0);let i=0;return Ae(t).ee({index:Aa,X:!0,range:s},(([o,u],c,h)=>{o!==0&&(i++,h.done())})).next((()=>i>0))}At(t,e){return Vn(t).get(e).next((n=>n?Fr(n):null))}}function Vn(r){return It(r,zn)}function Dl(r){return It(r,on)}function Ae(r){return It(r,$n)}const xl="LruGarbageCollector",oy=1048576;function Nl([r,t],[e,n]){const s=z(r,e);return s===0?z(t,n):s}class ay{constructor(t){this.Ir=t,this.buffer=new et(Nl),this.Er=0}dr(){return++this.Er}Ar(t){const e=[t,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(e);else{const n=this.buffer.last();Nl(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}}get maxValue(){return this.buffer.last()[0]}}class uf{constructor(t,e,n){this.garbageCollector=t,this.asyncQueue=e,this.localStore=n,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(t){C(xl,`Garbage collection scheduled in ${t}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){Le(e)?C(xl,"Ignoring IndexedDB error during garbage collection: ",e):await Fe(e)}await this.Vr(3e5)}))}}class uy{constructor(t,e){this.mr=t,this.params=e}calculateTargetCount(t,e){return this.mr.gr(t).next((n=>Math.floor(e/100*n)))}nthSequenceNumber(t,e){if(e===0)return v.resolve(Ft.ce);const n=new ay(e);return this.mr.forEachTarget(t,(s=>n.Ar(s.sequenceNumber))).next((()=>this.mr.pr(t,(s=>n.Ar(s))))).next((()=>n.maxValue))}removeTargets(t,e,n){return this.mr.removeTargets(t,e,n)}removeOrphanedDocuments(t,e){return this.mr.removeOrphanedDocuments(t,e)}collect(t,e){return this.params.cacheSizeCollectionThreshold===-1?(C("LruGarbageCollector","Garbage collection skipped; disabled"),v.resolve(Cl)):this.getCacheSize(t).next((n=>n<this.params.cacheSizeCollectionThreshold?(C("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Cl):this.yr(t,e)))}getCacheSize(t){return this.mr.getCacheSize(t)}yr(t,e){let n,s,i,o,u,c,h;const f=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next((p=>(p>this.params.maximumSequenceNumbersToCollect?(C("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${p}`),s=this.params.maximumSequenceNumbersToCollect):s=p,o=Date.now(),this.nthSequenceNumber(t,s)))).next((p=>(n=p,u=Date.now(),this.removeTargets(t,n,e)))).next((p=>(i=p,c=Date.now(),this.removeOrphanedDocuments(t,n)))).next((p=>(h=Date.now(),Cn()<=W.DEBUG&&C("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-f}ms
	Determined least recently used ${s} in `+(u-o)+`ms
	Removed ${i} targets in `+(c-u)+`ms
	Removed ${p} documents in `+(h-c)+`ms
Total Duration: ${h-f}ms`),v.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:p}))))}}function cf(r,t){return new uy(r,t)}class cy{constructor(t,e){this.db=t,this.garbageCollector=cf(this,e)}gr(t){const e=this.wr(t);return this.db.getTargetCache().getTargetCount(t).next((n=>e.next((s=>n+s))))}wr(t){let e=0;return this.pr(t,(n=>{e++})).next((()=>e))}forEachTarget(t,e){return this.db.getTargetCache().forEachTarget(t,e)}pr(t,e){return this.Sr(t,((n,s)=>e(s)))}addReference(t,e,n){return Gs(t,n)}removeReference(t,e,n){return Gs(t,n)}removeTargets(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)}markPotentiallyOrphaned(t,e){return Gs(t,e)}br(t,e){return(function(s,i){let o=!1;return af(s).te((u=>of(s,u,i).next((c=>(c&&(o=!0),v.resolve(!c)))))).next((()=>o))})(t,e)}removeOrphanedDocuments(t,e){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this.Sr(t,((o,u)=>{if(u<=e){const c=this.br(t,o).next((h=>{if(!h)return i++,n.getEntry(t,o).next((()=>(n.removeEntry(o,B.min()),Ae(t).delete((function(p){return[0,Dt(p.path)]})(o)))))}));s.push(c)}})).next((()=>v.waitFor(s))).next((()=>n.apply(t))).next((()=>i))}removeTarget(t,e){const n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)}updateLimboDocument(t,e){return Gs(t,e)}Sr(t,e){const n=Ae(t);let s,i=Ft.ce;return n.ee({index:Aa},(([o,u],{path:c,sequenceNumber:h})=>{o===0?(i!==Ft.ce&&e(new M(Yt(s)),i),i=h,s=c):i=Ft.ce})).next((()=>{i!==Ft.ce&&e(new M(Yt(s)),i)}))}getCacheSize(t){return this.db.getRemoteDocumentCache().getSize(t)}}function Gs(r,t){return Ae(r).put((function(n,s){return{targetId:0,path:Dt(n.path),sequenceNumber:s}})(t,r.currentSequenceNumber))}class lf{constructor(){this.changes=new de((t=>t.toString()),((t,e)=>t.isEqual(e))),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,ot.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const n=this.changes.get(e);return n!==void 0?v.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class ly{constructor(t){this.serializer=t}setIndexManager(t){this.indexManager=t}addEntry(t,e,n){return We(t).put(n)}removeEntry(t,e,n){return We(t).delete((function(i,o){const u=i.path.toArray();return[u.slice(0,u.length-2),u[u.length-2],gi(o),u[u.length-1]]})(e,n))}updateMetadata(t,e){return this.getMetadata(t).next((n=>(n.byteSize+=e,this.Dr(t,n))))}getEntry(t,e){let n=ot.newInvalidDocument(e);return We(t).ee({index:Xs,range:IDBKeyRange.only(xr(e))},((s,i)=>{n=this.Cr(e,i)})).next((()=>n))}vr(t,e){let n={size:0,document:ot.newInvalidDocument(e)};return We(t).ee({index:Xs,range:IDBKeyRange.only(xr(e))},((s,i)=>{n={document:this.Cr(e,i),size:yi(i)}})).next((()=>n))}getEntries(t,e){let n=Bt();return this.Fr(t,e,((s,i)=>{const o=this.Cr(s,i);n=n.insert(s,o)})).next((()=>n))}Mr(t,e){let n=Bt(),s=new st(M.comparator);return this.Fr(t,e,((i,o)=>{const u=this.Cr(i,o);n=n.insert(i,u),s=s.insert(i,yi(o))})).next((()=>({documents:n,Or:s})))}Fr(t,e,n){if(e.isEmpty())return v.resolve();let s=new et(Ol);e.forEach((c=>s=s.add(c)));const i=IDBKeyRange.bound(xr(s.first()),xr(s.last())),o=s.getIterator();let u=o.getNext();return We(t).ee({index:Xs,range:i},((c,h,f)=>{const p=M.fromSegments([...h.prefixPath,h.collectionGroup,h.documentId]);for(;u&&Ol(u,p)<0;)n(u,null),u=o.getNext();u&&u.isEqual(p)&&(n(u,h),u=o.hasNext()?o.getNext():null),u?f.j(xr(u)):f.done()})).next((()=>{for(;u;)n(u,null),u=o.hasNext()?o.getNext():null}))}getDocumentsMatchingQuery(t,e,n,s,i){const o=e.path,u=[o.popLast().toArray(),o.lastSegment(),gi(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],c=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return We(t).J(IDBKeyRange.bound(u,c,!0)).next((h=>{i?.incrementDocumentReadCount(h.length);let f=Bt();for(const p of h){const _=this.Cr(M.fromSegments(p.prefixPath.concat(p.collectionGroup,p.documentId)),p);_.isFoundDocument()&&(_s(e,_)||s.has(_.key))&&(f=f.insert(_.key,_))}return f}))}getAllFromCollectionGroup(t,e,n,s){let i=Bt();const o=Ml(e,n),u=Ml(e,$t.max());return We(t).ee({index:Hh,range:IDBKeyRange.bound(o,u,!0)},((c,h,f)=>{const p=this.Cr(M.fromSegments(h.prefixPath.concat(h.collectionGroup,h.documentId)),h);i=i.insert(p.key,p),i.size===s&&f.done()})).next((()=>i))}newChangeBuffer(t){return new hy(this,!!t&&t.trackRemovals)}getSize(t){return this.getMetadata(t).next((e=>e.byteSize))}getMetadata(t){return kl(t).get(zo).next((e=>(L(!!e,20021),e)))}Dr(t,e){return kl(t).put(zo,e)}Cr(t,e){if(e){const n=H_(this.serializer,e);if(!(n.isNoDocument()&&n.version.isEqual(B.min())))return n}return ot.newInvalidDocument(t)}}function hf(r){return new ly(r)}class hy extends lf{constructor(t,e){super(),this.Nr=t,this.trackRemovals=e,this.Br=new de((n=>n.toString()),((n,s)=>n.isEqual(s)))}applyChanges(t){const e=[];let n=0,s=new et(((i,o)=>z(i.canonicalString(),o.canonicalString())));return this.changes.forEach(((i,o)=>{const u=this.Br.get(i);if(e.push(this.Nr.removeEntry(t,i,u.readTime)),o.isValidDocument()){const c=_l(this.Nr.serializer,o);s=s.add(i.path.popLast());const h=yi(c);n+=h-u.size,e.push(this.Nr.addEntry(t,i,c))}else if(n-=u.size,this.trackRemovals){const c=_l(this.Nr.serializer,o.convertToNoDocument(B.min()));e.push(this.Nr.addEntry(t,i,c))}})),s.forEach((i=>{e.push(this.Nr.indexManager.addToCollectionParentIndex(t,i))})),e.push(this.Nr.updateMetadata(t,n)),v.waitFor(e)}getFromCache(t,e){return this.Nr.vr(t,e).next((n=>(this.Br.set(e,{size:n.size,readTime:n.document.readTime}),n.document)))}getAllFromCache(t,e){return this.Nr.Mr(t,e).next((({documents:n,Or:s})=>(s.forEach(((i,o)=>{this.Br.set(i,{size:o,readTime:n.get(i).readTime})})),n)))}}function kl(r){return It(r,es)}function We(r){return It(r,hi)}function xr(r){const t=r.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function Ml(r,t){const e=t.documentKey.path.toArray();return[r,gi(t.readTime),e.slice(0,e.length-2),e.length>0?e[e.length-1]:""]}function Ol(r,t){const e=r.path.toArray(),n=t.path.toArray();let s=0;for(let i=0;i<e.length-2&&i<n.length-2;++i)if(s=z(e[i],n[i]),s)return s;return s=z(e.length,n.length),s||(s=z(e[e.length-2],n[n.length-2]),s||z(e[e.length-1],n[n.length-1]))}class dy{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}}class df{constructor(t,e,n,s){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=n,this.indexManager=s}getDocument(t,e){let n=null;return this.documentOverlayCache.getOverlay(t,e).next((s=>(n=s,this.remoteDocumentCache.getEntry(t,e)))).next((s=>(n!==null&&Kr(n.mutation,s,Lt.empty(),Z.now()),s)))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next((n=>this.getLocalViewOfDocuments(t,n,$()).next((()=>n))))}getLocalViewOfDocuments(t,e,n=$()){const s=Zt();return this.populateOverlays(t,s,e).next((()=>this.computeViews(t,e,s,n).next((i=>{let o=Mr();return i.forEach(((u,c)=>{o=o.insert(u,c.overlayedDocument)})),o}))))}getOverlayedDocuments(t,e){const n=Zt();return this.populateOverlays(t,n,e).next((()=>this.computeViews(t,e,n,$())))}populateOverlays(t,e,n){const s=[];return n.forEach((i=>{e.has(i)||s.push(i)})),this.documentOverlayCache.getOverlays(t,s).next((i=>{i.forEach(((o,u)=>{e.set(o,u)}))}))}computeViews(t,e,n,s){let i=Bt();const o=Gr(),u=(function(){return Gr()})();return e.forEach(((c,h)=>{const f=n.get(h.key);s.has(h.key)&&(f===void 0||f.mutation instanceof fe)?i=i.insert(h.key,h):f!==void 0?(o.set(h.key,f.mutation.getFieldMask()),Kr(f.mutation,h,f.mutation.getFieldMask(),Z.now())):o.set(h.key,Lt.empty())})),this.recalculateAndSaveOverlays(t,i).next((c=>(c.forEach(((h,f)=>o.set(h,f))),e.forEach(((h,f)=>u.set(h,new dy(f,o.get(h)??null)))),u)))}recalculateAndSaveOverlays(t,e){const n=Gr();let s=new st(((o,u)=>o-u)),i=$();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next((o=>{for(const u of o)u.keys().forEach((c=>{const h=e.get(c);if(h===null)return;let f=n.get(c)||Lt.empty();f=u.applyToLocalView(h,f),n.set(c,f);const p=(s.get(u.batchId)||$()).add(c);s=s.insert(u.batchId,p)}))})).next((()=>{const o=[],u=s.getReverseIterator();for(;u.hasNext();){const c=u.getNext(),h=c.key,f=c.value,p=Sd();f.forEach((_=>{if(!i.has(_)){const R=kd(e.get(_),n.get(_));R!==null&&p.set(_,R),i=i.add(_)}})),o.push(this.documentOverlayCache.saveOverlays(t,h,p))}return v.waitFor(o)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next((n=>this.recalculateAndSaveOverlays(t,n)))}getDocumentsMatchingQuery(t,e,n,s){return(function(o){return M.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0})(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):Da(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,n,s):this.getDocumentsMatchingCollectionQuery(t,e,n,s)}getNextDocuments(t,e,n,s){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,n,s).next((i=>{const o=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,n.largestBatchId,s-i.size):v.resolve(Zt());let u=qn,c=i;return o.next((h=>v.forEach(h,((f,p)=>(u<p.largestBatchId&&(u=p.largestBatchId),i.get(f)?v.resolve():this.remoteDocumentCache.getEntry(t,f).next((_=>{c=c.insert(f,_)}))))).next((()=>this.populateOverlays(t,h,i))).next((()=>this.computeViews(t,c,h,$()))).next((f=>({batchId:u,changes:Rd(f)})))))}))}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new M(e)).next((n=>{let s=Mr();return n.isFoundDocument()&&(s=s.insert(n.key,n)),s}))}getDocumentsMatchingCollectionGroupQuery(t,e,n,s){const i=e.collectionGroup;let o=Mr();return this.indexManager.getCollectionParents(t,i).next((u=>v.forEach(u,(c=>{const h=(function(p,_){return new he(_,null,p.explicitOrderBy.slice(),p.filters.slice(),p.limit,p.limitType,p.startAt,p.endAt)})(e,c.child(i));return this.getDocumentsMatchingCollectionQuery(t,h,n,s).next((f=>{f.forEach(((p,_)=>{o=o.insert(p,_)}))}))})).next((()=>o))))}getDocumentsMatchingCollectionQuery(t,e,n,s){let i;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,n.largestBatchId).next((o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,n,i,s)))).next((o=>{i.forEach(((c,h)=>{const f=h.getKey();o.get(f)===null&&(o=o.insert(f,ot.newInvalidDocument(f)))}));let u=Mr();return o.forEach(((c,h)=>{const f=i.get(c);f!==void 0&&Kr(f.mutation,h,Lt.empty(),Z.now()),_s(e,h)&&(u=u.insert(c,h))})),u}))}}class fy{constructor(t){this.serializer=t,this.Lr=new Map,this.kr=new Map}getBundleMetadata(t,e){return v.resolve(this.Lr.get(e))}saveBundleMetadata(t,e){return this.Lr.set(e.id,(function(s){return{id:s.id,version:s.version,createTime:mt(s.createTime)}})(e)),v.resolve()}getNamedQuery(t,e){return v.resolve(this.kr.get(e))}saveNamedQuery(t,e){return this.kr.set(e.name,(function(s){return{name:s.name,query:Ua(s.bundledQuery),readTime:mt(s.readTime)}})(e)),v.resolve()}}class my{constructor(){this.overlays=new st(M.comparator),this.qr=new Map}getOverlay(t,e){return v.resolve(this.overlays.get(e))}getOverlays(t,e){const n=Zt();return v.forEach(e,(s=>this.getOverlay(t,s).next((i=>{i!==null&&n.set(s,i)})))).next((()=>n))}saveOverlays(t,e,n){return n.forEach(((s,i)=>{this.St(t,e,i)})),v.resolve()}removeOverlaysForBatchId(t,e,n){const s=this.qr.get(n);return s!==void 0&&(s.forEach((i=>this.overlays=this.overlays.remove(i))),this.qr.delete(n)),v.resolve()}getOverlaysForCollection(t,e,n){const s=Zt(),i=e.length+1,o=new M(e.child("")),u=this.overlays.getIteratorFrom(o);for(;u.hasNext();){const c=u.getNext().value,h=c.getKey();if(!e.isPrefixOf(h.path))break;h.path.length===i&&c.largestBatchId>n&&s.set(c.getKey(),c)}return v.resolve(s)}getOverlaysForCollectionGroup(t,e,n,s){let i=new st(((h,f)=>h-f));const o=this.overlays.getIterator();for(;o.hasNext();){const h=o.getNext().value;if(h.getKey().getCollectionGroup()===e&&h.largestBatchId>n){let f=i.get(h.largestBatchId);f===null&&(f=Zt(),i=i.insert(h.largestBatchId,f)),f.set(h.getKey(),h)}}const u=Zt(),c=i.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach(((h,f)=>u.set(h,f))),!(u.size()>=s)););return v.resolve(u)}St(t,e,n){const s=this.overlays.get(n.key);if(s!==null){const o=this.qr.get(s.largestBatchId).delete(n.key);this.qr.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(n.key,new Fa(e,n));let i=this.qr.get(e);i===void 0&&(i=$(),this.qr.set(e,i)),this.qr.set(e,i.add(n.key))}}class py{constructor(){this.sessionToken=dt.EMPTY_BYTE_STRING}getSessionToken(t){return v.resolve(this.sessionToken)}setSessionToken(t,e){return this.sessionToken=e,v.resolve()}}class za{constructor(){this.Qr=new et(Tt.$r),this.Ur=new et(Tt.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(t,e){const n=new Tt(t,e);this.Qr=this.Qr.add(n),this.Ur=this.Ur.add(n)}Wr(t,e){t.forEach((n=>this.addReference(n,e)))}removeReference(t,e){this.Gr(new Tt(t,e))}zr(t,e){t.forEach((n=>this.removeReference(n,e)))}jr(t){const e=new M(new K([])),n=new Tt(e,t),s=new Tt(e,t+1),i=[];return this.Ur.forEachInRange([n,s],(o=>{this.Gr(o),i.push(o.key)})),i}Jr(){this.Qr.forEach((t=>this.Gr(t)))}Gr(t){this.Qr=this.Qr.delete(t),this.Ur=this.Ur.delete(t)}Hr(t){const e=new M(new K([])),n=new Tt(e,t),s=new Tt(e,t+1);let i=$();return this.Ur.forEachInRange([n,s],(o=>{i=i.add(o.key)})),i}containsKey(t){const e=new Tt(t,0),n=this.Qr.firstAfterOrEqual(e);return n!==null&&t.isEqual(n.key)}}class Tt{constructor(t,e){this.key=t,this.Yr=e}static $r(t,e){return M.comparator(t.key,e.key)||z(t.Yr,e.Yr)}static Kr(t,e){return z(t.Yr,e.Yr)||M.comparator(t.key,e.key)}}class gy{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.tr=1,this.Zr=new et(Tt.$r)}checkEmpty(t){return v.resolve(this.mutationQueue.length===0)}addMutationBatch(t,e,n,s){const i=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new Ma(i,e,n,s);this.mutationQueue.push(o);for(const u of s)this.Zr=this.Zr.add(new Tt(u.key,i)),this.indexManager.addToCollectionParentIndex(t,u.key.path.popLast());return v.resolve(o)}lookupMutationBatch(t,e){return v.resolve(this.Xr(e))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,s=this.ei(n),i=s<0?0:s;return v.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return v.resolve(this.mutationQueue.length===0?Ve:this.tr-1)}getAllMutationBatches(t){return v.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const n=new Tt(e,0),s=new Tt(e,Number.POSITIVE_INFINITY),i=[];return this.Zr.forEachInRange([n,s],(o=>{const u=this.Xr(o.Yr);i.push(u)})),v.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new et(z);return e.forEach((s=>{const i=new Tt(s,0),o=new Tt(s,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([i,o],(u=>{n=n.add(u.Yr)}))})),v.resolve(this.ti(n))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,s=n.length+1;let i=n;M.isDocumentKey(i)||(i=i.child(""));const o=new Tt(new M(i),0);let u=new et(z);return this.Zr.forEachWhile((c=>{const h=c.key.path;return!!n.isPrefixOf(h)&&(h.length===s&&(u=u.add(c.Yr)),!0)}),o),v.resolve(this.ti(u))}ti(t){const e=[];return t.forEach((n=>{const s=this.Xr(n);s!==null&&e.push(s)})),e}removeMutationBatch(t,e){L(this.ni(e.batchId,"removed")===0,55003),this.mutationQueue.shift();let n=this.Zr;return v.forEach(e.mutations,(s=>{const i=new Tt(s.key,e.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(t,s.key)})).next((()=>{this.Zr=n}))}ir(t){}containsKey(t,e){const n=new Tt(e,0),s=this.Zr.firstAfterOrEqual(n);return v.resolve(e.isEqual(s&&s.key))}performConsistencyCheck(t){return this.mutationQueue.length,v.resolve()}ni(t,e){return this.ei(t)}ei(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}Xr(t){const e=this.ei(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}class _y{constructor(t){this.ri=t,this.docs=(function(){return new st(M.comparator)})(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const n=e.key,s=this.docs.get(n),i=s?s.size:0,o=this.ri(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const n=this.docs.get(e);return v.resolve(n?n.document.mutableCopy():ot.newInvalidDocument(e))}getEntries(t,e){let n=Bt();return e.forEach((s=>{const i=this.docs.get(s);n=n.insert(s,i?i.document.mutableCopy():ot.newInvalidDocument(s))})),v.resolve(n)}getDocumentsMatchingQuery(t,e,n,s){let i=Bt();const o=e.path,u=new M(o.child("__id-9223372036854775808__")),c=this.docs.getIteratorFrom(u);for(;c.hasNext();){const{key:h,value:{document:f}}=c.getNext();if(!o.isPrefixOf(h.path))break;h.path.length>o.length+1||wa(zh(f),n)<=0||(s.has(f.key)||_s(e,f))&&(i=i.insert(f.key,f.mutableCopy()))}return v.resolve(i)}getAllFromCollectionGroup(t,e,n,s){F(9500)}ii(t,e){return v.forEach(this.docs,(n=>e(n)))}newChangeBuffer(t){return new yy(this)}getSize(t){return v.resolve(this.size)}}class yy extends lf{constructor(t){super(),this.Nr=t}applyChanges(t){const e=[];return this.changes.forEach(((n,s)=>{s.isValidDocument()?e.push(this.Nr.addEntry(t,s)):this.Nr.removeEntry(n)})),v.waitFor(e)}getFromCache(t,e){return this.Nr.getEntry(t,e)}getAllFromCache(t,e){return this.Nr.getEntries(t,e)}}class Iy{constructor(t){this.persistence=t,this.si=new de((e=>cn(e)),ps),this.lastRemoteSnapshotVersion=B.min(),this.highestTargetId=0,this.oi=0,this._i=new za,this.targetCount=0,this.ai=mn.ur()}forEachTarget(t,e){return this.si.forEach(((n,s)=>e(s))),v.resolve()}getLastRemoteSnapshotVersion(t){return v.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return v.resolve(this.oi)}allocateTargetId(t){return this.highestTargetId=this.ai.next(),v.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.oi&&(this.oi=e),v.resolve()}Pr(t){this.si.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.ai=new mn(e),this.highestTargetId=e),t.sequenceNumber>this.oi&&(this.oi=t.sequenceNumber)}addTargetData(t,e){return this.Pr(e),this.targetCount+=1,v.resolve()}updateTargetData(t,e){return this.Pr(e),v.resolve()}removeTargetData(t,e){return this.si.delete(e.target),this._i.jr(e.targetId),this.targetCount-=1,v.resolve()}removeTargets(t,e,n){let s=0;const i=[];return this.si.forEach(((o,u)=>{u.sequenceNumber<=e&&n.get(u.targetId)===null&&(this.si.delete(o),i.push(this.removeMatchingKeysForTargetId(t,u.targetId)),s++)})),v.waitFor(i).next((()=>s))}getTargetCount(t){return v.resolve(this.targetCount)}getTargetData(t,e){const n=this.si.get(e)||null;return v.resolve(n)}addMatchingKeys(t,e,n){return this._i.Wr(e,n),v.resolve()}removeMatchingKeys(t,e,n){this._i.zr(e,n);const s=this.persistence.referenceDelegate,i=[];return s&&e.forEach((o=>{i.push(s.markPotentiallyOrphaned(t,o))})),v.waitFor(i)}removeMatchingKeysForTargetId(t,e){return this._i.jr(e),v.resolve()}getMatchingKeysForTargetId(t,e){const n=this._i.Hr(e);return v.resolve(n)}containsKey(t,e){return v.resolve(this._i.containsKey(e))}}class $a{constructor(t,e){this.ui={},this.overlays={},this.ci=new Ft(0),this.li=!1,this.li=!0,this.hi=new py,this.referenceDelegate=t(this),this.Pi=new Iy(this),this.indexManager=new ry,this.remoteDocumentCache=(function(s){return new _y(s)})((n=>this.referenceDelegate.Ti(n))),this.serializer=new Zd(e),this.Ii=new fy(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new my,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.ui[t.toKey()];return n||(n=new gy(e,this.referenceDelegate),this.ui[t.toKey()]=n),n}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(t,e,n){C("MemoryPersistence","Starting transaction:",t);const s=new Ey(this.ci.next());return this.referenceDelegate.Ei(),n(s).next((i=>this.referenceDelegate.di(s).next((()=>i)))).toPromise().then((i=>(s.raiseOnCommittedEvent(),i)))}Ai(t,e){return v.or(Object.values(this.ui).map((n=>()=>n.containsKey(t,e))))}}class Ey extends Gh{constructor(t){super(),this.currentSequenceNumber=t}}class Fi{constructor(t){this.persistence=t,this.Ri=new za,this.Vi=null}static mi(t){return new Fi(t)}get fi(){if(this.Vi)return this.Vi;throw F(60996)}addReference(t,e,n){return this.Ri.addReference(n,e),this.fi.delete(n.toString()),v.resolve()}removeReference(t,e,n){return this.Ri.removeReference(n,e),this.fi.add(n.toString()),v.resolve()}markPotentiallyOrphaned(t,e){return this.fi.add(e.toString()),v.resolve()}removeTarget(t,e){this.Ri.jr(e.targetId).forEach((s=>this.fi.add(s.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next((s=>{s.forEach((i=>this.fi.add(i.toString())))})).next((()=>n.removeTargetData(t,e)))}Ei(){this.Vi=new Set}di(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return v.forEach(this.fi,(n=>{const s=M.fromPath(n);return this.gi(t,s).next((i=>{i||e.removeEntry(s,B.min())}))})).next((()=>(this.Vi=null,e.apply(t))))}updateLimboDocument(t,e){return this.gi(t,e).next((n=>{n?this.fi.delete(e.toString()):this.fi.add(e.toString())}))}Ti(t){return 0}gi(t,e){return v.or([()=>v.resolve(this.Ri.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Ai(t,e)])}}class Ii{constructor(t,e){this.persistence=t,this.pi=new de((n=>Dt(n.path)),((n,s)=>n.isEqual(s))),this.garbageCollector=cf(this,e)}static mi(t,e){return new Ii(t,e)}Ei(){}di(t){return v.resolve()}forEachTarget(t,e){return this.persistence.getTargetCache().forEachTarget(t,e)}gr(t){const e=this.wr(t);return this.persistence.getTargetCache().getTargetCount(t).next((n=>e.next((s=>n+s))))}wr(t){let e=0;return this.pr(t,(n=>{e++})).next((()=>e))}pr(t,e){return v.forEach(this.pi,((n,s)=>this.br(t,n,s).next((i=>i?v.resolve():e(s)))))}removeTargets(t,e,n){return this.persistence.getTargetCache().removeTargets(t,e,n)}removeOrphanedDocuments(t,e){let n=0;const s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.ii(t,(o=>this.br(t,o,e).next((u=>{u||(n++,i.removeEntry(o,B.min()))})))).next((()=>i.apply(t))).next((()=>n))}markPotentiallyOrphaned(t,e){return this.pi.set(e,t.currentSequenceNumber),v.resolve()}removeTarget(t,e){const n=e.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,n)}addReference(t,e,n){return this.pi.set(n,t.currentSequenceNumber),v.resolve()}removeReference(t,e,n){return this.pi.set(n,t.currentSequenceNumber),v.resolve()}updateLimboDocument(t,e){return this.pi.set(e,t.currentSequenceNumber),v.resolve()}Ti(t){let e=t.key.toString().length;return t.isFoundDocument()&&(e+=Zs(t.data.value)),e}br(t,e,n){return v.or([()=>this.persistence.Ai(t,e),()=>this.persistence.getTargetCache().containsKey(t,e),()=>{const s=this.pi.get(e);return v.resolve(s!==void 0&&s>n)}])}getCacheSize(t){return this.persistence.getRemoteDocumentCache().getSize(t)}}class Ty{constructor(t){this.serializer=t}k(t,e,n,s){const i=new Ri("createOrUpgrade",e);n<1&&s>=1&&((function(c){c.createObjectStore(ms)})(t),(function(c){c.createObjectStore(ts,{keyPath:Lg}),c.createObjectStore(Gt,{keyPath:Qc,autoIncrement:!0}).createIndex(nn,Wc,{unique:!0}),c.createObjectStore(jn)})(t),Fl(t),(function(c){c.createObjectStore(Xe)})(t));let o=v.resolve();return n<3&&s>=3&&(n!==0&&((function(c){c.deleteObjectStore($n),c.deleteObjectStore(zn),c.deleteObjectStore(on)})(t),Fl(t)),o=o.next((()=>(function(c){const h=c.store(on),f={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:B.min().toTimestamp(),targetCount:0};return h.put(di,f)})(i)))),n<4&&s>=4&&(n!==0&&(o=o.next((()=>(function(c,h){return h.store(Gt).J().next((p=>{c.deleteObjectStore(Gt),c.createObjectStore(Gt,{keyPath:Qc,autoIncrement:!0}).createIndex(nn,Wc,{unique:!0});const _=h.store(Gt),R=p.map((x=>_.put(x)));return v.waitFor(R)}))})(t,i)))),o=o.next((()=>{(function(c){c.createObjectStore(Gn,{keyPath:Qg})})(t)}))),n<5&&s>=5&&(o=o.next((()=>this.yi(i)))),n<6&&s>=6&&(o=o.next((()=>((function(c){c.createObjectStore(es)})(t),this.wi(i))))),n<7&&s>=7&&(o=o.next((()=>this.Si(i)))),n<8&&s>=8&&(o=o.next((()=>this.bi(t,i)))),n<9&&s>=9&&(o=o.next((()=>{(function(c){c.objectStoreNames.contains("remoteDocumentChanges")&&c.deleteObjectStore("remoteDocumentChanges")})(t)}))),n<10&&s>=10&&(o=o.next((()=>this.Di(i)))),n<11&&s>=11&&(o=o.next((()=>{(function(c){c.createObjectStore(Si,{keyPath:Wg})})(t),(function(c){c.createObjectStore(Pi,{keyPath:Hg})})(t)}))),n<12&&s>=12&&(o=o.next((()=>{(function(c){const h=c.createObjectStore(Vi,{keyPath:n_});h.createIndex(Go,r_,{unique:!1}),h.createIndex(Zh,s_,{unique:!1})})(t)}))),n<13&&s>=13&&(o=o.next((()=>(function(c){const h=c.createObjectStore(hi,{keyPath:Ug});h.createIndex(Xs,qg),h.createIndex(Hh,jg)})(t))).next((()=>this.Ci(t,i))).next((()=>t.deleteObjectStore(Xe)))),n<14&&s>=14&&(o=o.next((()=>this.Fi(t,i)))),n<15&&s>=15&&(o=o.next((()=>(function(c){c.createObjectStore(ba,{keyPath:Jg,autoIncrement:!0}).createIndex($o,Xg,{unique:!1}),c.createObjectStore(jr,{keyPath:Yg}).createIndex(Xh,Zg,{unique:!1}),c.createObjectStore(zr,{keyPath:t_}).createIndex(Yh,e_,{unique:!1})})(t)))),n<16&&s>=16&&(o=o.next((()=>{e.objectStore(jr).clear()})).next((()=>{e.objectStore(zr).clear()}))),n<17&&s>=17&&(o=o.next((()=>{(function(c){c.createObjectStore(Ra,{keyPath:i_})})(t)}))),n<18&&s>=18&&mh()&&(o=o.next((()=>{e.objectStore(jr).clear()})).next((()=>{e.objectStore(zr).clear()}))),o}wi(t){let e=0;return t.store(Xe).ee(((n,s)=>{e+=yi(s)})).next((()=>{const n={byteSize:e};return t.store(es).put(zo,n)}))}yi(t){const e=t.store(ts),n=t.store(Gt);return e.J().next((s=>v.forEach(s,(i=>{const o=IDBKeyRange.bound([i.userId,Ve],[i.userId,i.lastAcknowledgedBatchId]);return n.J(nn,o).next((u=>v.forEach(u,(c=>{L(c.userId===i.userId,18650,"Cannot process batch from unexpected user",{batchId:c.batchId});const h=Ze(this.serializer,c);return sf(t,i.userId,h).next((()=>{}))}))))}))))}Si(t){const e=t.store($n),n=t.store(Xe);return t.store(on).get(di).next((s=>{const i=[];return n.ee(((o,u)=>{const c=new K(o),h=(function(p){return[0,Dt(p)]})(c);i.push(e.get(h).next((f=>f?v.resolve():(p=>e.put({targetId:0,path:Dt(p),sequenceNumber:s.highestListenSequenceNumber}))(c))))})).next((()=>v.waitFor(i)))}))}bi(t,e){t.createObjectStore(ns,{keyPath:Kg});const n=e.store(ns),s=new ja,i=o=>{if(s.add(o)){const u=o.lastSegment(),c=o.popLast();return n.put({collectionId:u,parent:Dt(c)})}};return e.store(Xe).ee({X:!0},((o,u)=>{const c=new K(o);return i(c.popLast())})).next((()=>e.store(jn).ee({X:!0},(([o,u,c],h)=>{const f=Yt(u);return i(f.popLast())}))))}Di(t){const e=t.store(zn);return e.ee(((n,s)=>{const i=Fr(s),o=tf(this.serializer,i);return e.put(o)}))}Ci(t,e){const n=e.store(Xe),s=[];return n.ee(((i,o)=>{const u=e.store(hi),c=(function(p){return p.document?new M(K.fromString(p.document.name).popFirst(5)):p.noDocument?M.fromSegments(p.noDocument.path):p.unknownDocument?M.fromSegments(p.unknownDocument.path):F(36783)})(o).path.toArray(),h={prefixPath:c.slice(0,c.length-2),collectionGroup:c[c.length-2],documentId:c[c.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};s.push(u.put(h))})).next((()=>v.waitFor(s)))}Fi(t,e){const n=e.store(Gt),s=hf(this.serializer),i=new $a(Fi.mi,this.serializer.yt);return n.J().next((o=>{const u=new Map;return o.forEach((c=>{let h=u.get(c.userId)??$();Ze(this.serializer,c).keys().forEach((f=>h=h.add(f))),u.set(c.userId,h)})),v.forEach(u,((c,h)=>{const f=new wt(h),p=Mi.wt(this.serializer,f),_=i.getIndexManager(f),R=Oi.wt(f,this.serializer,_,i.referenceDelegate);return new df(s,R,p,_).recalculateAndSaveOverlaysForDocumentKeys(new Ko(e,Ft.ce),c).next()}))}))}}function Fl(r){r.createObjectStore($n,{keyPath:$g}).createIndex(Aa,Gg,{unique:!0}),r.createObjectStore(zn,{keyPath:"targetId"}).createIndex(Jh,zg,{unique:!0}),r.createObjectStore(on)}const ve="IndexedDbPersistence",Vo=18e5,Co=5e3,Do="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",ff="main";class Ga{constructor(t,e,n,s,i,o,u,c,h,f,p=18){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.Mi=i,this.window=o,this.document=u,this.xi=h,this.Oi=f,this.Ni=p,this.ci=null,this.li=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Bi=null,this.inForeground=!1,this.Li=null,this.ki=null,this.qi=Number.NEGATIVE_INFINITY,this.Qi=_=>Promise.resolve(),!Ga.v())throw new V(S.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new cy(this,s),this.$i=e+ff,this.serializer=new Zd(c),this.Ui=new te(this.$i,this.Ni,new Ty(this.serializer)),this.hi=new X_,this.Pi=new iy(this.referenceDelegate,this.serializer),this.remoteDocumentCache=hf(this.serializer),this.Ii=new J_,this.window&&this.window.localStorage?this.Ki=this.window.localStorage:(this.Ki=null,f===!1&&ft(ve,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Wi().then((()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new V(S.FAILED_PRECONDITION,Do);return this.Gi(),this.zi(),this.ji(),this.runTransaction("getHighestListenSequenceNumber","readonly",(t=>this.Pi.getHighestSequenceNumber(t)))})).then((t=>{this.ci=new Ft(t,this.xi)})).then((()=>{this.li=!0})).catch((t=>(this.Ui&&this.Ui.close(),Promise.reject(t))))}Ji(t){return this.Qi=async e=>{if(this.started)return t(e)},t(this.isPrimary)}setDatabaseDeletedListener(t){this.Ui.$((async e=>{e.newVersion===null&&await t()}))}setNetworkEnabled(t){this.networkEnabled!==t&&(this.networkEnabled=t,this.Mi.enqueueAndForget((async()=>{this.started&&await this.Wi()})))}Wi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(t=>Ks(t).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next((()=>{if(this.isPrimary)return this.Hi(t).next((e=>{e||(this.isPrimary=!1,this.Mi.enqueueRetryable((()=>this.Qi(!1))))}))})).next((()=>this.Yi(t))).next((e=>this.isPrimary&&!e?this.Zi(t).next((()=>!1)):!!e&&this.Xi(t).next((()=>!0)))))).catch((t=>{if(Le(t))return C(ve,"Failed to extend owner lease: ",t),this.isPrimary;if(!this.allowTabSynchronization)throw t;return C(ve,"Releasing owner lease after error during lease refresh",t),!1})).then((t=>{this.isPrimary!==t&&this.Mi.enqueueRetryable((()=>this.Qi(t))),this.isPrimary=t}))}Hi(t){return Nr(t).get(An).next((e=>v.resolve(this.es(e))))}ts(t){return Ks(t).delete(this.clientId)}async ns(){if(this.isPrimary&&!this.rs(this.qi,Vo)){this.qi=Date.now();const t=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(e=>{const n=It(e,Gn);return n.J().next((s=>{const i=this.ss(s,Vo),o=s.filter((u=>i.indexOf(u)===-1));return v.forEach(o,(u=>n.delete(u.clientId))).next((()=>o))}))})).catch((()=>[]));if(this.Ki)for(const e of t)this.Ki.removeItem(this._s(e.clientId))}}ji(){this.ki=this.Mi.enqueueAfterDelay("client_metadata_refresh",4e3,(()=>this.Wi().then((()=>this.ns())).then((()=>this.ji()))))}es(t){return!!t&&t.ownerId===this.clientId}Yi(t){return this.Oi?v.resolve(!0):Nr(t).get(An).next((e=>{if(e!==null&&this.rs(e.leaseTimestampMs,Co)&&!this.us(e.ownerId)){if(this.es(e)&&this.networkEnabled)return!0;if(!this.es(e)){if(!e.allowTabSynchronization)throw new V(S.FAILED_PRECONDITION,Do);return!1}}return!(!this.networkEnabled||!this.inForeground)||Ks(t).J().next((n=>this.ss(n,Co).find((s=>{if(this.clientId!==s.clientId){const i=!this.networkEnabled&&s.networkEnabled,o=!this.inForeground&&s.inForeground,u=this.networkEnabled===s.networkEnabled;if(i||o&&u)return!0}return!1}))===void 0))})).next((e=>(this.isPrimary!==e&&C(ve,`Client ${e?"is":"is not"} eligible for a primary lease.`),e)))}async shutdown(){this.li=!1,this.cs(),this.ki&&(this.ki.cancel(),this.ki=null),this.ls(),this.hs(),await this.Ui.runTransaction("shutdown","readwrite",[ms,Gn],(t=>{const e=new Ko(t,Ft.ce);return this.Zi(e).next((()=>this.ts(e)))})),this.Ui.close(),this.Ps()}ss(t,e){return t.filter((n=>this.rs(n.updateTimeMs,e)&&!this.us(n.clientId)))}Ts(){return this.runTransaction("getActiveClients","readonly",(t=>Ks(t).J().next((e=>this.ss(e,Vo).map((n=>n.clientId))))))}get started(){return this.li}getGlobalsCache(){return this.hi}getMutationQueue(t,e){return Oi.wt(t,this.serializer,e,this.referenceDelegate)}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(t){return new sy(t,this.serializer.yt.databaseId)}getDocumentOverlayCache(t){return Mi.wt(this.serializer,t)}getBundleCache(){return this.Ii}runTransaction(t,e,n){C(ve,"Starting transaction:",t);const s=e==="readonly"?"readonly":"readwrite",i=(function(c){return c===18?u_:c===17?rd:c===16?a_:c===15?Sa:c===14?nd:c===13?ed:c===12?o_:c===11?td:void F(60245)})(this.Ni);let o;return this.Ui.runTransaction(t,s,i,(u=>(o=new Ko(u,this.ci?this.ci.next():Ft.ce),e==="readwrite-primary"?this.Hi(o).next((c=>!!c||this.Yi(o))).next((c=>{if(!c)throw ft(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.Mi.enqueueRetryable((()=>this.Qi(!1))),new V(S.FAILED_PRECONDITION,$h);return n(o)})).next((c=>this.Xi(o).next((()=>c)))):this.Is(o).next((()=>n(o)))))).then((u=>(o.raiseOnCommittedEvent(),u)))}Is(t){return Nr(t).get(An).next((e=>{if(e!==null&&this.rs(e.leaseTimestampMs,Co)&&!this.us(e.ownerId)&&!this.es(e)&&!(this.Oi||this.allowTabSynchronization&&e.allowTabSynchronization))throw new V(S.FAILED_PRECONDITION,Do)}))}Xi(t){const e={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Nr(t).put(An,e)}static v(){return te.v()}Zi(t){const e=Nr(t);return e.get(An).next((n=>this.es(n)?(C(ve,"Releasing primary lease."),e.delete(An)):v.resolve()))}rs(t,e){const n=Date.now();return!(t<n-e)&&(!(t>n)||(ft(`Detected an update time that is in the future: ${t} > ${n}`),!1))}Gi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Li=()=>{this.Mi.enqueueAndForget((()=>(this.inForeground=this.document.visibilityState==="visible",this.Wi())))},this.document.addEventListener("visibilitychange",this.Li),this.inForeground=this.document.visibilityState==="visible")}ls(){this.Li&&(this.document.removeEventListener("visibilitychange",this.Li),this.Li=null)}zi(){typeof this.window?.addEventListener=="function"&&(this.Bi=()=>{this.cs();const t=/(?:Version|Mobile)\/1[456]/;fh()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.Mi.enterRestrictedMode(!0),this.Mi.enqueueAndForget((()=>this.shutdown()))},this.window.addEventListener("pagehide",this.Bi))}hs(){this.Bi&&(this.window.removeEventListener("pagehide",this.Bi),this.Bi=null)}us(t){try{const e=this.Ki?.getItem(this._s(t))!==null;return C(ve,`Client '${t}' ${e?"is":"is not"} zombied in LocalStorage`),e}catch(e){return ft(ve,"Failed to get zombied client id.",e),!1}}cs(){if(this.Ki)try{this.Ki.setItem(this._s(this.clientId),String(Date.now()))}catch(t){ft("Failed to set zombie client id.",t)}}Ps(){if(this.Ki)try{this.Ki.removeItem(this._s(this.clientId))}catch{}}_s(t){return`firestore_zombie_${this.persistenceKey}_${t}`}}function Nr(r){return It(r,ms)}function Ks(r){return It(r,Gn)}function Ka(r,t){let e=r.projectId;return r.isDefaultDatabase||(e+="."+r.database),"firestore/"+t+"/"+e+"/"}class Qa{constructor(t,e,n,s){this.targetId=t,this.fromCache=e,this.Es=n,this.ds=s}static As(t,e){let n=$(),s=$();for(const i of e.docChanges)switch(i.type){case 0:n=n.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new Qa(t,e.fromCache,n,s)}}class wy{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}}class mf{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return fh()?8:Kh(ai())>0?6:4})()}initialize(t,e){this.ps=t,this.indexManager=e,this.Rs=!0}getDocumentsMatchingQuery(t,e,n,s){const i={result:null};return this.ys(t,e).next((o=>{i.result=o})).next((()=>{if(!i.result)return this.ws(t,e,s,n).next((o=>{i.result=o}))})).next((()=>{if(i.result)return;const o=new wy;return this.Ss(t,e,o).next((u=>{if(i.result=u,this.Vs)return this.bs(t,e,o,u.size)}))})).next((()=>i.result))}bs(t,e,n,s){return n.documentReadCount<this.fs?(Cn()<=W.DEBUG&&C("QueryEngine","SDK will not create cache indexes for query:",Dn(e),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),v.resolve()):(Cn()<=W.DEBUG&&C("QueryEngine","Query:",Dn(e),"scans",n.documentReadCount,"local documents and returns",s,"documents as results."),n.documentReadCount>this.gs*s?(Cn()<=W.DEBUG&&C("QueryEngine","The SDK decides to create cache indexes for query:",Dn(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,kt(e))):v.resolve())}ys(t,e){if(al(e))return v.resolve(null);let n=kt(e);return this.indexManager.getIndexType(t,n).next((s=>s===0?null:(e.limit!==null&&s===1&&(e=pi(e,null,"F"),n=kt(e)),this.indexManager.getDocumentsMatchingTarget(t,n).next((i=>{const o=$(...i);return this.ps.getDocuments(t,o).next((u=>this.indexManager.getMinOffset(t,n).next((c=>{const h=this.Ds(e,u);return this.Cs(e,h,o,c.readTime)?this.ys(t,pi(e,null,"F")):this.vs(t,h,e,c)}))))})))))}ws(t,e,n,s){return al(e)||s.isEqual(B.min())?v.resolve(null):this.ps.getDocuments(t,n).next((i=>{const o=this.Ds(e,i);return this.Cs(e,o,n,s)?v.resolve(null):(Cn()<=W.DEBUG&&C("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Dn(e)),this.vs(t,o,e,jh(s,qn)).next((u=>u)))}))}Ds(t,e){let n=new et(Ad(t));return e.forEach(((s,i)=>{_s(t,i)&&(n=n.add(i))})),n}Cs(t,e,n,s){if(t.limit===null)return!1;if(n.size!==e.size)return!0;const i=t.limitType==="F"?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Ss(t,e,n){return Cn()<=W.DEBUG&&C("QueryEngine","Using full collection scan to execute query:",Dn(e)),this.ps.getDocumentsMatchingQuery(t,e,$t.min(),n)}vs(t,e,n,s){return this.ps.getDocumentsMatchingQuery(t,n,s).next((i=>(e.forEach((o=>{i=i.insert(o.key,o)})),i)))}}const Wa="LocalStore",vy=3e8;class Ay{constructor(t,e,n,s){this.persistence=t,this.Fs=e,this.serializer=s,this.Ms=new st(z),this.xs=new de((i=>cn(i)),ps),this.Os=new Map,this.Ns=t.getRemoteDocumentCache(),this.Pi=t.getTargetCache(),this.Ii=t.getBundleCache(),this.Bs(n)}Bs(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new df(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(e=>t.collect(e,this.Ms)))}}function pf(r,t,e,n){return new Ay(r,t,e,n)}async function gf(r,t){const e=O(r);return await e.persistence.runTransaction("Handle user change","readonly",(n=>{let s;return e.mutationQueue.getAllMutationBatches(n).next((i=>(s=i,e.Bs(t),e.mutationQueue.getAllMutationBatches(n)))).next((i=>{const o=[],u=[];let c=$();for(const h of s){o.push(h.batchId);for(const f of h.mutations)c=c.add(f.key)}for(const h of i){u.push(h.batchId);for(const f of h.mutations)c=c.add(f.key)}return e.localDocuments.getDocuments(n,c).next((h=>({Ls:h,removedBatchIds:o,addedBatchIds:u})))}))}))}function by(r,t){const e=O(r);return e.persistence.runTransaction("Acknowledge batch","readwrite-primary",(n=>{const s=t.batch.keys(),i=e.Ns.newChangeBuffer({trackRemovals:!0});return(function(u,c,h,f){const p=h.batch,_=p.keys();let R=v.resolve();return _.forEach((x=>{R=R.next((()=>f.getEntry(c,x))).next((N=>{const D=h.docVersions.get(x);L(D!==null,48541),N.version.compareTo(D)<0&&(p.applyToRemoteDocument(N,h),N.isValidDocument()&&(N.setReadTime(h.commitVersion),f.addEntry(N)))}))})),R.next((()=>u.mutationQueue.removeMutationBatch(c,p)))})(e,n,t,i).next((()=>i.apply(n))).next((()=>e.mutationQueue.performConsistencyCheck(n))).next((()=>e.documentOverlayCache.removeOverlaysForBatchId(n,s,t.batch.batchId))).next((()=>e.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,(function(u){let c=$();for(let h=0;h<u.mutationResults.length;++h)u.mutationResults[h].transformResults.length>0&&(c=c.add(u.batch.mutations[h].key));return c})(t)))).next((()=>e.localDocuments.getDocuments(n,s)))}))}function _f(r){const t=O(r);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(e=>t.Pi.getLastRemoteSnapshotVersion(e)))}function Ry(r,t){const e=O(r),n=t.snapshotVersion;let s=e.Ms;return e.persistence.runTransaction("Apply remote event","readwrite-primary",(i=>{const o=e.Ns.newChangeBuffer({trackRemovals:!0});s=e.Ms;const u=[];t.targetChanges.forEach(((f,p)=>{const _=s.get(p);if(!_)return;u.push(e.Pi.removeMatchingKeys(i,f.removedDocuments,p).next((()=>e.Pi.addMatchingKeys(i,f.addedDocuments,p))));let R=_.withSequenceNumber(i.currentSequenceNumber);t.targetMismatches.get(p)!==null?R=R.withResumeToken(dt.EMPTY_BYTE_STRING,B.min()).withLastLimboFreeSnapshotVersion(B.min()):f.resumeToken.approximateByteSize()>0&&(R=R.withResumeToken(f.resumeToken,n)),s=s.insert(p,R),(function(N,D,q){return N.resumeToken.approximateByteSize()===0||D.snapshotVersion.toMicroseconds()-N.snapshotVersion.toMicroseconds()>=vy?!0:q.addedDocuments.size+q.modifiedDocuments.size+q.removedDocuments.size>0})(_,R,f)&&u.push(e.Pi.updateTargetData(i,R))}));let c=Bt(),h=$();if(t.documentUpdates.forEach((f=>{t.resolvedLimboDocuments.has(f)&&u.push(e.persistence.referenceDelegate.updateLimboDocument(i,f))})),u.push(yf(i,o,t.documentUpdates).next((f=>{c=f.ks,h=f.qs}))),!n.isEqual(B.min())){const f=e.Pi.getLastRemoteSnapshotVersion(i).next((p=>e.Pi.setTargetsMetadata(i,i.currentSequenceNumber,n)));u.push(f)}return v.waitFor(u).next((()=>o.apply(i))).next((()=>e.localDocuments.getLocalViewOfDocuments(i,c,h))).next((()=>c))})).then((i=>(e.Ms=s,i)))}function yf(r,t,e){let n=$(),s=$();return e.forEach((i=>n=n.add(i))),t.getEntries(r,n).next((i=>{let o=Bt();return e.forEach(((u,c)=>{const h=i.get(u);c.isFoundDocument()!==h.isFoundDocument()&&(s=s.add(u)),c.isNoDocument()&&c.version.isEqual(B.min())?(t.removeEntry(u,c.readTime),o=o.insert(u,c)):!h.isValidDocument()||c.version.compareTo(h.version)>0||c.version.compareTo(h.version)===0&&h.hasPendingWrites?(t.addEntry(c),o=o.insert(u,c)):C(Wa,"Ignoring outdated watch update for ",u,". Current version:",h.version," Watch version:",c.version)})),{ks:o,qs:s}}))}function Sy(r,t){const e=O(r);return e.persistence.runTransaction("Get next mutation batch","readonly",(n=>(t===void 0&&(t=Ve),e.mutationQueue.getNextMutationBatchAfterBatchId(n,t))))}function Yn(r,t){const e=O(r);return e.persistence.runTransaction("Allocate target","readwrite",(n=>{let s;return e.Pi.getTargetData(n,t).next((i=>i?(s=i,v.resolve(s)):e.Pi.allocateTargetId(n).next((o=>(s=new oe(t,o,"TargetPurposeListen",n.currentSequenceNumber),e.Pi.addTargetData(n,s).next((()=>s)))))))})).then((n=>{const s=e.Ms.get(n.targetId);return(s===null||n.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(e.Ms=e.Ms.insert(n.targetId,n),e.xs.set(t,n.targetId)),n}))}async function Zn(r,t,e){const n=O(r),s=n.Ms.get(t),i=e?"readwrite":"readwrite-primary";try{e||await n.persistence.runTransaction("Release target",i,(o=>n.persistence.referenceDelegate.removeTarget(o,s)))}catch(o){if(!Le(o))throw o;C(Wa,`Failed to update sequence numbers for target ${t}: ${o}`)}n.Ms=n.Ms.remove(t),n.xs.delete(s.target)}function Ei(r,t,e){const n=O(r);let s=B.min(),i=$();return n.persistence.runTransaction("Execute query","readwrite",(o=>(function(c,h,f){const p=O(c),_=p.xs.get(f);return _!==void 0?v.resolve(p.Ms.get(_)):p.Pi.getTargetData(h,f)})(n,o,kt(t)).next((u=>{if(u)return s=u.lastLimboFreeSnapshotVersion,n.Pi.getMatchingKeysForTargetId(o,u.targetId).next((c=>{i=c}))})).next((()=>n.Fs.getDocumentsMatchingQuery(o,t,e?s:B.min(),e?i:$()))).next((u=>(Tf(n,vd(t),u),{documents:u,Qs:i})))))}function If(r,t){const e=O(r),n=O(e.Pi),s=e.Ms.get(t);return s?Promise.resolve(s.target):e.persistence.runTransaction("Get target data","readonly",(i=>n.At(i,t).next((o=>o?o.target:null))))}function Ef(r,t){const e=O(r),n=e.Os.get(t)||B.min();return e.persistence.runTransaction("Get new document changes","readonly",(s=>e.Ns.getAllFromCollectionGroup(s,t,jh(n,qn),Number.MAX_SAFE_INTEGER))).then((s=>(Tf(e,t,s),s)))}function Tf(r,t,e){let n=r.Os.get(t)||B.min();e.forEach(((s,i)=>{i.readTime.compareTo(n)>0&&(n=i.readTime)})),r.Os.set(t,n)}async function Py(r,t,e,n){const s=O(r);let i=$(),o=Bt();for(const h of e){const f=t.$s(h.metadata.name);h.document&&(i=i.add(f));const p=t.Us(h);p.setReadTime(t.Ks(h.metadata.readTime)),o=o.insert(f,p)}const u=s.Ns.newChangeBuffer({trackRemovals:!0}),c=await Yn(s,(function(f){return kt(ir(K.fromString(`__bundle__/docs/${f}`)))})(n));return s.persistence.runTransaction("Apply bundle documents","readwrite",(h=>yf(h,u,o).next((f=>(u.apply(h),f))).next((f=>s.Pi.removeMatchingKeysForTargetId(h,c.targetId).next((()=>s.Pi.addMatchingKeys(h,i,c.targetId))).next((()=>s.localDocuments.getLocalViewOfDocuments(h,f.ks,f.qs))).next((()=>f.ks))))))}async function Vy(r,t,e=$()){const n=await Yn(r,kt(Ua(t.bundledQuery))),s=O(r);return s.persistence.runTransaction("Save named query","readwrite",(i=>{const o=mt(t.readTime);if(n.snapshotVersion.compareTo(o)>=0)return s.Ii.saveNamedQuery(i,t);const u=n.withResumeToken(dt.EMPTY_BYTE_STRING,o);return s.Ms=s.Ms.insert(u.targetId,u),s.Pi.updateTargetData(i,u).next((()=>s.Pi.removeMatchingKeysForTargetId(i,n.targetId))).next((()=>s.Pi.addMatchingKeys(i,e,n.targetId))).next((()=>s.Ii.saveNamedQuery(i,t)))}))}const wf="firestore_clients";function Ll(r,t){return`${wf}_${r}_${t}`}const vf="firestore_mutations";function Bl(r,t,e){let n=`${vf}_${r}_${e}`;return t.isAuthenticated()&&(n+=`_${t.uid}`),n}const Af="firestore_targets";function xo(r,t){return`${Af}_${r}_${t}`}const Xt="SharedClientState";class Ti{constructor(t,e,n,s){this.user=t,this.batchId=e,this.state=n,this.error=s}static Ws(t,e,n){const s=JSON.parse(n);let i,o=typeof s=="object"&&["pending","acknowledged","rejected"].indexOf(s.state)!==-1&&(s.error===void 0||typeof s.error=="object");return o&&s.error&&(o=typeof s.error.message=="string"&&typeof s.error.code=="string",o&&(i=new V(s.error.code,s.error.message))),o?new Ti(t,e,s.state,i):(ft(Xt,`Failed to parse mutation state for ID '${e}': ${n}`),null)}Gs(){const t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}}class Qr{constructor(t,e,n){this.targetId=t,this.state=e,this.error=n}static Ws(t,e){const n=JSON.parse(e);let s,i=typeof n=="object"&&["not-current","current","rejected"].indexOf(n.state)!==-1&&(n.error===void 0||typeof n.error=="object");return i&&n.error&&(i=typeof n.error.message=="string"&&typeof n.error.code=="string",i&&(s=new V(n.error.code,n.error.message))),i?new Qr(t,n.state,s):(ft(Xt,`Failed to parse target state for ID '${t}': ${e}`),null)}Gs(){const t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}}class wi{constructor(t,e){this.clientId=t,this.activeTargetIds=e}static Ws(t,e){const n=JSON.parse(e);let s=typeof n=="object"&&n.activeTargetIds instanceof Array,i=xa();for(let o=0;s&&o<n.activeTargetIds.length;++o)s=Qh(n.activeTargetIds[o]),i=i.add(n.activeTargetIds[o]);return s?new wi(t,i):(ft(Xt,`Failed to parse client data for instance '${t}': ${e}`),null)}}class Ha{constructor(t,e){this.clientId=t,this.onlineState=e}static Ws(t){const e=JSON.parse(t);return typeof e=="object"&&["Unknown","Online","Offline"].indexOf(e.onlineState)!==-1&&typeof e.clientId=="string"?new Ha(e.clientId,e.onlineState):(ft(Xt,`Failed to parse online state: ${t}`),null)}}class aa{constructor(){this.activeTargetIds=xa()}zs(t){this.activeTargetIds=this.activeTargetIds.add(t)}js(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Gs(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class No{constructor(t,e,n,s,i){this.window=t,this.Mi=e,this.persistenceKey=n,this.Js=s,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Hs=this.Ys.bind(this),this.Zs=new st(z),this.started=!1,this.Xs=[];const o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.eo=Ll(this.persistenceKey,this.Js),this.no=(function(c){return`firestore_sequence_number_${c}`})(this.persistenceKey),this.Zs=this.Zs.insert(this.Js,new aa),this.ro=new RegExp(`^${wf}_${o}_([^_]*)$`),this.io=new RegExp(`^${vf}_${o}_(\\d+)(?:_(.*))?$`),this.so=new RegExp(`^${Af}_${o}_(\\d+)$`),this.oo=(function(c){return`firestore_online_state_${c}`})(this.persistenceKey),this._o=(function(c){return`firestore_bundle_loaded_v2_${c}`})(this.persistenceKey),this.window.addEventListener("storage",this.Hs)}static v(t){return!(!t||!t.localStorage)}async start(){const t=await this.syncEngine.Ts();for(const n of t){if(n===this.Js)continue;const s=this.getItem(Ll(this.persistenceKey,n));if(s){const i=wi.Ws(n,s);i&&(this.Zs=this.Zs.insert(i.clientId,i))}}this.ao();const e=this.storage.getItem(this.oo);if(e){const n=this.uo(e);n&&this.co(n)}for(const n of this.Xs)this.Ys(n);this.Xs=[],this.window.addEventListener("pagehide",(()=>this.shutdown())),this.started=!0}writeSequenceNumber(t){this.setItem(this.no,JSON.stringify(t))}getAllActiveQueryTargets(){return this.lo(this.Zs)}isActiveQueryTarget(t){let e=!1;return this.Zs.forEach(((n,s)=>{s.activeTargetIds.has(t)&&(e=!0)})),e}addPendingMutation(t){this.ho(t,"pending")}updateMutationState(t,e,n){this.ho(t,e,n),this.Po(t)}addLocalQueryTarget(t,e=!0){let n="not-current";if(this.isActiveQueryTarget(t)){const s=this.storage.getItem(xo(this.persistenceKey,t));if(s){const i=Qr.Ws(t,s);i&&(n=i.state)}}return e&&this.To.zs(t),this.ao(),n}removeLocalQueryTarget(t){this.To.js(t),this.ao()}isLocalQueryTarget(t){return this.To.activeTargetIds.has(t)}clearQueryState(t){this.removeItem(xo(this.persistenceKey,t))}updateQueryState(t,e,n){this.Io(t,e,n)}handleUserChange(t,e,n){e.forEach((s=>{this.Po(s)})),this.currentUser=t,n.forEach((s=>{this.addPendingMutation(s)}))}setOnlineState(t){this.Eo(t)}notifyBundleLoaded(t){this.Ao(t)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Hs),this.removeItem(this.eo),this.started=!1)}getItem(t){const e=this.storage.getItem(t);return C(Xt,"READ",t,e),e}setItem(t,e){C(Xt,"SET",t,e),this.storage.setItem(t,e)}removeItem(t){C(Xt,"REMOVE",t),this.storage.removeItem(t)}Ys(t){const e=t;if(e.storageArea===this.storage){if(C(Xt,"EVENT",e.key,e.newValue),e.key===this.eo)return void ft("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Mi.enqueueRetryable((async()=>{if(this.started){if(e.key!==null){if(this.ro.test(e.key)){if(e.newValue==null){const n=this.Ro(e.key);return this.Vo(n,null)}{const n=this.mo(e.key,e.newValue);if(n)return this.Vo(n.clientId,n)}}else if(this.io.test(e.key)){if(e.newValue!==null){const n=this.fo(e.key,e.newValue);if(n)return this.po(n)}}else if(this.so.test(e.key)){if(e.newValue!==null){const n=this.yo(e.key,e.newValue);if(n)return this.wo(n)}}else if(e.key===this.oo){if(e.newValue!==null){const n=this.uo(e.newValue);if(n)return this.co(n)}}else if(e.key===this.no){const n=(function(i){let o=Ft.ce;if(i!=null)try{const u=JSON.parse(i);L(typeof u=="number",30636,{So:i}),o=u}catch(u){ft(Xt,"Failed to read sequence number from WebStorage",u)}return o})(e.newValue);n!==Ft.ce&&this.sequenceNumberHandler(n)}else if(e.key===this._o){const n=this.bo(e.newValue);await Promise.all(n.map((s=>this.syncEngine.Do(s))))}}}else this.Xs.push(e)}))}}get To(){return this.Zs.get(this.Js)}ao(){this.setItem(this.eo,this.To.Gs())}ho(t,e,n){const s=new Ti(this.currentUser,t,e,n),i=Bl(this.persistenceKey,this.currentUser,t);this.setItem(i,s.Gs())}Po(t){const e=Bl(this.persistenceKey,this.currentUser,t);this.removeItem(e)}Eo(t){const e={clientId:this.Js,onlineState:t};this.storage.setItem(this.oo,JSON.stringify(e))}Io(t,e,n){const s=xo(this.persistenceKey,t),i=new Qr(t,e,n);this.setItem(s,i.Gs())}Ao(t){const e=JSON.stringify(Array.from(t));this.setItem(this._o,e)}Ro(t){const e=this.ro.exec(t);return e?e[1]:null}mo(t,e){const n=this.Ro(t);return wi.Ws(n,e)}fo(t,e){const n=this.io.exec(t),s=Number(n[1]),i=n[2]!==void 0?n[2]:null;return Ti.Ws(new wt(i),s,e)}yo(t,e){const n=this.so.exec(t),s=Number(n[1]);return Qr.Ws(s,e)}uo(t){return Ha.Ws(t)}bo(t){return JSON.parse(t)}async po(t){if(t.user.uid===this.currentUser.uid)return this.syncEngine.Co(t.batchId,t.state,t.error);C(Xt,`Ignoring mutation for non-active user ${t.user.uid}`)}wo(t){return this.syncEngine.vo(t.targetId,t.state,t.error)}Vo(t,e){const n=e?this.Zs.insert(t,e):this.Zs.remove(t),s=this.lo(this.Zs),i=this.lo(n),o=[],u=[];return i.forEach((c=>{s.has(c)||o.push(c)})),s.forEach((c=>{i.has(c)||u.push(c)})),this.syncEngine.Fo(o,u).then((()=>{this.Zs=n}))}co(t){this.Zs.get(t.clientId)&&this.onlineStateHandler(t.onlineState)}lo(t){let e=xa();return t.forEach(((n,s)=>{e=e.unionWith(s.activeTargetIds)})),e}}class bf{constructor(){this.Mo=new aa,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t,e=!0){return e&&this.Mo.zs(t),this.xo[t]||"not-current"}updateQueryState(t,e,n){this.xo[t]=e}removeLocalQueryTarget(t){this.Mo.js(t)}isLocalQueryTarget(t){return this.Mo.activeTargetIds.has(t)}clearQueryState(t){delete this.xo[t]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(t){return this.Mo.activeTargetIds.has(t)}start(){return this.Mo=new aa,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}class Cy{Oo(t){}shutdown(){}}const Ul="ConnectivityMonitor";class ql{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(t){this.qo.push(t)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){C(Ul,"Network connectivity changed: AVAILABLE");for(const t of this.qo)t(0)}ko(){C(Ul,"Network connectivity changed: UNAVAILABLE");for(const t of this.qo)t(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let Qs=null;function ua(){return Qs===null?Qs=(function(){return 268435456+Math.round(2147483648*Math.random())})():Qs++,"0x"+Qs.toString(16)}const ko="RestConnection",Dy={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class xy{get $o(){return!1}constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Uo=e+"://"+t.host,this.Ko=`projects/${n}/databases/${s}`,this.Wo=this.databaseId.database===Qo?`project_id=${n}`:`project_id=${n}&database_id=${s}`}Go(t,e,n,s,i){const o=ua(),u=this.zo(t,e.toUriEncodedString());C(ko,`Sending RPC '${t}' ${o}:`,u,n);const c={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(c,s,i);const{host:h}=new URL(u),f=pa(h);return this.Jo(t,u,c,n,f).then((p=>(C(ko,`Received RPC '${t}' ${o}: `,p),p)),(p=>{throw ue(ko,`RPC '${t}' ${o} failed with error: `,p,"url: ",u,"request:",n),p}))}Ho(t,e,n,s,i,o){return this.Go(t,e,n,s,i)}jo(t,e,n){t["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+sr})(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach(((s,i)=>t[i]=s)),n&&n.headers.forEach(((s,i)=>t[i]=s))}zo(t,e){const n=Dy[t];return`${this.Uo}/v1/${e}:${n}`}terminate(){}}class Ny{constructor(t){this.Yo=t.Yo,this.Zo=t.Zo}Xo(t){this.e_=t}t_(t){this.n_=t}r_(t){this.i_=t}onMessage(t){this.s_=t}close(){this.Zo()}send(t){this.Yo(t)}o_(){this.e_()}__(){this.n_()}a_(t){this.i_(t)}u_(t){this.s_(t)}}const Vt="WebChannelConnection";class ky extends xy{constructor(t){super(t),this.c_=[],this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Jo(t,e,n,s,i){const o=ua();return new Promise(((u,c)=>{const h=new xh;h.setWithCredentials(!0),h.listenOnce(Nh.COMPLETE,(()=>{try{switch(h.getLastErrorCode()){case Ws.NO_ERROR:const p=h.getResponseJson();C(Vt,`XHR for RPC '${t}' ${o} received:`,JSON.stringify(p)),u(p);break;case Ws.TIMEOUT:C(Vt,`RPC '${t}' ${o} timed out`),c(new V(S.DEADLINE_EXCEEDED,"Request time out"));break;case Ws.HTTP_ERROR:const _=h.getStatus();if(C(Vt,`RPC '${t}' ${o} failed with status:`,_,"response text:",h.getResponseText()),_>0){let R=h.getResponseJson();Array.isArray(R)&&(R=R[0]);const x=R?.error;if(x&&x.status&&x.message){const N=(function(q){const j=q.toLowerCase().replace(/_/g,"-");return Object.values(S).indexOf(j)>=0?j:S.UNKNOWN})(x.status);c(new V(N,x.message))}else c(new V(S.UNKNOWN,"Server responded with status "+h.getStatus()))}else c(new V(S.UNAVAILABLE,"Connection failed."));break;default:F(9055,{l_:t,streamId:o,h_:h.getLastErrorCode(),P_:h.getLastError()})}}finally{C(Vt,`RPC '${t}' ${o} completed.`)}}));const f=JSON.stringify(s);C(Vt,`RPC '${t}' ${o} sending request:`,s),h.send(e,"POST",f,n,15)}))}T_(t,e,n){const s=ua(),i=[this.Uo,"/","google.firestore.v1.Firestore","/",t,"/channel"],o=Oh(),u=Mh(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},h=this.longPollingOptions.timeoutSeconds;h!==void 0&&(c.longPollingTimeout=Math.round(1e3*h)),this.useFetchStreams&&(c.useFetchStreams=!0),this.jo(c.initMessageHeaders,e,n),c.encodeInitMessageHeaders=!0;const f=i.join("");C(Vt,`Creating RPC '${t}' stream ${s}: ${f}`,c);const p=o.createWebChannel(f,c);this.I_(p);let _=!1,R=!1;const x=new Ny({Yo:D=>{R?C(Vt,`Not sending because RPC '${t}' stream ${s} is closed:`,D):(_||(C(Vt,`Opening RPC '${t}' stream ${s} transport.`),p.open(),_=!0),C(Vt,`RPC '${t}' stream ${s} sending:`,D),p.send(D))},Zo:()=>p.close()}),N=(D,q,j)=>{D.listen(q,(U=>{try{j(U)}catch(nt){setTimeout((()=>{throw nt}),0)}}))};return N(p,kr.EventType.OPEN,(()=>{R||(C(Vt,`RPC '${t}' stream ${s} transport opened.`),x.o_())})),N(p,kr.EventType.CLOSE,(()=>{R||(R=!0,C(Vt,`RPC '${t}' stream ${s} transport closed`),x.a_(),this.E_(p))})),N(p,kr.EventType.ERROR,(D=>{R||(R=!0,ue(Vt,`RPC '${t}' stream ${s} transport errored. Name:`,D.name,"Message:",D.message),x.a_(new V(S.UNAVAILABLE,"The operation could not be completed")))})),N(p,kr.EventType.MESSAGE,(D=>{if(!R){const q=D.data[0];L(!!q,16349);const j=q,U=j?.error||j[0]?.error;if(U){C(Vt,`RPC '${t}' stream ${s} received error:`,U);const nt=U.status;let X=(function(g){const I=gt[g];if(I!==void 0)return Fd(I)})(nt),H=U.message;X===void 0&&(X=S.INTERNAL,H="Unknown error status: "+nt+" with message "+U.message),R=!0,x.a_(new V(X,H)),p.close()}else C(Vt,`RPC '${t}' stream ${s} received:`,q),x.u_(q)}})),N(u,kh.STAT_EVENT,(D=>{D.stat===Uo.PROXY?C(Vt,`RPC '${t}' stream ${s} detected buffering proxy`):D.stat===Uo.NOPROXY&&C(Vt,`RPC '${t}' stream ${s} detected no buffering proxy`)})),setTimeout((()=>{x.__()}),0),x}terminate(){this.c_.forEach((t=>t.close())),this.c_=[]}I_(t){this.c_.push(t)}E_(t){this.c_=this.c_.filter((e=>e===t))}}function Rf(){return typeof window<"u"?window:null}function si(){return typeof document<"u"?document:null}function Ts(r){return new B_(r,!0)}class Ja{constructor(t,e,n=1e3,s=1.5,i=6e4){this.Mi=t,this.timerId=e,this.d_=n,this.A_=s,this.R_=i,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(t){this.cancel();const e=Math.floor(this.V_+this.y_()),n=Math.max(0,Date.now()-this.f_),s=Math.max(0,e-n);s>0&&C("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.V_} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,s,(()=>(this.f_=Date.now(),t()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const jl="PersistentStream";class Sf{constructor(t,e,n,s,i,o,u,c){this.Mi=t,this.S_=n,this.b_=s,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=u,this.listener=c,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new Ja(t,e)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(t){this.Q_(),this.stream.send(t)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(t,e){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,t!==4?this.M_.reset():e&&e.code===S.RESOURCE_EXHAUSTED?(ft(e.toString()),ft("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):e&&e.code===S.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=t,await this.listener.r_(e)}K_(){}auth(){this.state=1;const t=this.W_(this.D_),e=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([n,s])=>{this.D_===e&&this.G_(n,s)}),(n=>{t((()=>{const s=new V(S.UNKNOWN,"Fetching auth token failed: "+n.message);return this.z_(s)}))}))}G_(t,e){const n=this.W_(this.D_);this.stream=this.j_(t,e),this.stream.Xo((()=>{n((()=>this.listener.Xo()))})),this.stream.t_((()=>{n((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((s=>{n((()=>this.z_(s)))})),this.stream.onMessage((s=>{n((()=>++this.F_==1?this.J_(s):this.onNext(s)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(t){return C(jl,`close with error: ${t}`),this.stream=null,this.close(4,t)}W_(t){return e=>{this.Mi.enqueueAndForget((()=>this.D_===t?e():(C(jl,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class My extends Sf{constructor(t,e,n,s,i,o){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,s,o),this.serializer=i}j_(t,e){return this.connection.T_("Listen",t,e)}J_(t){return this.onNext(t)}onNext(t){this.M_.reset();const e=j_(this.serializer,t),n=(function(i){if(!("targetChange"in i))return B.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?B.min():o.readTime?mt(o.readTime):B.min()})(t);return this.listener.H_(e,n)}Y_(t){const e={};e.database=na(this.serializer),e.addTarget=(function(i,o){let u;const c=o.target;if(u=fi(c)?{documents:Qd(i,c)}:{query:Wd(i,c).ft},u.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){u.resumeToken=qd(i,o.resumeToken);const h=ta(i,o.expectedCount);h!==null&&(u.expectedCount=h)}else if(o.snapshotVersion.compareTo(B.min())>0){u.readTime=Xn(i,o.snapshotVersion.toTimestamp());const h=ta(i,o.expectedCount);h!==null&&(u.expectedCount=h)}return u})(this.serializer,t);const n=$_(this.serializer,t);n&&(e.labels=n),this.q_(e)}Z_(t){const e={};e.database=na(this.serializer),e.removeTarget=t,this.q_(e)}}class Oy extends Sf{constructor(t,e,n,s,i,o){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,n,s,o),this.serializer=i}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(t,e){return this.connection.T_("Write",t,e)}J_(t){return L(!!t.streamToken,31322),this.lastStreamToken=t.streamToken,L(!t.writeResults||t.writeResults.length===0,55816),this.listener.ta()}onNext(t){L(!!t.streamToken,12678),this.lastStreamToken=t.streamToken,this.M_.reset();const e=z_(t.writeResults,t.commitTime),n=mt(t.commitTime);return this.listener.na(n,e)}ra(){const t={};t.database=na(this.serializer),this.q_(t)}ea(t){const e={streamToken:this.lastStreamToken,writes:t.map((n=>us(this.serializer,n)))};this.q_(e)}}class Fy{}class Ly extends Fy{constructor(t,e,n,s){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=n,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new V(S.FAILED_PRECONDITION,"The client has already been terminated.")}Go(t,e,n,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,o])=>this.connection.Go(t,ea(e,n),s,i,o))).catch((i=>{throw i.name==="FirebaseError"?(i.code===S.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new V(S.UNKNOWN,i.toString())}))}Ho(t,e,n,s,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([o,u])=>this.connection.Ho(t,ea(e,n),s,o,u,i))).catch((o=>{throw o.name==="FirebaseError"?(o.code===S.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new V(S.UNKNOWN,o.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class By{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(t){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.ca("Offline")))}set(t){this.Pa(),this.oa=0,t==="Online"&&(this.aa=!1),this.ca(t)}ca(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}la(t){const e=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(ft(e),this.aa=!1):C("OnlineStateTracker",e)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}const pn="RemoteStore";class Uy{constructor(t,e,n,s,i){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=i,this.Aa.Oo((o=>{n.enqueueAndForget((async()=>{Ue(this)&&(C(pn,"Restarting streams for network reachability change."),await(async function(c){const h=O(c);h.Ea.add(4),await ur(h),h.Ra.set("Unknown"),h.Ea.delete(4),await ws(h)})(this))}))})),this.Ra=new By(n,s)}}async function ws(r){if(Ue(r))for(const t of r.da)await t(!0)}async function ur(r){for(const t of r.da)await t(!1)}function Li(r,t){const e=O(r);e.Ia.has(t.targetId)||(e.Ia.set(t.targetId,t),Za(e)?Ya(e):lr(e).O_()&&Xa(e,t))}function tr(r,t){const e=O(r),n=lr(e);e.Ia.delete(t),n.O_()&&Pf(e,t),e.Ia.size===0&&(n.O_()?n.L_():Ue(e)&&e.Ra.set("Unknown"))}function Xa(r,t){if(r.Va.Ue(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(B.min())>0){const e=r.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(e)}lr(r).Y_(t)}function Pf(r,t){r.Va.Ue(t),lr(r).Z_(t)}function Ya(r){r.Va=new M_({getRemoteKeysForTarget:t=>r.remoteSyncer.getRemoteKeysForTarget(t),At:t=>r.Ia.get(t)||null,ht:()=>r.datastore.serializer.databaseId}),lr(r).start(),r.Ra.ua()}function Za(r){return Ue(r)&&!lr(r).x_()&&r.Ia.size>0}function Ue(r){return O(r).Ea.size===0}function Vf(r){r.Va=void 0}async function qy(r){r.Ra.set("Online")}async function jy(r){r.Ia.forEach(((t,e)=>{Xa(r,t)}))}async function zy(r,t){Vf(r),Za(r)?(r.Ra.ha(t),Ya(r)):r.Ra.set("Unknown")}async function $y(r,t,e){if(r.Ra.set("Online"),t instanceof Ud&&t.state===2&&t.cause)try{await(async function(s,i){const o=i.cause;for(const u of i.targetIds)s.Ia.has(u)&&(await s.remoteSyncer.rejectListen(u,o),s.Ia.delete(u),s.Va.removeTarget(u))})(r,t)}catch(n){C(pn,"Failed to remove targets %s: %s ",t.targetIds.join(","),n),await vi(r,n)}else if(t instanceof ni?r.Va.Ze(t):t instanceof Bd?r.Va.st(t):r.Va.tt(t),!e.isEqual(B.min()))try{const n=await _f(r.localStore);e.compareTo(n)>=0&&await(function(i,o){const u=i.Va.Tt(o);return u.targetChanges.forEach(((c,h)=>{if(c.resumeToken.approximateByteSize()>0){const f=i.Ia.get(h);f&&i.Ia.set(h,f.withResumeToken(c.resumeToken,o))}})),u.targetMismatches.forEach(((c,h)=>{const f=i.Ia.get(c);if(!f)return;i.Ia.set(c,f.withResumeToken(dt.EMPTY_BYTE_STRING,f.snapshotVersion)),Pf(i,c);const p=new oe(f.target,c,h,f.sequenceNumber);Xa(i,p)})),i.remoteSyncer.applyRemoteEvent(u)})(r,e)}catch(n){C(pn,"Failed to raise snapshot:",n),await vi(r,n)}}async function vi(r,t,e){if(!Le(t))throw t;r.Ea.add(1),await ur(r),r.Ra.set("Offline"),e||(e=()=>_f(r.localStore)),r.asyncQueue.enqueueRetryable((async()=>{C(pn,"Retrying IndexedDB access"),await e(),r.Ea.delete(1),await ws(r)}))}function Cf(r,t){return t().catch((e=>vi(r,e,t)))}async function cr(r){const t=O(r),e=Me(t);let n=t.Ta.length>0?t.Ta[t.Ta.length-1].batchId:Ve;for(;Gy(t);)try{const s=await Sy(t.localStore,n);if(s===null){t.Ta.length===0&&e.L_();break}n=s.batchId,Ky(t,s)}catch(s){await vi(t,s)}Df(t)&&xf(t)}function Gy(r){return Ue(r)&&r.Ta.length<10}function Ky(r,t){r.Ta.push(t);const e=Me(r);e.O_()&&e.X_&&e.ea(t.mutations)}function Df(r){return Ue(r)&&!Me(r).x_()&&r.Ta.length>0}function xf(r){Me(r).start()}async function Qy(r){Me(r).ra()}async function Wy(r){const t=Me(r);for(const e of r.Ta)t.ea(e.mutations)}async function Hy(r,t,e){const n=r.Ta.shift(),s=Oa.from(n,t,e);await Cf(r,(()=>r.remoteSyncer.applySuccessfulWrite(s))),await cr(r)}async function Jy(r,t){t&&Me(r).X_&&await(async function(n,s){if((function(o){return Od(o)&&o!==S.ABORTED})(s.code)){const i=n.Ta.shift();Me(n).B_(),await Cf(n,(()=>n.remoteSyncer.rejectFailedWrite(i.batchId,s))),await cr(n)}})(r,t),Df(r)&&xf(r)}async function zl(r,t){const e=O(r);e.asyncQueue.verifyOperationInProgress(),C(pn,"RemoteStore received new credentials");const n=Ue(e);e.Ea.add(3),await ur(e),n&&e.Ra.set("Unknown"),await e.remoteSyncer.handleCredentialChange(t),e.Ea.delete(3),await ws(e)}async function ca(r,t){const e=O(r);t?(e.Ea.delete(2),await ws(e)):t||(e.Ea.add(2),await ur(e),e.Ra.set("Unknown"))}function lr(r){return r.ma||(r.ma=(function(e,n,s){const i=O(e);return i.sa(),new My(n,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)})(r.datastore,r.asyncQueue,{Xo:qy.bind(null,r),t_:jy.bind(null,r),r_:zy.bind(null,r),H_:$y.bind(null,r)}),r.da.push((async t=>{t?(r.ma.B_(),Za(r)?Ya(r):r.Ra.set("Unknown")):(await r.ma.stop(),Vf(r))}))),r.ma}function Me(r){return r.fa||(r.fa=(function(e,n,s){const i=O(e);return i.sa(),new Oy(n,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)})(r.datastore,r.asyncQueue,{Xo:()=>Promise.resolve(),t_:Qy.bind(null,r),r_:Jy.bind(null,r),ta:Wy.bind(null,r),na:Hy.bind(null,r)}),r.da.push((async t=>{t?(r.fa.B_(),await cr(r)):(await r.fa.stop(),r.Ta.length>0&&(C(pn,`Stopping write stream with ${r.Ta.length} pending writes`),r.Ta=[]))}))),r.fa}class tu{constructor(t,e,n,s,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=s,this.removalCallback=i,this.deferred=new Rt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((o=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(t,e,n,s,i){const o=Date.now()+n,u=new tu(t,e,o,s,i);return u.start(n),u}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new V(S.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function hr(r,t){if(ft("AsyncQueue",`${t}: ${r}`),Le(r))return new V(S.UNAVAILABLE,`${t}: ${r}`);throw r}class On{static emptySet(t){return new On(t.comparator)}constructor(t){this.comparator=t?(e,n)=>t(e,n)||M.comparator(e.key,n.key):(e,n)=>M.comparator(e.key,n.key),this.keyedMap=Mr(),this.sortedSet=new st(this.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal(((e,n)=>(t(e),!1)))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof On)||this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){const s=e.getNext().key,i=n.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const t=[];return this.forEach((e=>{t.push(e.toString())})),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,e){const n=new On;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}}class $l{constructor(){this.ga=new st(M.comparator)}track(t){const e=t.doc.key,n=this.ga.get(e);n?t.type!==0&&n.type===3?this.ga=this.ga.insert(e,t):t.type===3&&n.type!==1?this.ga=this.ga.insert(e,{type:n.type,doc:t.doc}):t.type===2&&n.type===2?this.ga=this.ga.insert(e,{type:2,doc:t.doc}):t.type===2&&n.type===0?this.ga=this.ga.insert(e,{type:0,doc:t.doc}):t.type===1&&n.type===0?this.ga=this.ga.remove(e):t.type===1&&n.type===2?this.ga=this.ga.insert(e,{type:1,doc:n.doc}):t.type===0&&n.type===1?this.ga=this.ga.insert(e,{type:2,doc:t.doc}):F(63341,{Rt:t,pa:n}):this.ga=this.ga.insert(e,t)}ya(){const t=[];return this.ga.inorderTraversal(((e,n)=>{t.push(n)})),t}}class er{constructor(t,e,n,s,i,o,u,c,h){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=s,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=u,this.excludesMetadataChanges=c,this.hasCachedResults=h}static fromInitialDocuments(t,e,n,s,i){const o=[];return e.forEach((u=>{o.push({type:0,doc:u})})),new er(t,e,On.emptySet(e),o,n,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&gs(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let s=0;s<e.length;s++)if(e[s].type!==n[s].type||!e[s].doc.isEqual(n[s].doc))return!1;return!0}}class Xy{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((t=>t.Da()))}}class Yy{constructor(){this.queries=Gl(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(e,n){const s=O(e),i=s.queries;s.queries=Gl(),i.forEach(((o,u)=>{for(const c of u.Sa)c.onError(n)}))})(this,new V(S.ABORTED,"Firestore shutting down"))}}function Gl(){return new de((r=>wd(r)),gs)}async function eu(r,t){const e=O(r);let n=3;const s=t.query;let i=e.queries.get(s);i?!i.ba()&&t.Da()&&(n=2):(i=new Xy,n=t.Da()?0:1);try{switch(n){case 0:i.wa=await e.onListen(s,!0);break;case 1:i.wa=await e.onListen(s,!1);break;case 2:await e.onFirstRemoteStoreListen(s)}}catch(o){const u=hr(o,`Initialization of query '${Dn(t.query)}' failed`);return void t.onError(u)}e.queries.set(s,i),i.Sa.push(t),t.va(e.onlineState),i.wa&&t.Fa(i.wa)&&ru(e)}async function nu(r,t){const e=O(r),n=t.query;let s=3;const i=e.queries.get(n);if(i){const o=i.Sa.indexOf(t);o>=0&&(i.Sa.splice(o,1),i.Sa.length===0?s=t.Da()?0:1:!i.ba()&&t.Da()&&(s=2))}switch(s){case 0:return e.queries.delete(n),e.onUnlisten(n,!0);case 1:return e.queries.delete(n),e.onUnlisten(n,!1);case 2:return e.onLastRemoteStoreUnlisten(n);default:return}}function Zy(r,t){const e=O(r);let n=!1;for(const s of t){const i=s.query,o=e.queries.get(i);if(o){for(const u of o.Sa)u.Fa(s)&&(n=!0);o.wa=s}}n&&ru(e)}function tI(r,t,e){const n=O(r),s=n.queries.get(t);if(s)for(const i of s.Sa)i.onError(e);n.queries.delete(t)}function ru(r){r.Ca.forEach((t=>{t.next()}))}var la,Kl;(Kl=la||(la={})).Ma="default",Kl.Cache="cache";class su{constructor(t,e,n){this.query=t,this.xa=e,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=n||{}}Fa(t){if(!this.options.includeMetadataChanges){const n=[];for(const s of t.docChanges)s.type!==3&&n.push(s);t=new er(t.query,t.docs,t.oldDocs,n,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.Oa?this.Ba(t)&&(this.xa.next(t),e=!0):this.La(t,this.onlineState)&&(this.ka(t),e=!0),this.Na=t,e}onError(t){this.xa.error(t)}va(t){this.onlineState=t;let e=!1;return this.Na&&!this.Oa&&this.La(this.Na,t)&&(this.ka(this.Na),e=!0),e}La(t,e){if(!t.fromCache||!this.Da())return!0;const n=e!=="Offline";return(!this.options.qa||!n)&&(!t.docs.isEmpty()||t.hasCachedResults||e==="Offline")}Ba(t){if(t.docChanges.length>0)return!0;const e=this.Na&&this.Na.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&this.options.includeMetadataChanges===!0}ka(t){t=er.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.Oa=!0,this.xa.next(t)}Da(){return this.options.source!==la.Cache}}class eI{constructor(t,e){this.Qa=t,this.byteLength=e}$a(){return"metadata"in this.Qa}}class Ql{constructor(t){this.serializer=t}$s(t){return ee(this.serializer,t)}Us(t){return t.metadata.exists?Kd(this.serializer,t.document,!1):ot.newNoDocument(this.$s(t.metadata.name),this.Ks(t.metadata.readTime))}Ks(t){return mt(t)}}class nI{constructor(t,e){this.Ua=t,this.serializer=e,this.Ka=[],this.Wa=[],this.collectionGroups=new Set,this.progress=Nf(t)}get queries(){return this.Ka}get documents(){return this.Wa}Ga(t){this.progress.bytesLoaded+=t.byteLength;let e=this.progress.documentsLoaded;if(t.Qa.namedQuery)this.Ka.push(t.Qa.namedQuery);else if(t.Qa.documentMetadata){this.Wa.push({metadata:t.Qa.documentMetadata}),t.Qa.documentMetadata.exists||++e;const n=K.fromString(t.Qa.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else t.Qa.document&&(this.Wa[this.Wa.length-1].document=t.Qa.document,++e);return e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,{...this.progress}):null}za(t){const e=new Map,n=new Ql(this.serializer);for(const s of t)if(s.metadata.queries){const i=n.$s(s.metadata.name);for(const o of s.metadata.queries){const u=(e.get(o)||$()).add(i);e.set(o,u)}}return e}async ja(t){const e=await Py(t,new Ql(this.serializer),this.Wa,this.Ua.id),n=this.za(this.documents);for(const s of this.Ka)await Vy(t,s,n.get(s.name));return this.progress.taskState="Success",{progress:this.progress,Ja:this.collectionGroups,Ha:e}}}function Nf(r){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:r.totalDocuments,totalBytes:r.totalBytes}}class kf{constructor(t){this.key=t}}class Mf{constructor(t){this.key=t}}class Of{constructor(t,e){this.query=t,this.Ya=e,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=$(),this.mutatedKeys=$(),this.eu=Ad(t),this.tu=new On(this.eu)}get nu(){return this.Ya}ru(t,e){const n=e?e.iu:new $l,s=e?e.tu:this.tu;let i=e?e.mutatedKeys:this.mutatedKeys,o=s,u=!1;const c=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,h=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(t.inorderTraversal(((f,p)=>{const _=s.get(f),R=_s(this.query,p)?p:null,x=!!_&&this.mutatedKeys.has(_.key),N=!!R&&(R.hasLocalMutations||this.mutatedKeys.has(R.key)&&R.hasCommittedMutations);let D=!1;_&&R?_.data.isEqual(R.data)?x!==N&&(n.track({type:3,doc:R}),D=!0):this.su(_,R)||(n.track({type:2,doc:R}),D=!0,(c&&this.eu(R,c)>0||h&&this.eu(R,h)<0)&&(u=!0)):!_&&R?(n.track({type:0,doc:R}),D=!0):_&&!R&&(n.track({type:1,doc:_}),D=!0,(c||h)&&(u=!0)),D&&(R?(o=o.add(R),i=N?i.add(f):i.delete(f)):(o=o.delete(f),i=i.delete(f)))})),this.query.limit!==null)for(;o.size>this.query.limit;){const f=this.query.limitType==="F"?o.last():o.first();o=o.delete(f.key),i=i.delete(f.key),n.track({type:1,doc:f})}return{tu:o,iu:n,Cs:u,mutatedKeys:i}}su(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n,s){const i=this.tu;this.tu=t.tu,this.mutatedKeys=t.mutatedKeys;const o=t.iu.ya();o.sort(((f,p)=>(function(R,x){const N=D=>{switch(D){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return F(20277,{Rt:D})}};return N(R)-N(x)})(f.type,p.type)||this.eu(f.doc,p.doc))),this.ou(n),s=s??!1;const u=e&&!s?this._u():[],c=this.Xa.size===0&&this.current&&!s?1:0,h=c!==this.Za;return this.Za=c,o.length!==0||h?{snapshot:new er(this.query,t.tu,i,o,t.mutatedKeys,c===0,h,!1,!!n&&n.resumeToken.approximateByteSize()>0),au:u}:{au:u}}va(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new $l,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(t){return!this.Ya.has(t)&&!!this.tu.has(t)&&!this.tu.get(t).hasLocalMutations}ou(t){t&&(t.addedDocuments.forEach((e=>this.Ya=this.Ya.add(e))),t.modifiedDocuments.forEach((e=>{})),t.removedDocuments.forEach((e=>this.Ya=this.Ya.delete(e))),this.current=t.current)}_u(){if(!this.current)return[];const t=this.Xa;this.Xa=$(),this.tu.forEach((n=>{this.uu(n.key)&&(this.Xa=this.Xa.add(n.key))}));const e=[];return t.forEach((n=>{this.Xa.has(n)||e.push(new Mf(n))})),this.Xa.forEach((n=>{t.has(n)||e.push(new kf(n))})),e}cu(t){this.Ya=t.Qs,this.Xa=$();const e=this.ru(t.documents);return this.applyChanges(e,!0)}lu(){return er.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const qe="SyncEngine";class rI{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class sI{constructor(t){this.key=t,this.hu=!1}}class iI{constructor(t,e,n,s,i,o){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Pu={},this.Tu=new de((u=>wd(u)),gs),this.Iu=new Map,this.Eu=new Set,this.du=new st(M.comparator),this.Au=new Map,this.Ru=new za,this.Vu={},this.mu=new Map,this.fu=mn.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function oI(r,t,e=!0){const n=Bi(r);let s;const i=n.Tu.get(t);return i?(n.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.lu()):s=await Ff(n,t,e,!0),s}async function aI(r,t){const e=Bi(r);await Ff(e,t,!0,!1)}async function Ff(r,t,e,n){const s=await Yn(r.localStore,kt(t)),i=s.targetId,o=r.sharedClientState.addLocalQueryTarget(i,e);let u;return n&&(u=await iu(r,t,i,o==="current",s.resumeToken)),r.isPrimaryClient&&e&&Li(r.remoteStore,s),u}async function iu(r,t,e,n,s){r.pu=(p,_,R)=>(async function(N,D,q,j){let U=D.view.ru(q);U.Cs&&(U=await Ei(N.localStore,D.query,!1).then((({documents:E})=>D.view.ru(E,U))));const nt=j&&j.targetChanges.get(D.targetId),X=j&&j.targetMismatches.get(D.targetId)!=null,H=D.view.applyChanges(U,N.isPrimaryClient,nt,X);return ha(N,D.targetId,H.au),H.snapshot})(r,p,_,R);const i=await Ei(r.localStore,t,!0),o=new Of(t,i.Qs),u=o.ru(i.documents),c=Es.createSynthesizedTargetChangeForCurrentChange(e,n&&r.onlineState!=="Offline",s),h=o.applyChanges(u,r.isPrimaryClient,c);ha(r,e,h.au);const f=new rI(t,e,o);return r.Tu.set(t,f),r.Iu.has(e)?r.Iu.get(e).push(t):r.Iu.set(e,[t]),h.snapshot}async function uI(r,t,e){const n=O(r),s=n.Tu.get(t),i=n.Iu.get(s.targetId);if(i.length>1)return n.Iu.set(s.targetId,i.filter((o=>!gs(o,t)))),void n.Tu.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(s.targetId),n.sharedClientState.isActiveQueryTarget(s.targetId)||await Zn(n.localStore,s.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(s.targetId),e&&tr(n.remoteStore,s.targetId),nr(n,s.targetId)})).catch(Fe)):(nr(n,s.targetId),await Zn(n.localStore,s.targetId,!0))}async function cI(r,t){const e=O(r),n=e.Tu.get(t),s=e.Iu.get(n.targetId);e.isPrimaryClient&&s.length===1&&(e.sharedClientState.removeLocalQueryTarget(n.targetId),tr(e.remoteStore,n.targetId))}async function lI(r,t,e){const n=cu(r);try{const s=await(function(o,u){const c=O(o),h=Z.now(),f=u.reduce(((R,x)=>R.add(x.key)),$());let p,_;return c.persistence.runTransaction("Locally write mutations","readwrite",(R=>{let x=Bt(),N=$();return c.Ns.getEntries(R,f).next((D=>{x=D,x.forEach(((q,j)=>{j.isValidDocument()||(N=N.add(q))}))})).next((()=>c.localDocuments.getOverlayedDocuments(R,x))).next((D=>{p=D;const q=[];for(const j of u){const U=x_(j,p.get(j.key).overlayedDocument);U!=null&&q.push(new fe(j.key,U,fd(U.value.mapValue),ut.exists(!0)))}return c.mutationQueue.addMutationBatch(R,h,q,u)})).next((D=>{_=D;const q=D.applyToLocalDocumentSet(p,N);return c.documentOverlayCache.saveOverlays(R,D.batchId,q)}))})).then((()=>({batchId:_.batchId,changes:Rd(p)})))})(n.localStore,t);n.sharedClientState.addPendingMutation(s.batchId),(function(o,u,c){let h=o.Vu[o.currentUser.toKey()];h||(h=new st(z)),h=h.insert(u,c),o.Vu[o.currentUser.toKey()]=h})(n,s.batchId,e),await me(n,s.changes),await cr(n.remoteStore)}catch(s){const i=hr(s,"Failed to persist write");e.reject(i)}}async function Lf(r,t){const e=O(r);try{const n=await Ry(e.localStore,t);t.targetChanges.forEach(((s,i)=>{const o=e.Au.get(i);o&&(L(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?o.hu=!0:s.modifiedDocuments.size>0?L(o.hu,14607):s.removedDocuments.size>0&&(L(o.hu,42227),o.hu=!1))})),await me(e,n,t)}catch(n){await Fe(n)}}function Wl(r,t,e){const n=O(r);if(n.isPrimaryClient&&e===0||!n.isPrimaryClient&&e===1){const s=[];n.Tu.forEach(((i,o)=>{const u=o.view.va(t);u.snapshot&&s.push(u.snapshot)})),(function(o,u){const c=O(o);c.onlineState=u;let h=!1;c.queries.forEach(((f,p)=>{for(const _ of p.Sa)_.va(u)&&(h=!0)})),h&&ru(c)})(n.eventManager,t),s.length&&n.Pu.H_(s),n.onlineState=t,n.isPrimaryClient&&n.sharedClientState.setOnlineState(t)}}async function hI(r,t,e){const n=O(r);n.sharedClientState.updateQueryState(t,"rejected",e);const s=n.Au.get(t),i=s&&s.key;if(i){let o=new st(M.comparator);o=o.insert(i,ot.newNoDocument(i,B.min()));const u=$().add(i),c=new Is(B.min(),new Map,new st(z),o,u);await Lf(n,c),n.du=n.du.remove(i),n.Au.delete(t),uu(n)}else await Zn(n.localStore,t,!1).then((()=>nr(n,t,e))).catch(Fe)}async function dI(r,t){const e=O(r),n=t.batch.batchId;try{const s=await by(e.localStore,t);au(e,n,null),ou(e,n),e.sharedClientState.updateMutationState(n,"acknowledged"),await me(e,s)}catch(s){await Fe(s)}}async function fI(r,t,e){const n=O(r);try{const s=await(function(o,u){const c=O(o);return c.persistence.runTransaction("Reject batch","readwrite-primary",(h=>{let f;return c.mutationQueue.lookupMutationBatch(h,u).next((p=>(L(p!==null,37113),f=p.keys(),c.mutationQueue.removeMutationBatch(h,p)))).next((()=>c.mutationQueue.performConsistencyCheck(h))).next((()=>c.documentOverlayCache.removeOverlaysForBatchId(h,f,u))).next((()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(h,f))).next((()=>c.localDocuments.getDocuments(h,f)))}))})(n.localStore,t);au(n,t,e),ou(n,t),n.sharedClientState.updateMutationState(t,"rejected",e),await me(n,s)}catch(s){await Fe(s)}}async function mI(r,t){const e=O(r);Ue(e.remoteStore)||C(qe,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const n=await(function(o){const u=O(o);return u.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(c=>u.mutationQueue.getHighestUnacknowledgedBatchId(c)))})(e.localStore);if(n===Ve)return void t.resolve();const s=e.mu.get(n)||[];s.push(t),e.mu.set(n,s)}catch(n){const s=hr(n,"Initialization of waitForPendingWrites() operation failed");t.reject(s)}}function ou(r,t){(r.mu.get(t)||[]).forEach((e=>{e.resolve()})),r.mu.delete(t)}function au(r,t,e){const n=O(r);let s=n.Vu[n.currentUser.toKey()];if(s){const i=s.get(t);i&&(e?i.reject(e):i.resolve(),s=s.remove(t)),n.Vu[n.currentUser.toKey()]=s}}function nr(r,t,e=null){r.sharedClientState.removeLocalQueryTarget(t);for(const n of r.Iu.get(t))r.Tu.delete(n),e&&r.Pu.yu(n,e);r.Iu.delete(t),r.isPrimaryClient&&r.Ru.jr(t).forEach((n=>{r.Ru.containsKey(n)||Bf(r,n)}))}function Bf(r,t){r.Eu.delete(t.path.canonicalString());const e=r.du.get(t);e!==null&&(tr(r.remoteStore,e),r.du=r.du.remove(t),r.Au.delete(e),uu(r))}function ha(r,t,e){for(const n of e)n instanceof kf?(r.Ru.addReference(n.key,t),pI(r,n)):n instanceof Mf?(C(qe,"Document no longer in limbo: "+n.key),r.Ru.removeReference(n.key,t),r.Ru.containsKey(n.key)||Bf(r,n.key)):F(19791,{wu:n})}function pI(r,t){const e=t.key,n=e.path.canonicalString();r.du.get(e)||r.Eu.has(n)||(C(qe,"New document in limbo: "+e),r.Eu.add(n),uu(r))}function uu(r){for(;r.Eu.size>0&&r.du.size<r.maxConcurrentLimboResolutions;){const t=r.Eu.values().next().value;r.Eu.delete(t);const e=new M(K.fromString(t)),n=r.fu.next();r.Au.set(n,new sI(e)),r.du=r.du.insert(e,n),Li(r.remoteStore,new oe(kt(ir(e.path)),n,"TargetPurposeLimboResolution",Ft.ce))}}async function me(r,t,e){const n=O(r),s=[],i=[],o=[];n.Tu.isEmpty()||(n.Tu.forEach(((u,c)=>{o.push(n.pu(c,t,e).then((h=>{if((h||e)&&n.isPrimaryClient){const f=h?!h.fromCache:e?.targetChanges.get(c.targetId)?.current;n.sharedClientState.updateQueryState(c.targetId,f?"current":"not-current")}if(h){s.push(h);const f=Qa.As(c.targetId,h);i.push(f)}})))})),await Promise.all(o),n.Pu.H_(s),await(async function(c,h){const f=O(c);try{await f.persistence.runTransaction("notifyLocalViewChanges","readwrite",(p=>v.forEach(h,(_=>v.forEach(_.Es,(R=>f.persistence.referenceDelegate.addReference(p,_.targetId,R))).next((()=>v.forEach(_.ds,(R=>f.persistence.referenceDelegate.removeReference(p,_.targetId,R)))))))))}catch(p){if(!Le(p))throw p;C(Wa,"Failed to update sequence numbers: "+p)}for(const p of h){const _=p.targetId;if(!p.fromCache){const R=f.Ms.get(_),x=R.snapshotVersion,N=R.withLastLimboFreeSnapshotVersion(x);f.Ms=f.Ms.insert(_,N)}}})(n.localStore,i))}async function gI(r,t){const e=O(r);if(!e.currentUser.isEqual(t)){C(qe,"User change. New user:",t.toKey());const n=await gf(e.localStore,t);e.currentUser=t,(function(i,o){i.mu.forEach((u=>{u.forEach((c=>{c.reject(new V(S.CANCELLED,o))}))})),i.mu.clear()})(e,"'waitForPendingWrites' promise is rejected due to a user change."),e.sharedClientState.handleUserChange(t,n.removedBatchIds,n.addedBatchIds),await me(e,n.Ls)}}function _I(r,t){const e=O(r),n=e.Au.get(t);if(n&&n.hu)return $().add(n.key);{let s=$();const i=e.Iu.get(t);if(!i)return s;for(const o of i){const u=e.Tu.get(o);s=s.unionWith(u.view.nu)}return s}}async function yI(r,t){const e=O(r),n=await Ei(e.localStore,t.query,!0),s=t.view.cu(n);return e.isPrimaryClient&&ha(e,t.targetId,s.au),s}async function II(r,t){const e=O(r);return Ef(e.localStore,t).then((n=>me(e,n)))}async function EI(r,t,e,n){const s=O(r),i=await(function(u,c){const h=O(u),f=O(h.mutationQueue);return h.persistence.runTransaction("Lookup mutation documents","readonly",(p=>f.er(p,c).next((_=>_?h.localDocuments.getDocuments(p,_):v.resolve(null)))))})(s.localStore,t);i!==null?(e==="pending"?await cr(s.remoteStore):e==="acknowledged"||e==="rejected"?(au(s,t,n||null),ou(s,t),(function(u,c){O(O(u).mutationQueue).ir(c)})(s.localStore,t)):F(6720,"Unknown batchState",{Su:e}),await me(s,i)):C(qe,"Cannot apply mutation batch with id: "+t)}async function TI(r,t){const e=O(r);if(Bi(e),cu(e),t===!0&&e.gu!==!0){const n=e.sharedClientState.getAllActiveQueryTargets(),s=await Hl(e,n.toArray());e.gu=!0,await ca(e.remoteStore,!0);for(const i of s)Li(e.remoteStore,i)}else if(t===!1&&e.gu!==!1){const n=[];let s=Promise.resolve();e.Iu.forEach(((i,o)=>{e.sharedClientState.isLocalQueryTarget(o)?n.push(o):s=s.then((()=>(nr(e,o),Zn(e.localStore,o,!0)))),tr(e.remoteStore,o)})),await s,await Hl(e,n),(function(o){const u=O(o);u.Au.forEach(((c,h)=>{tr(u.remoteStore,h)})),u.Ru.Jr(),u.Au=new Map,u.du=new st(M.comparator)})(e),e.gu=!1,await ca(e.remoteStore,!1)}}async function Hl(r,t,e){const n=O(r),s=[],i=[];for(const o of t){let u;const c=n.Iu.get(o);if(c&&c.length!==0){u=await Yn(n.localStore,kt(c[0]));for(const h of c){const f=n.Tu.get(h),p=await yI(n,f);p.snapshot&&i.push(p.snapshot)}}else{const h=await If(n.localStore,o);u=await Yn(n.localStore,h),await iu(n,Uf(h),o,!1,u.resumeToken)}s.push(u)}return n.Pu.H_(i),s}function Uf(r){return Td(r.path,r.collectionGroup,r.orderBy,r.filters,r.limit,"F",r.startAt,r.endAt)}function wI(r){return(function(e){return O(O(e).persistence).Ts()})(O(r).localStore)}async function vI(r,t,e,n){const s=O(r);if(s.gu)return void C(qe,"Ignoring unexpected query state notification.");const i=s.Iu.get(t);if(i&&i.length>0)switch(e){case"current":case"not-current":{const o=await Ef(s.localStore,vd(i[0])),u=Is.createSynthesizedRemoteEventForCurrentChange(t,e==="current",dt.EMPTY_BYTE_STRING);await me(s,o,u);break}case"rejected":await Zn(s.localStore,t,!0),nr(s,t,n);break;default:F(64155,e)}}async function AI(r,t,e){const n=Bi(r);if(n.gu){for(const s of t){if(n.Iu.has(s)&&n.sharedClientState.isActiveQueryTarget(s)){C(qe,"Adding an already active target "+s);continue}const i=await If(n.localStore,s),o=await Yn(n.localStore,i);await iu(n,Uf(i),o.targetId,!1,o.resumeToken),Li(n.remoteStore,o)}for(const s of e)n.Iu.has(s)&&await Zn(n.localStore,s,!1).then((()=>{tr(n.remoteStore,s),nr(n,s)})).catch(Fe)}}function Bi(r){const t=O(r);return t.remoteStore.remoteSyncer.applyRemoteEvent=Lf.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=_I.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=hI.bind(null,t),t.Pu.H_=Zy.bind(null,t.eventManager),t.Pu.yu=tI.bind(null,t.eventManager),t}function cu(r){const t=O(r);return t.remoteStore.remoteSyncer.applySuccessfulWrite=dI.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=fI.bind(null,t),t}function bI(r,t,e){const n=O(r);(async function(i,o,u){try{const c=await o.getMetadata();if(await(function(R,x){const N=O(R),D=mt(x.createTime);return N.persistence.runTransaction("hasNewerBundle","readonly",(q=>N.Ii.getBundleMetadata(q,x.id))).then((q=>!!q&&q.createTime.compareTo(D)>=0))})(i.localStore,c))return await o.close(),u._completeWith((function(R){return{taskState:"Success",documentsLoaded:R.totalDocuments,bytesLoaded:R.totalBytes,totalDocuments:R.totalDocuments,totalBytes:R.totalBytes}})(c)),Promise.resolve(new Set);u._updateProgress(Nf(c));const h=new nI(c,o.serializer);let f=await o.bu();for(;f;){const _=await h.Ga(f);_&&u._updateProgress(_),f=await o.bu()}const p=await h.ja(i.localStore);return await me(i,p.Ha,void 0),await(function(R,x){const N=O(R);return N.persistence.runTransaction("Save bundle","readwrite",(D=>N.Ii.saveBundleMetadata(D,x)))})(i.localStore,c),u._completeWith(p.progress),Promise.resolve(p.Ja)}catch(c){return ue(qe,`Loading bundle failed with ${c}`),u._failWith(c),Promise.resolve(new Set)}})(n,t,e).then((s=>{n.sharedClientState.notifyBundleLoaded(s)}))}class cs{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(t){this.serializer=Ts(t.databaseInfo.databaseId),this.sharedClientState=this.Du(t),this.persistence=this.Cu(t),await this.persistence.start(),this.localStore=this.vu(t),this.gcScheduler=this.Fu(t,this.localStore),this.indexBackfillerScheduler=this.Mu(t,this.localStore)}Fu(t,e){return null}Mu(t,e){return null}vu(t){return pf(this.persistence,new mf,t.initialUser,this.serializer)}Cu(t){return new $a(Fi.mi,this.serializer)}Du(t){return new bf}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}cs.provider={build:()=>new cs};class RI extends cs{constructor(t){super(),this.cacheSizeBytes=t}Fu(t,e){L(this.persistence.referenceDelegate instanceof Ii,46915);const n=this.persistence.referenceDelegate.garbageCollector;return new uf(n,t.asyncQueue,e)}Cu(t){const e=this.cacheSizeBytes!==void 0?Ct.withCacheSize(this.cacheSizeBytes):Ct.DEFAULT;return new $a((n=>Ii.mi(n,e)),this.serializer)}}class qf extends cs{constructor(t,e,n){super(),this.xu=t,this.cacheSizeBytes=e,this.forceOwnership=n,this.kind="persistent",this.synchronizeTabs=!1}async initialize(t){await super.initialize(t),await this.xu.initialize(this,t),await cu(this.xu.syncEngine),await cr(this.xu.remoteStore),await this.persistence.Ji((()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve())))}vu(t){return pf(this.persistence,new mf,t.initialUser,this.serializer)}Fu(t,e){const n=this.persistence.referenceDelegate.garbageCollector;return new uf(n,t.asyncQueue,e)}Mu(t,e){const n=new Og(e,this.persistence);return new Mg(t.asyncQueue,n)}Cu(t){const e=Ka(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=this.cacheSizeBytes!==void 0?Ct.withCacheSize(this.cacheSizeBytes):Ct.DEFAULT;return new Ga(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,Rf(),si(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Du(t){return new bf}}class SI extends qf{constructor(t,e){super(t,e,!1),this.xu=t,this.cacheSizeBytes=e,this.synchronizeTabs=!0}async initialize(t){await super.initialize(t);const e=this.xu.syncEngine;this.sharedClientState instanceof No&&(this.sharedClientState.syncEngine={Co:EI.bind(null,e),vo:vI.bind(null,e),Fo:AI.bind(null,e),Ts:wI.bind(null,e),Do:II.bind(null,e)},await this.sharedClientState.start()),await this.persistence.Ji((async n=>{await TI(this.xu.syncEngine,n),this.gcScheduler&&(n&&!this.gcScheduler.started?this.gcScheduler.start():n||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(n&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():n||this.indexBackfillerScheduler.stop())}))}Du(t){const e=Rf();if(!No.v(e))throw new V(S.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const n=Ka(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new No(e,t.asyncQueue,n,t.clientId,t.initialUser)}}class ls{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=n=>Wl(this.syncEngine,n,1),this.remoteStore.remoteSyncer.handleCredentialChange=gI.bind(null,this.syncEngine),await ca(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return(function(){return new Yy})()}createDatastore(t){const e=Ts(t.databaseInfo.databaseId),n=(function(i){return new ky(i)})(t.databaseInfo);return(function(i,o,u,c){return new Ly(i,o,u,c)})(t.authCredentials,t.appCheckCredentials,n,e)}createRemoteStore(t){return(function(n,s,i,o,u){return new Uy(n,s,i,o,u)})(this.localStore,this.datastore,t.asyncQueue,(e=>Wl(this.syncEngine,e,0)),(function(){return ql.v()?new ql:new Cy})())}createSyncEngine(t,e){return(function(s,i,o,u,c,h,f){const p=new iI(s,i,o,u,c,h);return f&&(p.gu=!0),p})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}async terminate(){await(async function(e){const n=O(e);C(pn,"RemoteStore shutting down."),n.Ea.add(5),await ur(n),n.Aa.shutdown(),n.Ra.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}ls.provider={build:()=>new ls};function Jl(r,t=10240){let e=0;return{async read(){if(e<r.byteLength){const n={value:r.slice(e,e+t),done:!1};return e+=t,n}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}class Ui{constructor(t){this.observer=t,this.muted=!1}next(t){this.muted||this.observer.next&&this.Ou(this.observer.next,t)}error(t){this.muted||(this.observer.error?this.Ou(this.observer.error,t):ft("Uncaught Error in snapshot listener:",t.toString()))}Nu(){this.muted=!0}Ou(t,e){setTimeout((()=>{this.muted||t(e)}),0)}}class PI{constructor(t,e){this.Bu=t,this.serializer=e,this.metadata=new Rt,this.buffer=new Uint8Array,this.Lu=(function(){return new TextDecoder("utf-8")})(),this.ku().then((n=>{n&&n.$a()?this.metadata.resolve(n.Qa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(n?.Qa)}`))}),(n=>this.metadata.reject(n)))}close(){return this.Bu.cancel()}async getMetadata(){return this.metadata.promise}async bu(){return await this.getMetadata(),this.ku()}async ku(){const t=await this.qu();if(t===null)return null;const e=this.Lu.decode(t),n=Number(e);isNaN(n)&&this.Qu(`length string (${e}) is not valid number`);const s=await this.$u(n);return new eI(JSON.parse(s),t.length+n)}Uu(){return this.buffer.findIndex((t=>t===123))}async qu(){for(;this.Uu()<0&&!await this.Ku(););if(this.buffer.length===0)return null;const t=this.Uu();t<0&&this.Qu("Reached the end of bundle when a length string is expected.");const e=this.buffer.slice(0,t);return this.buffer=this.buffer.slice(t),e}async $u(t){for(;this.buffer.length<t;)await this.Ku()&&this.Qu("Reached the end of bundle when more is expected.");const e=this.Lu.decode(this.buffer.slice(0,t));return this.buffer=this.buffer.slice(t),e}Qu(t){throw this.Bu.cancel(),new Error(`Invalid bundle format: ${t}`)}async Ku(){const t=await this.Bu.read();if(!t.done){const e=new Uint8Array(this.buffer.length+t.value.length);e.set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e}return t.done}}class VI{constructor(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(t){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new V(S.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const e=await(async function(s,i){const o=O(s),u={documents:i.map((p=>as(o.serializer,p)))},c=await o.Ho("BatchGetDocuments",o.serializer.databaseId,K.emptyPath(),u,i.length),h=new Map;c.forEach((p=>{const _=q_(o.serializer,p);h.set(_.key.toString(),_)}));const f=[];return i.forEach((p=>{const _=h.get(p.toString());L(!!_,55234,{key:p}),f.push(_)})),f})(this.datastore,t);return e.forEach((n=>this.recordVersion(n))),e}set(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())}update(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(n){this.lastTransactionError=n}this.writtenDocs.add(t.toString())}delete(t){this.write(new ar(t,this.precondition(t))),this.writtenDocs.add(t.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const t=this.readVersions;this.mutations.forEach((e=>{t.delete(e.key.toString())})),t.forEach(((e,n)=>{const s=M.fromPath(n);this.mutations.push(new ka(s,this.precondition(s)))})),await(async function(n,s){const i=O(n),o={writes:s.map((u=>us(i.serializer,u)))};await i.Go("Commit",i.serializer.databaseId,K.emptyPath(),o)})(this.datastore,this.mutations),this.committed=!0}recordVersion(t){let e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw F(50498,{Gu:t.constructor.name});e=B.min()}const n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new V(S.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)}precondition(t){const e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?e.isEqual(B.min())?ut.exists(!1):ut.updateTime(e):ut.none()}preconditionForUpdate(t){const e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(B.min()))throw new V(S.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return ut.updateTime(e)}return ut.exists(!0)}write(t){this.ensureCommitNotCalled(),this.mutations.push(t)}ensureCommitNotCalled(){}}class CI{constructor(t,e,n,s,i){this.asyncQueue=t,this.datastore=e,this.options=n,this.updateFunction=s,this.deferred=i,this.zu=n.maxAttempts,this.M_=new Ja(this.asyncQueue,"transaction_retry")}ju(){this.zu-=1,this.Ju()}Ju(){this.M_.p_((async()=>{const t=new VI(this.datastore),e=this.Hu(t);e&&e.then((n=>{this.asyncQueue.enqueueAndForget((()=>t.commit().then((()=>{this.deferred.resolve(n)})).catch((s=>{this.Yu(s)}))))})).catch((n=>{this.Yu(n)}))}))}Hu(t){try{const e=this.updateFunction(t);return!fs(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}Yu(t){this.zu>0&&this.Zu(t)?(this.zu-=1,this.asyncQueue.enqueueAndForget((()=>(this.Ju(),Promise.resolve())))):this.deferred.reject(t)}Zu(t){if(t?.name==="FirebaseError"){const e=t.code;return e==="aborted"||e==="failed-precondition"||e==="already-exists"||!Od(e)}return!1}}const Oe="FirestoreClient";class DI{constructor(t,e,n,s,i){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=s,this.user=wt.UNAUTHENTICATED,this.clientId=Ea.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(n,(async o=>{C(Oe,"Received user=",o.uid),await this.authCredentialListener(o),this.user=o})),this.appCheckCredentials.start(n,(o=>(C(Oe,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();const t=new Rt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const n=hr(e,"Failed to shutdown persistence");t.reject(n)}})),t.promise}}async function Mo(r,t){r.asyncQueue.verifyOperationInProgress(),C(Oe,"Initializing OfflineComponentProvider");const e=r.configuration;await t.initialize(e);let n=e.initialUser;r.setCredentialChangeListener((async s=>{n.isEqual(s)||(await gf(t.localStore,s),n=s)})),t.persistence.setDatabaseDeletedListener((()=>r.terminate())),r._offlineComponents=t}async function Xl(r,t){r.asyncQueue.verifyOperationInProgress();const e=await lu(r);C(Oe,"Initializing OnlineComponentProvider"),await t.initialize(e,r.configuration),r.setCredentialChangeListener((n=>zl(t.remoteStore,n))),r.setAppCheckTokenChangeListener(((n,s)=>zl(t.remoteStore,s))),r._onlineComponents=t}async function lu(r){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){C(Oe,"Using user provided OfflineComponentProvider");try{await Mo(r,r._uninitializedComponentsProvider._offline)}catch(t){const e=t;if(!(function(s){return s.name==="FirebaseError"?s.code===S.FAILED_PRECONDITION||s.code===S.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11})(e))throw e;ue("Error using user provided cache. Falling back to memory cache: "+e),await Mo(r,new cs)}}else C(Oe,"Using default OfflineComponentProvider"),await Mo(r,new RI(void 0));return r._offlineComponents}async function qi(r){return r._onlineComponents||(r._uninitializedComponentsProvider?(C(Oe,"Using user provided OnlineComponentProvider"),await Xl(r,r._uninitializedComponentsProvider._online)):(C(Oe,"Using default OnlineComponentProvider"),await Xl(r,new ls))),r._onlineComponents}function jf(r){return lu(r).then((t=>t.persistence))}function hu(r){return lu(r).then((t=>t.localStore))}function zf(r){return qi(r).then((t=>t.remoteStore))}function du(r){return qi(r).then((t=>t.syncEngine))}function xI(r){return qi(r).then((t=>t.datastore))}async function rr(r){const t=await qi(r),e=t.eventManager;return e.onListen=oI.bind(null,t.syncEngine),e.onUnlisten=uI.bind(null,t.syncEngine),e.onFirstRemoteStoreListen=aI.bind(null,t.syncEngine),e.onLastRemoteStoreUnlisten=cI.bind(null,t.syncEngine),e}function NI(r){return r.asyncQueue.enqueue((async()=>{const t=await jf(r),e=await zf(r);return t.setNetworkEnabled(!0),(function(s){const i=O(s);return i.Ea.delete(0),ws(i)})(e)}))}function kI(r){return r.asyncQueue.enqueue((async()=>{const t=await jf(r),e=await zf(r);return t.setNetworkEnabled(!1),(async function(s){const i=O(s);i.Ea.add(0),await ur(i),i.Ra.set("Offline")})(e)}))}function MI(r,t){const e=new Rt;return r.asyncQueue.enqueueAndForget((async()=>(async function(s,i,o){try{const u=await(function(h,f){const p=O(h);return p.persistence.runTransaction("read document","readonly",(_=>p.localDocuments.getDocument(_,f)))})(s,i);u.isFoundDocument()?o.resolve(u):u.isNoDocument()?o.resolve(null):o.reject(new V(S.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(u){const c=hr(u,`Failed to get document '${i} from cache`);o.reject(c)}})(await hu(r),t,e))),e.promise}function $f(r,t,e={}){const n=new Rt;return r.asyncQueue.enqueueAndForget((async()=>(function(i,o,u,c,h){const f=new Ui({next:_=>{f.Nu(),o.enqueueAndForget((()=>nu(i,p)));const R=_.docs.has(u);!R&&_.fromCache?h.reject(new V(S.UNAVAILABLE,"Failed to get document because the client is offline.")):R&&_.fromCache&&c&&c.source==="server"?h.reject(new V(S.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):h.resolve(_)},error:_=>h.reject(_)}),p=new su(ir(u.path),f,{includeMetadataChanges:!0,qa:!0});return eu(i,p)})(await rr(r),r.asyncQueue,t,e,n))),n.promise}function OI(r,t){const e=new Rt;return r.asyncQueue.enqueueAndForget((async()=>(async function(s,i,o){try{const u=await Ei(s,i,!0),c=new Of(i,u.Qs),h=c.ru(u.documents),f=c.applyChanges(h,!1);o.resolve(f.snapshot)}catch(u){const c=hr(u,`Failed to execute query '${i} against cache`);o.reject(c)}})(await hu(r),t,e))),e.promise}function Gf(r,t,e={}){const n=new Rt;return r.asyncQueue.enqueueAndForget((async()=>(function(i,o,u,c,h){const f=new Ui({next:_=>{f.Nu(),o.enqueueAndForget((()=>nu(i,p))),_.fromCache&&c.source==="server"?h.reject(new V(S.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):h.resolve(_)},error:_=>h.reject(_)}),p=new su(u,f,{includeMetadataChanges:!0,qa:!0});return eu(i,p)})(await rr(r),r.asyncQueue,t,e,n))),n.promise}function FI(r,t){const e=new Ui(t);return r.asyncQueue.enqueueAndForget((async()=>(function(s,i){O(s).Ca.add(i),i.next()})(await rr(r),e))),()=>{e.Nu(),r.asyncQueue.enqueueAndForget((async()=>(function(s,i){O(s).Ca.delete(i)})(await rr(r),e)))}}function LI(r,t,e,n){const s=(function(o,u){let c;return c=typeof o=="string"?Ld().encode(o):o,(function(f,p){return new PI(f,p)})((function(f,p){if(f instanceof Uint8Array)return Jl(f,p);if(f instanceof ArrayBuffer)return Jl(new Uint8Array(f),p);if(f instanceof ReadableStream)return f.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")})(c),u)})(e,Ts(t));r.asyncQueue.enqueueAndForget((async()=>{bI(await du(r),s,n)}))}function BI(r,t){return r.asyncQueue.enqueue((async()=>(function(n,s){const i=O(n);return i.persistence.runTransaction("Get named query","readonly",(o=>i.Ii.getNamedQuery(o,s)))})(await hu(r),t)))}function Kf(r){const t={};return r.timeoutSeconds!==void 0&&(t.timeoutSeconds=r.timeoutSeconds),t}const Yl=new Map;const Qf="firestore.googleapis.com",Zl=!0;class th{constructor(t){if(t.host===void 0){if(t.ssl!==void 0)throw new V(S.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Qf,this.ssl=Zl}else this.host=t.host,this.ssl=t.ssl??Zl;if(this.isUsingEmulator=t.emulatorOptions!==void 0,this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=rf;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<oy)throw new V(S.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}xg("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Kf(t.experimentalLongPollingOptions??{}),(function(n){if(n.timeoutSeconds!==void 0){if(isNaN(n.timeoutSeconds))throw new V(S.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (must not be NaN)`);if(n.timeoutSeconds<5)throw new V(S.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (minimum allowed value is 5)`);if(n.timeoutSeconds>30)throw new V(S.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&(function(n,s){return n.timeoutSeconds===s.timeoutSeconds})(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class vs{constructor(t,e,n,s){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=n,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new th({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new V(S.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(t){if(this._settingsFrozen)throw new V(S.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new th(t),this._emulatorOptions=t.emulatorOptions||{},t.credentials!==void 0&&(this._authCredentials=(function(n){if(!n)return new wg;switch(n.type){case"firstParty":return new Rg(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new V(S.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(t.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(e){const n=Yl.get(e);n&&(C("ComponentProvider","Removing Datastore"),Yl.delete(e),n.terminate())})(this),Promise.resolve()}}function oE(r,t,e,n={}){r=Y(r,vs);const s=pa(t),i=r._getSettings(),o={...i,emulatorOptions:r._getEmulatorOptions()},u=`${t}:${e}`;s&&(Hm(`https://${u}`),Zm("Firestore",!0)),i.host!==Qf&&i.host!==u&&ue("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const c={...i,host:u,ssl:s,emulatorOptions:n};if(!Fn(c,o)&&(r._setSettings(c),n.mockUserToken)){let h,f;if(typeof n.mockUserToken=="string")h=n.mockUserToken,f=wt.MOCK_USER;else{h=Jm(n.mockUserToken,r._app?.options.projectId);const p=n.mockUserToken.sub||n.mockUserToken.user_id;if(!p)throw new V(S.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");f=new wt(p)}r._authCredentials=new vg(new Lh(h,f))}}class St{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new St(this.firestore,t,this._query)}}let ht=class Lr{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new ne(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new Lr(this.firestore,t,this._key)}toJSON(){return{type:Lr._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(t,e,n){if(ds(e,Lr._jsonSchema))return new Lr(t,n||null,new M(K.fromString(e.referencePath)))}};ht._jsonSchemaVersion="firestore/documentReference/1.0",ht._jsonSchema={type:_t("string",ht._jsonSchemaVersion),referencePath:_t("string")};class ne extends St{constructor(t,e,n){super(t,e,ir(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new ht(this.firestore,null,new M(t))}withConverter(t){return new ne(this.firestore,t,this._path)}}function aE(r,t,...e){if(r=vt(r),Ta("collection","path",t),r instanceof vs){const n=K.fromString(t,...e);return jc(n),new ne(r,null,n)}{if(!(r instanceof ht||r instanceof ne))throw new V(S.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(K.fromString(t,...e));return jc(n),new ne(r.firestore,null,n)}}function uE(r,t){if(r=Y(r,vs),Ta("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new V(S.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new St(r,null,(function(n){return new he(K.emptyPath(),n)})(t))}function UI(r,t,...e){if(r=vt(r),arguments.length===1&&(t=Ea.newId()),Ta("doc","path",t),r instanceof vs){const n=K.fromString(t,...e);return qc(n),new ht(r,null,new M(n))}{if(!(r instanceof ht||r instanceof ne))throw new V(S.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(K.fromString(t,...e));return qc(n),new ht(r.firestore,r instanceof ne?r.converter:null,new M(n))}}function cE(r,t){return r=vt(r),t=vt(t),(r instanceof ht||r instanceof ne)&&(t instanceof ht||t instanceof ne)&&r.firestore===t.firestore&&r.path===t.path&&r.converter===t.converter}function qI(r,t){return r=vt(r),t=vt(t),r instanceof St&&t instanceof St&&r.firestore===t.firestore&&gs(r._query,t._query)&&r.converter===t.converter}const eh="AsyncQueue";class nh{constructor(t=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new Ja(this,"async_queue_retry"),this._c=()=>{const n=si();n&&C(eh,"Visibility state changed to "+n.visibilityState),this.M_.w_()},this.ac=t;const e=si();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.uc(),this.cc(t)}enterRestrictedMode(t){if(!this.ec){this.ec=!0,this.sc=t||!1;const e=si();e&&typeof e.removeEventListener=="function"&&e.removeEventListener("visibilitychange",this._c)}}enqueue(t){if(this.uc(),this.ec)return new Promise((()=>{}));const e=new Rt;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(t().then(e.resolve,e.reject),e.promise))).then((()=>e.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.Xu.push(t),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(t){if(!Le(t))throw t;C(eh,"Operation failed with retryable error: "+t)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(t){const e=this.ac.then((()=>(this.rc=!0,t().catch((n=>{throw this.nc=n,this.rc=!1,ft("INTERNAL UNHANDLED ERROR: ",rh(n)),n})).then((n=>(this.rc=!1,n))))));return this.ac=e,e}enqueueAfterDelay(t,e,n){this.uc(),this.oc.indexOf(t)>-1&&(e=0);const s=tu.createAndSchedule(this,t,e,n,(i=>this.hc(i)));return this.tc.push(s),s}uc(){this.nc&&F(47125,{Pc:rh(this.nc)})}verifyOperationInProgress(){}async Tc(){let t;do t=this.ac,await t;while(t!==this.ac)}Ic(t){for(const e of this.tc)if(e.timerId===t)return!0;return!1}Ec(t){return this.Tc().then((()=>{this.tc.sort(((e,n)=>e.targetTimeMs-n.targetTimeMs));for(const e of this.tc)if(e.skipDelay(),t!=="all"&&e.timerId===t)break;return this.Tc()}))}dc(t){this.oc.push(t)}hc(t){const e=this.tc.indexOf(t);this.tc.splice(e,1)}}function rh(r){let t=r.message||"";return r.stack&&(t=r.stack.includes(r.message)?r.stack:r.message+`
`+r.stack),t}function da(r){return(function(e,n){if(typeof e!="object"||e===null)return!1;const s=e;for(const i of n)if(i in s&&typeof s[i]=="function")return!0;return!1})(r,["next","error","complete"])}class jI{constructor(){this._progressObserver={},this._taskCompletionResolver=new Rt,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(t,e,n){this._progressObserver={next:t,error:e,complete:n}}catch(t){return this._taskCompletionResolver.promise.catch(t)}then(t,e){return this._taskCompletionResolver.promise.then(t,e)}_completeWith(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)}_failWith(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)}_updateProgress(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)}}const lE=-1;class pt extends vs{constructor(t,e,n,s){super(t,e,n,s),this.type="firestore",this._queue=new nh,this._persistenceKey=s?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const t=this._firestoreClient.terminate();this._queue=new nh(t),this._firestoreClient=void 0,await t}}}function Mt(r){if(r._terminated)throw new V(S.FAILED_PRECONDITION,"The client has already been terminated.");return r._firestoreClient||Wf(r),r._firestoreClient}function Wf(r){const t=r._freezeSettings(),e=(function(s,i,o,u){return new l_(s,i,o,u.host,u.ssl,u.experimentalForceLongPolling,u.experimentalAutoDetectLongPolling,Kf(u.experimentalLongPollingOptions),u.useFetchStreams,u.isUsingEmulator)})(r._databaseId,r._app?.options.appId||"",r._persistenceKey,t);r._componentsProvider||t.localCache?._offlineComponentProvider&&t.localCache?._onlineComponentProvider&&(r._componentsProvider={_offline:t.localCache._offlineComponentProvider,_online:t.localCache._onlineComponentProvider}),r._firestoreClient=new DI(r._authCredentials,r._appCheckCredentials,r._queue,e,r._componentsProvider&&(function(s){const i=s?._online.build();return{_offline:s?._offline.build(i),_online:i}})(r._componentsProvider))}function hE(r,t){ue("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const e=r._freezeSettings();return Hf(r,ls.provider,{build:n=>new qf(n,e.cacheSizeBytes,t?.forceOwnership)}),Promise.resolve()}async function dE(r){ue("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=r._freezeSettings();Hf(r,ls.provider,{build:e=>new SI(e,t.cacheSizeBytes)})}function Hf(r,t,e){if((r=Y(r,pt))._firestoreClient||r._terminated)throw new V(S.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(r._componentsProvider||r._getSettings().localCache)throw new V(S.FAILED_PRECONDITION,"SDK cache is already specified.");r._componentsProvider={_online:t,_offline:e},Wf(r)}function fE(r){if(r._initialized&&!r._terminated)throw new V(S.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const t=new Rt;return r._queue.enqueueAndForgetEvenWhileRestricted((async()=>{try{await(async function(n){if(!te.v())return Promise.resolve();const s=n+ff;await te.delete(s)})(Ka(r._databaseId,r._persistenceKey)),t.resolve()}catch(e){t.reject(e)}})),t.promise}function mE(r){return(function(e){const n=new Rt;return e.asyncQueue.enqueueAndForget((async()=>mI(await du(e),n))),n.promise})(Mt(r=Y(r,pt)))}function pE(r){return NI(Mt(r=Y(r,pt)))}function gE(r){return kI(Mt(r=Y(r,pt)))}function _E(r,t){const e=Mt(r=Y(r,pt)),n=new jI;return LI(e,r._databaseId,t,n),n}function yE(r,t){return BI(Mt(r=Y(r,pt)),t).then((e=>e?new St(r,null,e.query):null))}class jt{constructor(t){this._byteString=t}static fromBase64String(t){try{return new jt(dt.fromBase64String(t))}catch(e){throw new V(S.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(t){return new jt(dt.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}toJSON(){return{type:jt._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(t){if(ds(t,jt._jsonSchema))return jt.fromBase64String(t.bytes)}}jt._jsonSchemaVersion="firestore/bytes/1.0",jt._jsonSchema={type:_t("string",jt._jsonSchemaVersion),bytes:_t("string")};let dr=class{constructor(...t){for(let e=0;e<t.length;++e)if(t[e].length===0)throw new V(S.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ct(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}};class _n{constructor(t){this._methodName=t}}class re{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new V(S.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new V(S.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}_compareTo(t){return z(this._lat,t._lat)||z(this._long,t._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:re._jsonSchemaVersion}}static fromJSON(t){if(ds(t,re._jsonSchema))return new re(t.latitude,t.longitude)}}re._jsonSchemaVersion="firestore/geoPoint/1.0",re._jsonSchema={type:_t("string",re._jsonSchemaVersion),latitude:_t("number"),longitude:_t("number")};class se{constructor(t){this._values=(t||[]).map((e=>e))}toArray(){return this._values.map((t=>t))}isEqual(t){return(function(n,s){if(n.length!==s.length)return!1;for(let i=0;i<n.length;++i)if(n[i]!==s[i])return!1;return!0})(this._values,t._values)}toJSON(){return{type:se._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(t){if(ds(t,se._jsonSchema)){if(Array.isArray(t.vectorValues)&&t.vectorValues.every((e=>typeof e=="number")))return new se(t.vectorValues);throw new V(S.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}se._jsonSchemaVersion="firestore/vectorValue/1.0",se._jsonSchema={type:_t("string",se._jsonSchemaVersion),vectorValues:_t("object")};const zI=/^__.*__$/;class $I{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return this.fieldMask!==null?new fe(t,this.data,this.fieldMask,e,this.fieldTransforms):new or(t,this.data,e,this.fieldTransforms)}}class Jf{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return new fe(t,this.data,this.fieldMask,e,this.fieldTransforms)}}function Xf(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw F(40011,{Ac:r})}}class ji{constructor(t,e,n,s,i,o){this.settings=t,this.databaseId=e,this.serializer=n,this.ignoreUndefinedProperties=s,i===void 0&&this.Rc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(t){return new ji({...this.settings,...t},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(t){const e=this.path?.child(t),n=this.Vc({path:e,fc:!1});return n.gc(t),n}yc(t){const e=this.path?.child(t),n=this.Vc({path:e,fc:!1});return n.Rc(),n}wc(t){return this.Vc({path:void 0,fc:!0})}Sc(t){return Ai(t,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(t){return this.fieldMask.find((e=>t.isPrefixOf(e)))!==void 0||this.fieldTransforms.find((e=>t.isPrefixOf(e.field)))!==void 0}Rc(){if(this.path)for(let t=0;t<this.path.length;t++)this.gc(this.path.get(t))}gc(t){if(t.length===0)throw this.Sc("Document fields must not be empty");if(Xf(this.Ac)&&zI.test(t))throw this.Sc('Document fields cannot begin and end with "__"')}}class GI{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=n||Ts(t)}Cc(t,e,n,s=!1){return new ji({Ac:t,methodName:e,Dc:n,path:ct.emptyPath(),fc:!1,bc:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function yn(r){const t=r._freezeSettings(),e=Ts(r._databaseId);return new GI(r._databaseId,!!t.ignoreUndefinedProperties,e)}function zi(r,t,e,n,s,i={}){const o=r.Cc(i.merge||i.mergeFields?2:0,t,e,s);Iu("Data must be an object, but it was:",o,n);const u=tm(n,o);let c,h;if(i.merge)c=new Lt(o.fieldMask),h=o.fieldTransforms;else if(i.mergeFields){const f=[];for(const p of i.mergeFields){const _=fa(t,p,e);if(!o.contains(_))throw new V(S.INVALID_ARGUMENT,`Field '${_}' is specified in your field mask but missing from your input data.`);nm(f,_)||f.push(_)}c=new Lt(f),h=o.fieldTransforms.filter((p=>c.covers(p.field)))}else c=null,h=o.fieldTransforms;return new $I(new bt(u),c,h)}class As extends _n{_toFieldTransform(t){if(t.Ac!==2)throw t.Ac===1?t.Sc(`${this._methodName}() can only appear at the top level of your update data`):t.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof As}}function Yf(r,t,e){return new ji({Ac:3,Dc:t.settings.Dc,methodName:r._methodName,fc:e},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}class fu extends _n{_toFieldTransform(t){return new ys(t.path,new Hn)}isEqual(t){return t instanceof fu}}class mu extends _n{constructor(t,e){super(t),this.vc=e}_toFieldTransform(t){const e=Yf(this,t,!0),n=this.vc.map((i=>In(i,e))),s=new ln(n);return new ys(t.path,s)}isEqual(t){return t instanceof mu&&Fn(this.vc,t.vc)}}class pu extends _n{constructor(t,e){super(t),this.vc=e}_toFieldTransform(t){const e=Yf(this,t,!0),n=this.vc.map((i=>In(i,e))),s=new hn(n);return new ys(t.path,s)}isEqual(t){return t instanceof pu&&Fn(this.vc,t.vc)}}class gu extends _n{constructor(t,e){super(t),this.Fc=e}_toFieldTransform(t){const e=new Jn(t.serializer,Vd(t.serializer,this.Fc));return new ys(t.path,e)}isEqual(t){return t instanceof gu&&this.Fc===t.Fc}}function _u(r,t,e,n){const s=r.Cc(1,t,e);Iu("Data must be an object, but it was:",s,n);const i=[],o=bt.empty();Be(n,((c,h)=>{const f=Eu(t,c,e);h=vt(h);const p=s.yc(f);if(h instanceof As)i.push(f);else{const _=In(h,p);_!=null&&(i.push(f),o.set(f,_))}}));const u=new Lt(i);return new Jf(o,u,s.fieldTransforms)}function yu(r,t,e,n,s,i){const o=r.Cc(1,t,e),u=[fa(t,n,e)],c=[s];if(i.length%2!=0)throw new V(S.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let _=0;_<i.length;_+=2)u.push(fa(t,i[_])),c.push(i[_+1]);const h=[],f=bt.empty();for(let _=u.length-1;_>=0;--_)if(!nm(h,u[_])){const R=u[_];let x=c[_];x=vt(x);const N=o.yc(R);if(x instanceof As)h.push(R);else{const D=In(x,N);D!=null&&(h.push(R),f.set(R,D))}}const p=new Lt(h);return new Jf(f,p,o.fieldTransforms)}function Zf(r,t,e,n=!1){return In(e,r.Cc(n?4:3,t))}function In(r,t){if(em(r=vt(r)))return Iu("Unsupported field value:",t,r),tm(r,t);if(r instanceof _n)return(function(n,s){if(!Xf(s.Ac))throw s.Sc(`${n._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Sc(`${n._methodName}() is not currently supported inside arrays`);const i=n._toFieldTransform(s);i&&s.fieldTransforms.push(i)})(r,t),null;if(r===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),r instanceof Array){if(t.settings.fc&&t.Ac!==4)throw t.Sc("Nested arrays are not supported");return(function(n,s){const i=[];let o=0;for(const u of n){let c=In(u,s.wc(o));c==null&&(c={nullValue:"NULL_VALUE"}),i.push(c),o++}return{arrayValue:{values:i}}})(r,t)}return(function(n,s){if((n=vt(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return Vd(s.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){const i=Z.fromDate(n);return{timestampValue:Xn(s.serializer,i)}}if(n instanceof Z){const i=new Z(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:Xn(s.serializer,i)}}if(n instanceof re)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof jt)return{bytesValue:qd(s.serializer,n._byteString)};if(n instanceof ht){const i=s.databaseId,o=n.firestore._databaseId;if(!o.isEqual(i))throw s.Sc(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:Ba(n.firestore._databaseId||s.databaseId,n._key.path)}}if(n instanceof se)return(function(o,u){return{mapValue:{fields:{[Pa]:{stringValue:Va},[Kn]:{arrayValue:{values:o.toArray().map((h=>{if(typeof h!="number")throw u.Sc("VectorValues must only contain numeric values.");return Na(u.serializer,h)}))}}}}}})(n,s);throw s.Sc(`Unsupported field value: ${bi(n)}`)})(r,t)}function tm(r,t){const e={};return sd(r)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Be(r,((n,s)=>{const i=In(s,t.mc(n));i!=null&&(e[n]=i)})),{mapValue:{fields:e}}}function em(r){return!(typeof r!="object"||r===null||r instanceof Array||r instanceof Date||r instanceof Z||r instanceof re||r instanceof jt||r instanceof ht||r instanceof _n||r instanceof se)}function Iu(r,t,e){if(!em(e)||!Uh(e)){const n=bi(e);throw n==="an object"?t.Sc(r+" a custom object"):t.Sc(r+" "+n)}}function fa(r,t,e){if((t=vt(t))instanceof dr)return t._internalPath;if(typeof t=="string")return Eu(r,t);throw Ai("Field path arguments must be of type string or ",r,!1,void 0,e)}const KI=new RegExp("[~\\*/\\[\\]]");function Eu(r,t,e){if(t.search(KI)>=0)throw Ai(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,e);try{return new dr(...t.split("."))._internalPath}catch{throw Ai(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,e)}}function Ai(r,t,e,n,s){const i=n&&!n.isEmpty(),o=s!==void 0;let u=`Function ${t}() called with invalid data`;e&&(u+=" (via `toFirestore()`)"),u+=". ";let c="";return(i||o)&&(c+=" (found",i&&(c+=` in field ${n}`),o&&(c+=` in document ${s}`),c+=")"),new V(S.INVALID_ARGUMENT,u+r+c)}function nm(r,t){return r.some((e=>e.isEqual(t)))}class hs{constructor(t,e,n,s,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new ht(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const t=new QI(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field($i("DocumentSnapshot.get",t));if(e!==null)return this._userDataWriter.convertValue(e)}}}class QI extends hs{data(){return super.data()}}function $i(r,t){return typeof t=="string"?Eu(r,t):t instanceof dr?t._internalPath:t._delegate._internalPath}function rm(r){if(r.limitType==="L"&&r.explicitOrderBy.length===0)throw new V(S.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Tu{}class bs extends Tu{}function EE(r,t,...e){let n=[];t instanceof Tu&&n.push(t),n=n.concat(e),(function(i){const o=i.filter((c=>c instanceof wu)).length,u=i.filter((c=>c instanceof Gi)).length;if(o>1||o>0&&u>0)throw new V(S.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(n);for(const s of n)r=s._apply(r);return r}class Gi extends bs{constructor(t,e,n){super(),this._field=t,this._op=e,this._value=n,this.type="where"}static _create(t,e,n){return new Gi(t,e,n)}_apply(t){const e=this._parse(t);return im(t._query,e),new St(t.firestore,t.converter,Zo(t._query,e))}_parse(t){const e=yn(t.firestore);return(function(i,o,u,c,h,f,p){let _;if(h.isKeyField()){if(f==="array-contains"||f==="array-contains-any")throw new V(S.INVALID_ARGUMENT,`Invalid Query. You can't perform '${f}' queries on documentId().`);if(f==="in"||f==="not-in"){ih(p,f);const x=[];for(const N of p)x.push(sh(c,i,N));_={arrayValue:{values:x}}}else _=sh(c,i,p)}else f!=="in"&&f!=="not-in"&&f!=="array-contains-any"||ih(p,f),_=Zf(u,o,p,f==="in"||f==="not-in");return Q.create(h,f,_)})(t._query,"where",e,t.firestore._databaseId,this._field,this._op,this._value)}}function TE(r,t,e){const n=t,s=$i("where",r);return Gi._create(s,n,e)}class wu extends Tu{constructor(t,e){super(),this.type=t,this._queryConstraints=e}static _create(t,e){return new wu(t,e)}_parse(t){const e=this._queryConstraints.map((n=>n._parse(t))).filter((n=>n.getFilters().length>0));return e.length===1?e[0]:tt.create(e,this._getOperator())}_apply(t){const e=this._parse(t);return e.getFilters().length===0?t:((function(s,i){let o=s;const u=i.getFlattenedFilters();for(const c of u)im(o,c),o=Zo(o,c)})(t._query,e),new St(t.firestore,t.converter,Zo(t._query,e)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class vu extends bs{constructor(t,e){super(),this._field=t,this._direction=e,this.type="orderBy"}static _create(t,e){return new vu(t,e)}_apply(t){const e=(function(s,i,o){if(s.startAt!==null)throw new V(S.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new V(S.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new os(i,o)})(t._query,this._field,this._direction);return new St(t.firestore,t.converter,(function(s,i){const o=s.explicitOrderBy.concat([i]);return new he(s.path,s.collectionGroup,o,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)})(t._query,e))}}function wE(r,t="asc"){const e=t,n=$i("orderBy",r);return vu._create(n,e)}class Ki extends bs{constructor(t,e,n){super(),this.type=t,this._limit=e,this._limitType=n}static _create(t,e,n){return new Ki(t,e,n)}_apply(t){return new St(t.firestore,t.converter,pi(t._query,this._limit,this._limitType))}}function vE(r){return qh("limit",r),Ki._create("limit",r,"F")}function AE(r){return qh("limitToLast",r),Ki._create("limitToLast",r,"L")}class Qi extends bs{constructor(t,e,n){super(),this.type=t,this._docOrFields=e,this._inclusive=n}static _create(t,e,n){return new Qi(t,e,n)}_apply(t){const e=sm(t,this.type,this._docOrFields,this._inclusive);return new St(t.firestore,t.converter,(function(s,i){return new he(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,i,s.endAt)})(t._query,e))}}function bE(...r){return Qi._create("startAt",r,!0)}function RE(...r){return Qi._create("startAfter",r,!1)}class Wi extends bs{constructor(t,e,n){super(),this.type=t,this._docOrFields=e,this._inclusive=n}static _create(t,e,n){return new Wi(t,e,n)}_apply(t){const e=sm(t,this.type,this._docOrFields,this._inclusive);return new St(t.firestore,t.converter,(function(s,i){return new he(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,s.startAt,i)})(t._query,e))}}function SE(...r){return Wi._create("endBefore",r,!1)}function PE(...r){return Wi._create("endAt",r,!0)}function sm(r,t,e,n){if(e[0]=vt(e[0]),e[0]instanceof hs)return(function(i,o,u,c,h){if(!c)throw new V(S.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${u}().`);const f=[];for(const p of Mn(i))if(p.field.isKeyField())f.push(un(o,c.key));else{const _=c.data.field(p.field);if(Ci(_))throw new V(S.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+p.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(_===null){const R=p.field.canonicalString();throw new V(S.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${R}' (used as the orderBy) does not exist.`)}f.push(_)}return new ke(f,h)})(r._query,r.firestore._databaseId,t,e[0]._document,n);{const s=yn(r.firestore);return(function(o,u,c,h,f,p){const _=o.explicitOrderBy;if(f.length>_.length)throw new V(S.INVALID_ARGUMENT,`Too many arguments provided to ${h}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const R=[];for(let x=0;x<f.length;x++){const N=f[x];if(_[x].field.isKeyField()){if(typeof N!="string")throw new V(S.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${h}(), but got a ${typeof N}`);if(!Da(o)&&N.indexOf("/")!==-1)throw new V(S.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${h}() must be a plain document ID, but '${N}' contains a slash.`);const D=o.path.child(K.fromString(N));if(!M.isDocumentKey(D))throw new V(S.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${h}() must result in a valid document path, but '${D}' is not because it contains an odd number of segments.`);const q=new M(D);R.push(un(u,q))}else{const D=Zf(c,h,N);R.push(D)}}return new ke(R,p)})(r._query,r.firestore._databaseId,s,t,e,n)}}function sh(r,t,e){if(typeof(e=vt(e))=="string"){if(e==="")throw new V(S.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Da(t)&&e.indexOf("/")!==-1)throw new V(S.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${e}' contains a '/' character.`);const n=t.path.child(K.fromString(e));if(!M.isDocumentKey(n))throw new V(S.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return un(r,new M(n))}if(e instanceof ht)return un(r,e._key);throw new V(S.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${bi(e)}.`)}function ih(r,t){if(!Array.isArray(r)||r.length===0)throw new V(S.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function im(r,t){const e=(function(s,i){for(const o of s)for(const u of o.getFlattenedFilters())if(i.indexOf(u.op)>=0)return u.op;return null})(r.filters,(function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(t.op));if(e!==null)throw e===t.op?new V(S.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new V(S.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${e.toString()}' filters.`)}class om{convertValue(t,e="none"){switch(xe(t)){case 0:return null;case 1:return t.booleanValue;case 2:return at(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(le(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 11:return this.convertObject(t.mapValue,e);case 10:return this.convertVectorValue(t.mapValue);default:throw F(62114,{value:t})}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){const n={};return Be(t,((s,i)=>{n[s]=this.convertValue(i,e)})),n}convertVectorValue(t){const e=t.fields?.[Kn].arrayValue?.values?.map((n=>at(n.doubleValue)));return new se(e)}convertGeoPoint(t){return new re(at(t.latitude),at(t.longitude))}convertArray(t,e){return(t.values||[]).map((n=>this.convertValue(n,e)))}convertServerTimestamp(t,e){switch(e){case"previous":const n=Di(t);return n==null?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(rs(t));default:return null}}convertTimestamp(t){const e=ce(t);return new Z(e.seconds,e.nanos)}convertDocumentKey(t,e){const n=K.fromString(t);L(Yd(n),9688,{name:t});const s=new an(n.get(1),n.get(3)),i=new M(n.popFirst(5));return s.isEqual(e)||ft(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),i}}function Hi(r,t,e){let n;return n=r?e&&(e.merge||e.mergeFields)?r.toFirestore(t,e):r.toFirestore(t):t,n}class WI extends om{constructor(t){super(),this.firestore=t}convertBytes(t){return new jt(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new ht(this.firestore,null,e)}}class rn{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class Kt extends hs{constructor(t,e,n,s,i,o){super(t,e,n,s,o),this._firestore=t,this._firestoreImpl=t,this.metadata=i}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new ii(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const n=this._document.data.field($i("DocumentSnapshot.get",t));if(n!==null)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new V(S.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const t=this._document,e={};return e.type=Kt._jsonSchemaVersion,e.bundle="",e.bundleSource="DocumentSnapshot",e.bundleName=this._key.toString(),!t||!t.isValidDocument()||!t.isFoundDocument()?e:(this._userDataWriter.convertObjectMap(t.data.value.mapValue.fields,"previous"),e.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),e)}}Kt._jsonSchemaVersion="firestore/documentSnapshot/1.0",Kt._jsonSchema={type:_t("string",Kt._jsonSchemaVersion),bundleSource:_t("string","DocumentSnapshot"),bundleName:_t("string"),bundle:_t("string")};class ii extends Kt{data(t={}){return super.data(t)}}class Qt{constructor(t,e,n,s){this._firestore=t,this._userDataWriter=e,this._snapshot=s,this.metadata=new rn(s.hasPendingWrites,s.fromCache),this.query=n}get docs(){const t=[];return this.forEach((e=>t.push(e))),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,e){this._snapshot.docs.forEach((n=>{t.call(e,new ii(this._firestore,this._userDataWriter,n.key,n,new rn(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new V(S.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=(function(s,i){if(s._snapshot.oldDocs.isEmpty()){let o=0;return s._snapshot.docChanges.map((u=>{const c=new ii(s._firestore,s._userDataWriter,u.doc.key,u.doc,new rn(s._snapshot.mutatedKeys.has(u.doc.key),s._snapshot.fromCache),s.query.converter);return u.doc,{type:"added",doc:c,oldIndex:-1,newIndex:o++}}))}{let o=s._snapshot.oldDocs;return s._snapshot.docChanges.filter((u=>i||u.type!==3)).map((u=>{const c=new ii(s._firestore,s._userDataWriter,u.doc.key,u.doc,new rn(s._snapshot.mutatedKeys.has(u.doc.key),s._snapshot.fromCache),s.query.converter);let h=-1,f=-1;return u.type!==0&&(h=o.indexOf(u.doc.key),o=o.delete(u.doc.key)),u.type!==1&&(o=o.add(u.doc),f=o.indexOf(u.doc.key)),{type:HI(u.type),doc:c,oldIndex:h,newIndex:f}}))}})(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new V(S.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const t={};t.type=Qt._jsonSchemaVersion,t.bundleSource="QuerySnapshot",t.bundleName=Ea.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const e=[],n=[],s=[];return this.docs.forEach((i=>{i._document!==null&&(e.push(i._document),n.push(this._userDataWriter.convertObjectMap(i._document.data.value.mapValue.fields,"previous")),s.push(i.ref.path))})),t.bundle=(this._firestore,this.query._query,t.bundleName,"NOT SUPPORTED"),t}}function HI(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return F(61501,{type:r})}}function VE(r,t){return r instanceof Kt&&t instanceof Kt?r._firestore===t._firestore&&r._key.isEqual(t._key)&&(r._document===null?t._document===null:r._document.isEqual(t._document))&&r._converter===t._converter:r instanceof Qt&&t instanceof Qt&&r._firestore===t._firestore&&qI(r.query,t.query)&&r.metadata.isEqual(t.metadata)&&r._snapshot.isEqual(t._snapshot)}function CE(r){r=Y(r,ht);const t=Y(r.firestore,pt);return $f(Mt(t),r._key).then((e=>Au(t,r,e)))}Qt._jsonSchemaVersion="firestore/querySnapshot/1.0",Qt._jsonSchema={type:_t("string",Qt._jsonSchemaVersion),bundleSource:_t("string","QuerySnapshot"),bundleName:_t("string"),bundle:_t("string")};class En extends om{constructor(t){super(),this.firestore=t}convertBytes(t){return new jt(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new ht(this.firestore,null,e)}}function DE(r){r=Y(r,ht);const t=Y(r.firestore,pt),e=Mt(t),n=new En(t);return MI(e,r._key).then((s=>new Kt(t,n,r._key,s,new rn(s!==null&&s.hasLocalMutations,!0),r.converter)))}function xE(r){r=Y(r,ht);const t=Y(r.firestore,pt);return $f(Mt(t),r._key,{source:"server"}).then((e=>Au(t,r,e)))}function NE(r){r=Y(r,St);const t=Y(r.firestore,pt),e=Mt(t),n=new En(t);return rm(r._query),Gf(e,r._query).then((s=>new Qt(t,n,r,s)))}function kE(r){r=Y(r,St);const t=Y(r.firestore,pt),e=Mt(t),n=new En(t);return OI(e,r._query).then((s=>new Qt(t,n,r,s)))}function ME(r){r=Y(r,St);const t=Y(r.firestore,pt),e=Mt(t),n=new En(t);return Gf(e,r._query,{source:"server"}).then((s=>new Qt(t,n,r,s)))}function OE(r,t,e){r=Y(r,ht);const n=Y(r.firestore,pt),s=Hi(r.converter,t,e);return Ji(n,[zi(yn(n),"setDoc",r._key,s,r.converter!==null,e).toMutation(r._key,ut.none())])}function FE(r,t,e,...n){r=Y(r,ht);const s=Y(r.firestore,pt),i=yn(s);let o;return o=typeof(t=vt(t))=="string"||t instanceof dr?yu(i,"updateDoc",r._key,t,e,n):_u(i,"updateDoc",r._key,t),Ji(s,[o.toMutation(r._key,ut.exists(!0))])}function LE(r){return Ji(Y(r.firestore,pt),[new ar(r._key,ut.none())])}function BE(r,t){const e=Y(r.firestore,pt),n=UI(r),s=Hi(r.converter,t);return Ji(e,[zi(yn(r.firestore),"addDoc",n._key,s,r.converter!==null,{}).toMutation(n._key,ut.exists(!1))]).then((()=>n))}function UE(r,...t){r=vt(r);let e={includeMetadataChanges:!1,source:"default"},n=0;typeof t[n]!="object"||da(t[n])||(e=t[n++]);const s={includeMetadataChanges:e.includeMetadataChanges,source:e.source};if(da(t[n])){const c=t[n];t[n]=c.next?.bind(c),t[n+1]=c.error?.bind(c),t[n+2]=c.complete?.bind(c)}let i,o,u;if(r instanceof ht)o=Y(r.firestore,pt),u=ir(r._key.path),i={next:c=>{t[n]&&t[n](Au(o,r,c))},error:t[n+1],complete:t[n+2]};else{const c=Y(r,St);o=Y(c.firestore,pt),u=c._query;const h=new En(o);i={next:f=>{t[n]&&t[n](new Qt(o,h,c,f))},error:t[n+1],complete:t[n+2]},rm(r._query)}return(function(h,f,p,_){const R=new Ui(_),x=new su(f,R,p);return h.asyncQueue.enqueueAndForget((async()=>eu(await rr(h),x))),()=>{R.Nu(),h.asyncQueue.enqueueAndForget((async()=>nu(await rr(h),x)))}})(Mt(o),u,s,i)}function qE(r,t){return FI(Mt(r=Y(r,pt)),da(t)?t:{next:t})}function Ji(r,t){return(function(n,s){const i=new Rt;return n.asyncQueue.enqueueAndForget((async()=>lI(await du(n),s,i))),i.promise})(Mt(r),t)}function Au(r,t,e){const n=e.docs.get(t._key),s=new En(r);return new Kt(r,s,t._key,n,new rn(e.hasPendingWrites,e.fromCache),t.converter)}const JI={maxAttempts:5};class jE{constructor(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=yn(t)}set(t,e,n){this._verifyNotCommitted();const s=Re(t,this._firestore),i=Hi(s.converter,e,n),o=zi(this._dataReader,"WriteBatch.set",s._key,i,s.converter!==null,n);return this._mutations.push(o.toMutation(s._key,ut.none())),this}update(t,e,n,...s){this._verifyNotCommitted();const i=Re(t,this._firestore);let o;return o=typeof(e=vt(e))=="string"||e instanceof dr?yu(this._dataReader,"WriteBatch.update",i._key,e,n,s):_u(this._dataReader,"WriteBatch.update",i._key,e),this._mutations.push(o.toMutation(i._key,ut.exists(!0))),this}delete(t){this._verifyNotCommitted();const e=Re(t,this._firestore);return this._mutations=this._mutations.concat(new ar(e._key,ut.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new V(S.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Re(r,t){if((r=vt(r)).firestore!==t)throw new V(S.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return r}class XI{constructor(t,e){this._firestore=t,this._transaction=e,this._dataReader=yn(t)}get(t){const e=Re(t,this._firestore),n=new WI(this._firestore);return this._transaction.lookup([e._key]).then((s=>{if(!s||s.length!==1)return F(24041);const i=s[0];if(i.isFoundDocument())return new hs(this._firestore,n,i.key,i,e.converter);if(i.isNoDocument())return new hs(this._firestore,n,e._key,null,e.converter);throw F(18433,{doc:i})}))}set(t,e,n){const s=Re(t,this._firestore),i=Hi(s.converter,e,n),o=zi(this._dataReader,"Transaction.set",s._key,i,s.converter!==null,n);return this._transaction.set(s._key,o),this}update(t,e,n,...s){const i=Re(t,this._firestore);let o;return o=typeof(e=vt(e))=="string"||e instanceof dr?yu(this._dataReader,"Transaction.update",i._key,e,n,s):_u(this._dataReader,"Transaction.update",i._key,e),this._transaction.update(i._key,o),this}delete(t){const e=Re(t,this._firestore);return this._transaction.delete(e._key),this}}class YI extends XI{constructor(t,e){super(t,e),this._firestore=t}get(t){const e=Re(t,this._firestore),n=new En(this._firestore);return super.get(t).then((s=>new Kt(this._firestore,n,e._key,s._document,new rn(!1,!1),e.converter)))}}function zE(r,t,e){r=Y(r,pt);const n={...JI,...e};return(function(i){if(i.maxAttempts<1)throw new V(S.INVALID_ARGUMENT,"Max attempts must be at least 1")})(n),(function(i,o,u){const c=new Rt;return i.asyncQueue.enqueueAndForget((async()=>{const h=await xI(i);new CI(i.asyncQueue,h,u,o,c).ju()})),c.promise})(Mt(r),(s=>t(new YI(r,s))),n)}function $E(){return new As("deleteField")}function GE(){return new fu("serverTimestamp")}function KE(...r){return new mu("arrayUnion",r)}function QE(...r){return new pu("arrayRemove",r)}function WE(r){return new gu("increment",r)}(function(t,e=!0){(function(s){sr=s})(Rh),Jr(new Wr("firestore",((n,{instanceIdentifier:s,options:i})=>{const o=n.getProvider("app").getImmediate(),u=new pt(new Ag(n.getProvider("auth-internal")),new Sg(o,n.getProvider("app-check-internal")),(function(h,f){if(!Object.prototype.hasOwnProperty.apply(h.options,["projectId"]))throw new V(S.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new an(h.options.projectId,f)})(o,s),o);return i={useFetchStreams:e,...i},u._setSettings(i),u}),"PUBLIC").setMultipleInstances(!0)),sn(Fc,Lc,t),sn(Fc,Lc,"esm2020")})();export{aE as $,EE as A,TE as B,Wr as C,Hr as D,gh as E,dr as F,re as G,wE as H,vE as I,AE as J,bE as K,Ih as L,RE as M,SE as N,PE as O,qI as P,kE as Q,ME as R,Rh as S,Z as T,NE as U,Qt as V,UE as W,V as X,ht as Y,M as Z,Jr as _,ZI as a,OE as a0,FE as a1,LE as a2,DE as a3,xE as a4,CE as a5,Kt as a6,jt as a7,an as a8,ue as a9,oE as aa,pE as ab,gE as ac,xg as ad,mE as ae,qE as af,uE as ag,zE as ah,Mt as ai,jE as aj,Ji as ak,_E as al,yE as am,ii as an,om as ao,Y as ap,iE as aq,hE as ar,dE as as,fE as at,Bo as b,tE as c,zm as d,Ph as e,ng as f,ch as g,nE as h,Sh as i,GE as j,$E as k,lE as l,eE as m,KE as n,lg as o,QE as p,WE as q,sn as r,hg as s,ct as t,vt as u,UI as v,BE as w,cE as x,VE as y,rE as z};
